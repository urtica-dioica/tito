d2a4db0fcb1e1b500cfc6ac4015531d1
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DatabasePerformanceTest = exports.PerformanceBenchmark = exports.LoadTestRunner = void 0;
const axios = {
    create: () => ({
        get: jest.fn(),
        post: jest.fn(),
        put: jest.fn(),
        delete: jest.fn(),
        patch: jest.fn(),
        interceptors: {
            request: { use: jest.fn() },
            response: { use: jest.fn() }
        }
    })
};
const perf_hooks_1 = require("perf_hooks");
class LoadTestRunner {
    constructor(config) {
        this.results = [];
        this.config = config;
        this.axiosInstance = axios.create({
            baseURL: config.baseURL,
            timeout: config.timeout,
            headers: {
                'Content-Type': 'application/json',
                'User-Agent': 'LoadTestRunner/1.0'
            }
        });
    }
    /**
     * Run a load test with a specific request function
     */
    async runLoadTest(requestFunction, testName) {
        console.log(`üöÄ Starting load test: ${testName}`);
        console.log(`üìä Configuration: ${this.config.concurrentUsers} users, ${this.config.requestsPerUser} requests each`);
        this.results = [];
        const startTime = perf_hooks_1.performance.now();
        // Create user groups
        const userGroups = this.createUserGroups();
        // Run load test
        await this.executeLoadTest(userGroups, requestFunction);
        const endTime = perf_hooks_1.performance.now();
        const duration = endTime - startTime;
        // Calculate results
        const result = this.calculateResults(startTime, endTime, duration);
        console.log(`‚úÖ Load test completed: ${testName}`);
        console.log(`üìà Results: ${result.successfulRequests}/${result.totalRequests} successful (${(result.errorRate * 100).toFixed(2)}% error rate)`);
        console.log(`‚è±Ô∏è  Average response time: ${result.averageResponseTime.toFixed(2)}ms`);
        console.log(`üöÄ Requests per second: ${result.requestsPerSecond.toFixed(2)}`);
        return result;
    }
    /**
     * Create user groups for concurrent execution
     */
    createUserGroups() {
        const userGroups = [];
        for (let i = 0; i < this.config.concurrentUsers; i++) {
            userGroups.push(async () => {
                // Ramp up delay
                const rampUpDelay = (i / this.config.concurrentUsers) * this.config.rampUpTime;
                if (rampUpDelay > 0) {
                    await this.sleep(rampUpDelay);
                }
                // Execute requests for this user
                for (let j = 0; j < this.config.requestsPerUser; j++) {
                    await this.executeRequest();
                    // Add delay between requests if needed
                    if (j < this.config.requestsPerUser - 1) {
                        await this.sleep(100); // 100ms between requests
                    }
                }
            });
        }
        return userGroups;
    }
    /**
     * Execute the load test with all user groups
     */
    async executeLoadTest(userGroups, requestFunction) {
        // Store the request function for use in executeRequest
        this.requestFunction = requestFunction;
        // Execute all user groups concurrently
        await Promise.all(userGroups.map(userGroup => userGroup()));
    }
    /**
     * Execute a single request and record metrics
     */
    async executeRequest() {
        const startTime = perf_hooks_1.performance.now();
        let endTime;
        let success = false;
        let statusCode;
        let error;
        try {
            const response = await this.requestFunction(this.axiosInstance);
            endTime = perf_hooks_1.performance.now();
            success = true;
            statusCode = response.status;
        }
        catch (err) {
            endTime = perf_hooks_1.performance.now();
            success = false;
            statusCode = err.response?.status;
            error = err.message || 'Unknown error';
        }
        const responseTime = endTime - startTime;
        this.results.push({
            startTime,
            endTime,
            responseTime,
            success,
            statusCode,
            error
        });
    }
    /**
     * Calculate test results from metrics
     */
    calculateResults(startTime, endTime, duration) {
        const totalRequests = this.results.length;
        const successfulRequests = this.results.filter(r => r.success).length;
        const failedRequests = totalRequests - successfulRequests;
        const responseTimes = this.results.map(r => r.responseTime).sort((a, b) => a - b);
        const averageResponseTime = responseTimes.reduce((sum, time) => sum + time, 0) / totalRequests;
        const minResponseTime = responseTimes[0] || 0;
        const maxResponseTime = responseTimes[responseTimes.length - 1] || 0;
        const p95ResponseTime = this.percentile(responseTimes, 95);
        const p99ResponseTime = this.percentile(responseTimes, 99);
        const requestsPerSecond = totalRequests / (duration / 1000);
        const errorRate = failedRequests / totalRequests;
        // Calculate error breakdown
        const errorMap = new Map();
        this.results
            .filter(r => !r.success)
            .forEach(r => {
            const errorKey = r.error || `HTTP ${r.statusCode}`;
            errorMap.set(errorKey, (errorMap.get(errorKey) || 0) + 1);
        });
        const errors = Array.from(errorMap.entries()).map(([error, count]) => ({
            error,
            count,
            percentage: (count / totalRequests) * 100
        }));
        return {
            totalRequests,
            successfulRequests,
            failedRequests,
            averageResponseTime,
            minResponseTime,
            maxResponseTime,
            p95ResponseTime,
            p99ResponseTime,
            requestsPerSecond,
            errorRate,
            startTime,
            endTime,
            duration,
            errors
        };
    }
    /**
     * Calculate percentile from sorted array
     */
    percentile(sortedArray, percentile) {
        const index = (percentile / 100) * (sortedArray.length - 1);
        const lower = Math.floor(index);
        const upper = Math.ceil(index);
        const weight = index % 1;
        if (upper >= sortedArray.length) {
            return sortedArray[sortedArray.length - 1];
        }
        return sortedArray[lower] * (1 - weight) + sortedArray[upper] * weight;
    }
    /**
     * Sleep utility function
     */
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    /**
     * Generate a detailed report
     */
    generateReport(result, testName) {
        const report = `
üìä LOAD TEST REPORT: ${testName}
=====================================

üìà SUMMARY
----------
Total Requests: ${result.totalRequests}
Successful: ${result.successfulRequests} (${((result.successfulRequests / result.totalRequests) * 100).toFixed(2)}%)
Failed: ${result.failedRequests} (${(result.errorRate * 100).toFixed(2)}%)
Duration: ${(result.duration / 1000).toFixed(2)}s
Requests/Second: ${result.requestsPerSecond.toFixed(2)}

‚è±Ô∏è  RESPONSE TIMES
------------------
Average: ${result.averageResponseTime.toFixed(2)}ms
Minimum: ${result.minResponseTime.toFixed(2)}ms
Maximum: ${result.maxResponseTime.toFixed(2)}ms
95th Percentile: ${result.p95ResponseTime.toFixed(2)}ms
99th Percentile: ${result.p99ResponseTime.toFixed(2)}ms

‚ùå ERRORS
---------
${result.errors.length > 0 ? result.errors.map(e => `${e.error}: ${e.count} (${e.percentage.toFixed(2)}%)`).join('\n') : 'No errors'}

üéØ PERFORMANCE TARGETS
----------------------
‚úÖ Response Time < 2000ms: ${result.averageResponseTime < 2000 ? 'PASS' : 'FAIL'}
‚úÖ Error Rate < 1%: ${result.errorRate < 0.01 ? 'PASS' : 'FAIL'}
‚úÖ RPS > 10: ${result.requestsPerSecond > 10 ? 'PASS' : 'FAIL'}
`;
        return report;
    }
}
exports.LoadTestRunner = LoadTestRunner;
/**
 * Performance benchmarking utility
 */
class PerformanceBenchmark {
    constructor() {
        this.results = new Map();
    }
    /**
     * Measure execution time of a function
     */
    async measure(name, fn) {
        const startTime = perf_hooks_1.performance.now();
        const result = await fn();
        const endTime = perf_hooks_1.performance.now();
        const duration = endTime - startTime;
        if (!this.results.has(name)) {
            this.results.set(name, []);
        }
        this.results.get(name).push(duration);
        return result;
    }
    /**
     * Get benchmark results
     */
    getResults() {
        const benchmarkResults = new Map();
        for (const [name, times] of this.results.entries()) {
            const sorted = times.sort((a, b) => a - b);
            benchmarkResults.set(name, {
                average: times.reduce((sum, time) => sum + time, 0) / times.length,
                min: sorted[0],
                max: sorted[sorted.length - 1],
                count: times.length
            });
        }
        return benchmarkResults;
    }
    /**
     * Generate benchmark report
     */
    generateReport() {
        const results = this.getResults();
        let report = '\nüèÅ PERFORMANCE BENCHMARK REPORT\n================================\n\n';
        for (const [name, stats] of results.entries()) {
            report += `üìä ${name}\n`;
            report += `   Average: ${stats.average.toFixed(2)}ms\n`;
            report += `   Min: ${stats.min.toFixed(2)}ms\n`;
            report += `   Max: ${stats.max.toFixed(2)}ms\n`;
            report += `   Samples: ${stats.count}\n\n`;
        }
        return report;
    }
}
exports.PerformanceBenchmark = PerformanceBenchmark;
/**
 * Database performance testing utility
 */
class DatabasePerformanceTest {
    constructor(pool) {
        this.pool = pool;
    }
    /**
     * Test query performance
     */
    async testQueryPerformance(query, params = [], iterations = 100) {
        const times = [];
        for (let i = 0; i < iterations; i++) {
            const startTime = perf_hooks_1.performance.now();
            await this.pool.query(query, params);
            const endTime = perf_hooks_1.performance.now();
            times.push(endTime - startTime);
        }
        const sorted = times.sort((a, b) => a - b);
        return {
            averageTime: times.reduce((sum, time) => sum + time, 0) / times.length,
            minTime: sorted[0],
            maxTime: sorted[sorted.length - 1],
            totalTime: times.reduce((sum, time) => sum + time, 0)
        };
    }
    /**
     * Test concurrent query performance
     */
    async testConcurrentQueryPerformance(query, params = [], concurrentQueries = 10, iterations = 10) {
        const times = [];
        for (let i = 0; i < iterations; i++) {
            const startTime = perf_hooks_1.performance.now();
            // Execute concurrent queries
            const promises = Array(concurrentQueries).fill(null).map(() => this.pool.query(query, params));
            await Promise.all(promises);
            const endTime = perf_hooks_1.performance.now();
            times.push(endTime - startTime);
        }
        const sorted = times.sort((a, b) => a - b);
        const averageTime = times.reduce((sum, time) => sum + time, 0) / times.length;
        const totalTime = times.reduce((sum, time) => sum + time, 0);
        const queriesPerSecond = (concurrentQueries * iterations) / (totalTime / 1000);
        return {
            averageTime,
            minTime: sorted[0],
            maxTime: sorted[sorted.length - 1],
            totalTime,
            queriesPerSecond
        };
    }
}
exports.DatabasePerformanceTest = DatabasePerformanceTest;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva2ltL3RpdG8vc2VydmVyL3Rlc3RzL3BlcmZvcm1hbmNlL2xvYWRUZXN0VXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBa0JBLE1BQU0sS0FBSyxHQUFHO0lBQ1osTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDYixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNqQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixZQUFZLEVBQUU7WUFDWixPQUFPLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFO1lBQzNCLFFBQVEsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUU7U0FDN0I7S0FDRixDQUFDO0NBQ0gsQ0FBQztBQUNGLDJDQUF5QztBQXlDekMsTUFBYSxjQUFjO0lBS3pCLFlBQVksTUFBc0I7UUFGMUIsWUFBTyxHQUFxQixFQUFFLENBQUM7UUFHckMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLGFBQWEsR0FBSSxLQUFhLENBQUMsTUFBTSxDQUFDO1lBQ3pDLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTztZQUN2QixPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU87WUFDdkIsT0FBTyxFQUFFO2dCQUNQLGNBQWMsRUFBRSxrQkFBa0I7Z0JBQ2xDLFlBQVksRUFBRSxvQkFBb0I7YUFDbkM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsV0FBVyxDQUNmLGVBQWlFLEVBQ2pFLFFBQWdCO1FBRWhCLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDbEQsT0FBTyxDQUFD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QUFDO0lBQ0osQ0FBQztDQUNGO0FBN0VELDBEQTZFQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9raW0vdGl0by9zZXJ2ZXIvdGVzdHMvcGVyZm9ybWFuY2UvbG9hZFRlc3RVdGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBNb2NrIGF4aW9zIGZvciB0ZXN0aW5nXG5pbnRlcmZhY2UgQXhpb3NJbnN0YW5jZSB7XG4gIGdldDogamVzdC5Nb2NrO1xuICBwb3N0OiBqZXN0Lk1vY2s7XG4gIHB1dDogamVzdC5Nb2NrO1xuICBkZWxldGU6IGplc3QuTW9jaztcbiAgcGF0Y2g6IGplc3QuTW9jaztcbiAgaW50ZXJjZXB0b3JzOiB7XG4gICAgcmVxdWVzdDogeyB1c2U6IGplc3QuTW9jayB9O1xuICAgIHJlc3BvbnNlOiB7IHVzZTogamVzdC5Nb2NrIH07XG4gIH07XG59XG5cbmludGVyZmFjZSBBeGlvc1Jlc3BvbnNlIHtcbiAgc3RhdHVzOiBudW1iZXI7XG4gIGRhdGE6IGFueTtcbn1cblxuY29uc3QgYXhpb3MgPSB7XG4gIGNyZWF0ZTogKCkgPT4gKHtcbiAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICBwb3N0OiBqZXN0LmZuKCksXG4gICAgcHV0OiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgcGF0Y2g6IGplc3QuZm4oKSxcbiAgICBpbnRlcmNlcHRvcnM6IHtcbiAgICAgIHJlcXVlc3Q6IHsgdXNlOiBqZXN0LmZuKCkgfSxcbiAgICAgIHJlc3BvbnNlOiB7IHVzZTogamVzdC5mbigpIH1cbiAgICB9XG4gIH0pXG59O1xuaW1wb3J0IHsgcGVyZm9ybWFuY2UgfSBmcm9tICdwZXJmX2hvb2tzJztcblxuZXhwb3J0IGludGVyZmFjZSBMb2FkVGVzdENvbmZpZyB7XG4gIGJhc2VVUkw6IHN0cmluZztcbiAgY29uY3VycmVudFVzZXJzOiBudW1iZXI7XG4gIHJlcXVlc3RzUGVyVXNlcjogbnVtYmVyO1xuICByYW1wVXBUaW1lOiBudW1iZXI7IC8vIG1pbGxpc2Vjb25kc1xuICB0ZXN0RHVyYXRpb246IG51bWJlcjsgLy8gbWlsbGlzZWNvbmRzXG4gIHRpbWVvdXQ6IG51bWJlcjsgLy8gbWlsbGlzZWNvbmRzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9hZFRlc3RSZXN1bHQge1xuICB0b3RhbFJlcXVlc3RzOiBudW1iZXI7XG4gIHN1Y2Nlc3NmdWxSZXF1ZXN0czogbnVtYmVyO1xuICBmYWlsZWRSZXF1ZXN0czogbnVtYmVyO1xuICBhdmVyYWdlUmVzcG9uc2VUaW1lOiBudW1iZXI7XG4gIG1pblJlc3BvbnNlVGltZTogbnVtYmVyO1xuICBtYXhSZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgcDk1UmVzcG9uc2VUaW1lOiBudW1iZXI7XG4gIHA5OVJlc3BvbnNlVGltZTogbnVtYmVyO1xuICByZXF1ZXN0c1BlclNlY29uZDogbnVtYmVyO1xuICBlcnJvclJhdGU6IG51bWJlcjtcbiAgc3RhcnRUaW1lOiBudW1iZXI7XG4gIGVuZFRpbWU6IG51bWJlcjtcbiAgZHVyYXRpb246IG51bWJlcjtcbiAgZXJyb3JzOiBBcnJheTx7XG4gICAgZXJyb3I6IHN0cmluZztcbiAgICBjb3VudDogbnVtYmVyO1xuICAgIHBlcmNlbnRhZ2U6IG51bWJlcjtcbiAgfT47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVxdWVzdE1ldHJpY3Mge1xuICBzdGFydFRpbWU6IG51bWJlcjtcbiAgZW5kVGltZTogbnVtYmVyO1xuICByZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgc3RhdHVzQ29kZT86IG51bWJlcjtcbiAgZXJyb3I/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBMb2FkVGVzdFJ1bm5lciB7XG4gIHByaXZhdGUgYXhpb3NJbnN0YW5jZTogQXhpb3NJbnN0YW5jZTtcbiAgcHJpdmF0ZSBjb25maWc6IExvYWRUZXN0Q29uZmlnO1xuICBwcml2YXRlIHJlc3VsdHM6IFJlcXVlc3RNZXRyaWNzW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IExvYWRUZXN0Q29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5heGlvc0luc3RhbmNlID0gKGF4aW9zIGFzIGFueSkuY3JlYXRlKHtcbiAgICAgIGJhc2VVUkw6IGNvbmZpZy5iYXNlVVJMLFxuICAgICAgdGltZW91dDogY29uZmlnLnRpbWVvdXQsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICdVc2VyLUFnZW50JzogJ0xvYWRUZXN0UnVubmVyLzEuMCdcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSdW4gYSBsb2FkIHRlc3Qgd2l0aCBhIHNwZWNpZmljIHJlcXVlc3QgZnVuY3Rpb25cbiAgICovXG4gIGFzeW5jIHJ1bkxvYWRUZXN0KFxuICAgIHJlcXVlc3RGdW5jdGlvbjogKGF4aW9zOiBBeGlvc0luc3RhbmNlKSA9PiBQcm9taXNlPEF4aW9zUmVzcG9uc2U+LFxuICAgIHRlc3ROYW1lOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxMb2FkVGVzdFJlc3VsdD4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5qAIFN0YXJ0aW5nIGxvYWQgdGVzdDogJHt0ZXN0TmFtZX1gKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBDb25maWd1cmF0aW9uOiAke3RoaXMuY29uZmlnLmNvbmN1cnJlbnRVc2Vyc30gdXNlcnMsICR7dGhpcy5jb25maWcucmVxdWVzdHNQZXJVc2VyfSByZXF1ZXN0cyBlYWNoYCk7XG4gICAgXG4gICAgdGhpcy5yZXN1bHRzID0gW107XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICAvLyBDcmVhdGUgdXNlciBncm91cHNcbiAgICBjb25zdCB1c2VyR3JvdXBzID0gdGhpcy5jcmVhdGVVc2VyR3JvdXBzKCk7XG4gICAgXG4gICAgLy8gUnVuIGxvYWQgdGVzdFxuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUxvYWRUZXN0KHVzZXJHcm91cHMsIHJlcXVlc3RGdW5jdGlvbik7XG4gICAgXG4gICAgY29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcblxuICAgIC8vIENhbGN1bGF0ZSByZXN1bHRzXG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5jYWxjdWxhdGVSZXN1bHRzKHN0YXJ0VGltZSwgZW5kVGltZSwgZHVyYXRpb24pO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGDinIUgTG9hZCB0ZXN0IGNvbXBsZXRlZDogJHt0ZXN0TmFtZX1gKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiCBSZXN1bHRzOiAke3Jlc3VsdC5zdWNjZXNzZnVsUmVxdWVzdHN9LyR7cmVzdWx0LnRvdGFsUmVxdWVzdHN9IHN1Y2Nlc3NmdWwgKCR7KHJlc3VsdC5lcnJvclJhdGUgKiAxMDApLnRvRml4ZWQoMil9JSBlcnJvciByYXRlKWApO1xuICAgIGNvbnNvbGUubG9nKGDij7HvuI8gIEF2ZXJhZ2UgcmVzcG9uc2UgdGltZTogJHtyZXN1bHQuYXZlcmFnZVJlc3BvbnNlVGltZS50b0ZpeGVkKDIpfW1zYCk7XG4gICAgY29uc29sZS5sb2coYPCfmoAgUmVxdWVzdHMgcGVyIHNlY29uZDogJHtyZXN1bHQucmVxdWVzdHNQZXJTZWNvbmQudG9GaXhlZCgyKX1gKTtcbiAgICBcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB1c2VyIGdyb3VwcyBmb3IgY29uY3VycmVudCBleGVjdXRpb25cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlVXNlckdyb3VwcygpOiBBcnJheTwoKSA9PiBQcm9taXNlPHZvaWQ+PiB7XG4gICAgY29uc3QgdXNlckdyb3VwczogQXJyYXk8KCkgPT4gUHJvbWlzZTx2b2lkPj4gPSBbXTtcbiAgICBcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY29uZmlnLmNvbmN1cnJlbnRVc2VyczsgaSsrKSB7XG4gICAgICB1c2VyR3JvdXBzLnB1c2goYXN5bmMgKCkgPT4ge1xuICAgICAgICAvLyBSYW1wIHVwIGRlbGF5XG4gICAgICAgIGNvbnN0IHJhbXBVcERlbGF5ID0gKGkgLyB0aGlzLmNvbmZpZy5jb25jdXJyZW50VXNlcnMpICogdGhpcy5jb25maWcucmFtcFVwVGltZTtcbiAgICAgICAgaWYgKHJhbXBVcERlbGF5ID4gMCkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuc2xlZXAocmFtcFVwRGVsYXkpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBFeGVjdXRlIHJlcXVlc3RzIGZvciB0aGlzIHVzZXJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmNvbmZpZy5yZXF1ZXN0c1BlclVzZXI7IGorKykge1xuICAgICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVJlcXVlc3QoKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBZGQgZGVsYXkgYmV0d2VlbiByZXF1ZXN0cyBpZiBuZWVkZWRcbiAgICAgICAgICBpZiAoaiA8IHRoaXMuY29uZmlnLnJlcXVlc3RzUGVyVXNlciAtIDEpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2xlZXAoMTAwKTsgLy8gMTAwbXMgYmV0d2VlbiByZXF1ZXN0c1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB1c2VyR3JvdXBzO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgdGhlIGxvYWQgdGVzdCB3aXRoIGFsbCB1c2VyIGdyb3Vwc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlTG9hZFRlc3QoXG4gICAgdXNlckdyb3VwczogQXJyYXk8KCkgPT4gUHJvbWlzZTx2b2lkPj4sXG4gICAgcmVxdWVzdEZ1bmN0aW9uOiAoYXhpb3M6IEF4aW9zSW5zdGFuY2UpID0+IFByb21pc2U8QXhpb3NSZXNwb25zZT5cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gU3RvcmUgdGhlIHJlcXVlc3QgZnVuY3Rpb24gZm9yIHVzZSBpbiBleGVjdXRlUmVxdWVzdFxuICAgICh0aGlzIGFzIGFueSkucmVxdWVzdEZ1bmN0aW9uID0gcmVxdWVzdEZ1bmN0aW9uO1xuICAgIFxuICAgIC8vIEV4ZWN1dGUgYWxsIHVzZXIgZ3JvdXBzIGNvbmN1cnJlbnRseVxuICAgIGF3YWl0IFByb21pc2UuYWxsKHVzZXJHcm91cHMubWFwKHVzZXJHcm91cCA9PiB1c2VyR3JvdXAoKSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBzaW5nbGUgcmVxdWVzdCBhbmQgcmVjb3JkIG1ldHJpY3NcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVJlcXVlc3QoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgbGV0IGVuZFRpbWU6IG51bWJlcjtcbiAgICBsZXQgc3VjY2VzcyA9IGZhbHNlO1xuICAgIGxldCBzdGF0dXNDb2RlOiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gICAgbGV0IGVycm9yOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCAodGhpcyBhcyBhbnkpLnJlcXVlc3RGdW5jdGlvbih0aGlzLmF4aW9zSW5zdGFuY2UpO1xuICAgICAgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgc3VjY2VzcyA9IHRydWU7XG4gICAgICBzdGF0dXNDb2RlID0gcmVzcG9uc2Uuc3RhdHVzO1xuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBzdWNjZXNzID0gZmFsc2U7XG4gICAgICBzdGF0dXNDb2RlID0gZXJyLnJlc3BvbnNlPy5zdGF0dXM7XG4gICAgICBlcnJvciA9IGVyci5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJztcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZVRpbWUgPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuXG4gICAgdGhpcy5yZXN1bHRzLnB1c2goe1xuICAgICAgc3RhcnRUaW1lLFxuICAgICAgZW5kVGltZSxcbiAgICAgIHJlc3BvbnNlVGltZSxcbiAgICAgIHN1Y2Nlc3MsXG4gICAgICBzdGF0dXNDb2RlLFxuICAgICAgZXJyb3JcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgdGVzdCByZXN1bHRzIGZyb20gbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSZXN1bHRzKHN0YXJ0VGltZTogbnVtYmVyLCBlbmRUaW1lOiBudW1iZXIsIGR1cmF0aW9uOiBudW1iZXIpOiBMb2FkVGVzdFJlc3VsdCB7XG4gICAgY29uc3QgdG90YWxSZXF1ZXN0cyA9IHRoaXMucmVzdWx0cy5sZW5ndGg7XG4gICAgY29uc3Qgc3VjY2Vzc2Z1bFJlcXVlc3RzID0gdGhpcy5yZXN1bHRzLmZpbHRlcihyID0+IHIuc3VjY2VzcykubGVuZ3RoO1xuICAgIGNvbnN0IGZhaWxlZFJlcXVlc3RzID0gdG90YWxSZXF1ZXN0cyAtIHN1Y2Nlc3NmdWxSZXF1ZXN0cztcbiAgICBcbiAgICBjb25zdCByZXNwb25zZVRpbWVzID0gdGhpcy5yZXN1bHRzLm1hcChyID0+IHIucmVzcG9uc2VUaW1lKS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgY29uc3QgYXZlcmFnZVJlc3BvbnNlVGltZSA9IHJlc3BvbnNlVGltZXMucmVkdWNlKChzdW0sIHRpbWUpID0+IHN1bSArIHRpbWUsIDApIC8gdG90YWxSZXF1ZXN0cztcbiAgICBjb25zdCBtaW5SZXNwb25zZVRpbWUgPSByZXNwb25zZVRpbWVzWzBdIHx8IDA7XG4gICAgY29uc3QgbWF4UmVzcG9uc2VUaW1lID0gcmVzcG9uc2VUaW1lc1tyZXNwb25zZVRpbWVzLmxlbmd0aCAtIDFdIHx8IDA7XG4gICAgY29uc3QgcDk1UmVzcG9uc2VUaW1lID0gdGhpcy5wZXJjZW50aWxlKHJlc3BvbnNlVGltZXMsIDk1KTtcbiAgICBjb25zdCBwOTlSZXNwb25zZVRpbWUgPSB0aGlzLnBlcmNlbnRpbGUocmVzcG9uc2VUaW1lcywgOTkpO1xuICAgIFxuICAgIGNvbnN0IHJlcXVlc3RzUGVyU2Vjb25kID0gdG90YWxSZXF1ZXN0cyAvIChkdXJhdGlvbiAvIDEwMDApO1xuICAgIGNvbnN0IGVycm9yUmF0ZSA9IGZhaWxlZFJlcXVlc3RzIC8gdG90YWxSZXF1ZXN0cztcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgZXJyb3IgYnJlYWtkb3duXG4gICAgY29uc3QgZXJyb3JNYXAgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgIHRoaXMucmVzdWx0c1xuICAgICAgLmZpbHRlcihyID0+ICFyLnN1Y2Nlc3MpXG4gICAgICAuZm9yRWFjaChyID0+IHtcbiAgICAgICAgY29uc3QgZXJyb3JLZXkgPSByLmVycm9yIHx8IGBIVFRQICR7ci5zdGF0dXNDb2RlfWA7XG4gICAgICAgIGVycm9yTWFwLnNldChlcnJvcktleSwgKGVycm9yTWFwLmdldChlcnJvcktleSkgfHwgMCkgKyAxKTtcbiAgICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IGVycm9ycyA9IEFycmF5LmZyb20oZXJyb3JNYXAuZW50cmllcygpKS5tYXAoKFtlcnJvciwgY291bnRdKSA9PiAoe1xuICAgICAgZXJyb3IsXG4gICAgICBjb3VudCxcbiAgICAgIHBlcmNlbnRhZ2U6IChjb3VudCAvIHRvdGFsUmVxdWVzdHMpICogMTAwXG4gICAgfSkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsUmVxdWVzdHMsXG4gICAgICBzdWNjZXNzZnVsUmVxdWVzdHMsXG4gICAgICBmYWlsZWRSZXF1ZXN0cyxcbiAgICAgIGF2ZXJhZ2VSZXNwb25zZVRpbWUsXG4gICAgICBtaW5SZXNwb25zZVRpbWUsXG4gICAgICBtYXhSZXNwb25zZVRpbWUsXG4gICAgICBwOTVSZXNwb25zZVRpbWUsXG4gICAgICBwOTlSZXNwb25zZVRpbWUsXG4gICAgICByZXF1ZXN0c1BlclNlY29uZCxcbiAgICAgIGVycm9yUmF0ZSxcbiAgICAgIHN0YXJ0VGltZSxcbiAgICAgIGVuZFRpbWUsXG4gICAgICBkdXJhdGlvbixcbiAgICAgIGVycm9yc1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHBlcmNlbnRpbGUgZnJvbSBzb3J0ZWQgYXJyYXlcbiAgICovXG4gIHByaXZhdGUgcGVyY2VudGlsZShzb3J0ZWRBcnJheTogbnVtYmVyW10sIHBlcmNlbnRpbGU6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgaW5kZXggPSAocGVyY2VudGlsZSAvIDEwMCkgKiAoc29ydGVkQXJyYXkubGVuZ3RoIC0gMSk7XG4gICAgY29uc3QgbG93ZXIgPSBNYXRoLmZsb29yKGluZGV4KTtcbiAgICBjb25zdCB1cHBlciA9IE1hdGguY2VpbChpbmRleCk7XG4gICAgY29uc3Qgd2VpZ2h0ID0gaW5kZXggJSAxO1xuICAgIFxuICAgIGlmICh1cHBlciA+PSBzb3J0ZWRBcnJheS5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBzb3J0ZWRBcnJheVtzb3J0ZWRBcnJheS5sZW5ndGggLSAxXTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHNvcnRlZEFycmF5W2xvd2VyXSAqICgxIC0gd2VpZ2h0KSArIHNvcnRlZEFycmF5W3VwcGVyXSAqIHdlaWdodDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTbGVlcCB1dGlsaXR5IGZ1bmN0aW9uXG4gICAqL1xuICBwcml2YXRlIHNsZWVwKG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYSBkZXRhaWxlZCByZXBvcnRcbiAgICovXG4gIGdlbmVyYXRlUmVwb3J0KHJlc3VsdDogTG9hZFRlc3RSZXN1bHQsIHRlc3ROYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHJlcG9ydCA9IGBcbvCfk4ogTE9BRCBURVNUIFJFUE9SVDogJHt0ZXN0TmFtZX1cbj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxu8J+TiCBTVU1NQVJZXG4tLS0tLS0tLS0tXG5Ub3RhbCBSZXF1ZXN0czogJHtyZXN1bHQudG90YWxSZXF1ZXN0c31cblN1Y2Nlc3NmdWw6ICR7cmVzdWx0LnN1Y2Nlc3NmdWxSZXF1ZXN0c30gKCR7KChyZXN1bHQuc3VjY2Vzc2Z1bFJlcXVlc3RzIC8gcmVzdWx0LnRvdGFsUmVxdWVzdHMpICogMTAwKS50b0ZpeGVkKDIpfSUpXG5GYWlsZWQ6ICR7cmVzdWx0LmZhaWxlZFJlcXVlc3RzfSAoJHsocmVzdWx0LmVycm9yUmF0ZSAqIDEwMCkudG9GaXhlZCgyKX0lKVxuRHVyYXRpb246ICR7KHJlc3VsdC5kdXJhdGlvbiAvIDEwMDApLnRvRml4ZWQoMil9c1xuUmVxdWVzdHMvU2Vjb25kOiAke3Jlc3VsdC5yZXF1ZXN0c1BlclNlY29uZC50b0ZpeGVkKDIpfVxuXG7ij7HvuI8gIFJFU1BPTlNFIFRJTUVTXG4tLS0tLS0tLS0tLS0tLS0tLS1cbkF2ZXJhZ2U6ICR7cmVzdWx0LmF2ZXJhZ2VSZXNwb25zZVRpbWUudG9GaXhlZCgyKX1tc1xuTWluaW11bTogJHtyZXN1bHQubWluUmVzcG9uc2VUaW1lLnRvRml4ZWQoMil9bXNcbk1heGltdW06ICR7cmVzdWx0Lm1heFJlc3BvbnNlVGltZS50b0ZpeGVkKDIpfW1zXG45NXRoIFBlcmNlbnRpbGU6ICR7cmVzdWx0LnA5NVJlc3BvbnNlVGltZS50b0ZpeGVkKDIpfW1zXG45OXRoIFBlcmNlbnRpbGU6ICR7cmVzdWx0LnA5OVJlc3BvbnNlVGltZS50b0ZpeGVkKDIpfW1zXG5cbuKdjCBFUlJPUlNcbi0tLS0tLS0tLVxuJHtyZXN1bHQuZXJyb3JzLmxlbmd0aCA+IDAgPyByZXN1bHQuZXJyb3JzLm1hcChlID0+IGAke2UuZXJyb3J9OiAke2UuY291bnR9ICgke2UucGVyY2VudGFnZS50b0ZpeGVkKDIpfSUpYCkuam9pbignXFxuJykgOiAnTm8gZXJyb3JzJ31cblxu8J+OryBQRVJGT1JNQU5DRSBUQVJHRVRTXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG7inIUgUmVzcG9uc2UgVGltZSA8IDIwMDBtczogJHtyZXN1bHQuYXZlcmFnZVJlc3BvbnNlVGltZSA8IDIwMDAgPyAnUEFTUycgOiAnRkFJTCd9XG7inIUgRXJyb3IgUmF0ZSA8IDElOiAke3Jlc3VsdC5lcnJvclJhdGUgPCAwLjAxID8gJ1BBU1MnIDogJ0ZBSUwnfVxu4pyFIFJQUyA+IDEwOiAke3Jlc3VsdC5yZXF1ZXN0c1BlclNlY29uZCA+IDEwID8gJ1BBU1MnIDogJ0ZBSUwnfVxuYDtcblxuICAgIHJldHVybiByZXBvcnQ7XG4gIH1cbn1cblxuLyoqXG4gKiBQZXJmb3JtYW5jZSBiZW5jaG1hcmtpbmcgdXRpbGl0eVxuICovXG5leHBvcnQgY2xhc3MgUGVyZm9ybWFuY2VCZW5jaG1hcmsge1xuICBwcml2YXRlIHJlc3VsdHM6IE1hcDxzdHJpbmcsIG51bWJlcltdPiA9IG5ldyBNYXAoKTtcblxuICAvKipcbiAgICogTWVhc3VyZSBleGVjdXRpb24gdGltZSBvZiBhIGZ1bmN0aW9uXG4gICAqL1xuICBhc3luYyBtZWFzdXJlPFQ+KG5hbWU6IHN0cmluZywgZm46ICgpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmbigpO1xuICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBjb25zdCBkdXJhdGlvbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG5cbiAgICBpZiAoIXRoaXMucmVzdWx0cy5oYXMobmFtZSkpIHtcbiAgICAgIHRoaXMucmVzdWx0cy5zZXQobmFtZSwgW10pO1xuICAgIH1cbiAgICB0aGlzLnJlc3VsdHMuZ2V0KG5hbWUpIS5wdXNoKGR1cmF0aW9uKTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGJlbmNobWFyayByZXN1bHRzXG4gICAqL1xuICBnZXRSZXN1bHRzKCk6IE1hcDxzdHJpbmcsIHsgYXZlcmFnZTogbnVtYmVyOyBtaW46IG51bWJlcjsgbWF4OiBudW1iZXI7IGNvdW50OiBudW1iZXIgfT4ge1xuICAgIGNvbnN0IGJlbmNobWFya1Jlc3VsdHMgPSBuZXcgTWFwKCk7XG4gICAgXG4gICAgZm9yIChjb25zdCBbbmFtZSwgdGltZXNdIG9mIHRoaXMucmVzdWx0cy5lbnRyaWVzKCkpIHtcbiAgICAgIGNvbnN0IHNvcnRlZCA9IHRpbWVzLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcbiAgICAgIGJlbmNobWFya1Jlc3VsdHMuc2V0KG5hbWUsIHtcbiAgICAgICAgYXZlcmFnZTogdGltZXMucmVkdWNlKChzdW0sIHRpbWUpID0+IHN1bSArIHRpbWUsIDApIC8gdGltZXMubGVuZ3RoLFxuICAgICAgICBtaW46IHNvcnRlZFswXSxcbiAgICAgICAgbWF4OiBzb3J0ZWRbc29ydGVkLmxlbmd0aCAtIDFdLFxuICAgICAgICBjb3VudDogdGltZXMubGVuZ3RoXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGJlbmNobWFya1Jlc3VsdHM7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYmVuY2htYXJrIHJlcG9ydFxuICAgKi9cbiAgZ2VuZXJhdGVSZXBvcnQoKTogc3RyaW5nIHtcbiAgICBjb25zdCByZXN1bHRzID0gdGhpcy5nZXRSZXN1bHRzKCk7XG4gICAgbGV0IHJlcG9ydCA9ICdcXG7wn4+BIFBFUkZPUk1BTkNFIEJFTkNITUFSSyBSRVBPUlRcXG49PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxcblxcbic7XG4gICAgXG4gICAgZm9yIChjb25zdCBbbmFtZSwgc3RhdHNdIG9mIHJlc3VsdHMuZW50cmllcygpKSB7XG4gICAgICByZXBvcnQgKz0gYPCfk4ogJHtuYW1lfVxcbmA7XG4gICAgICByZXBvcnQgKz0gYCAgIEF2ZXJhZ2U6ICR7c3RhdHMuYXZlcmFnZS50b0ZpeGVkKDIpfW1zXFxuYDtcbiAgICAgIHJlcG9ydCArPSBgICAgTWluOiAke3N0YXRzLm1pbi50b0ZpeGVkKDIpfW1zXFxuYDtcbiAgICAgIHJlcG9ydCArPSBgICAgTWF4OiAke3N0YXRzLm1heC50b0ZpeGVkKDIpfW1zXFxuYDtcbiAgICAgIHJlcG9ydCArPSBgICAgU2FtcGxlczogJHtzdGF0cy5jb3VudH1cXG5cXG5gO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVwb3J0O1xuICB9XG59XG5cbi8qKlxuICogRGF0YWJhc2UgcGVyZm9ybWFuY2UgdGVzdGluZyB1dGlsaXR5XG4gKi9cbmV4cG9ydCBjbGFzcyBEYXRhYmFzZVBlcmZvcm1hbmNlVGVzdCB7XG4gIHByaXZhdGUgcG9vbDogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHBvb2w6IGFueSkge1xuICAgIHRoaXMucG9vbCA9IHBvb2w7XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBxdWVyeSBwZXJmb3JtYW5jZVxuICAgKi9cbiAgYXN5bmMgdGVzdFF1ZXJ5UGVyZm9ybWFuY2UocXVlcnk6IHN0cmluZywgcGFyYW1zOiBhbnlbXSA9IFtdLCBpdGVyYXRpb25zOiBudW1iZXIgPSAxMDApOiBQcm9taXNlPHtcbiAgICBhdmVyYWdlVGltZTogbnVtYmVyO1xuICAgIG1pblRpbWU6IG51bWJlcjtcbiAgICBtYXhUaW1lOiBudW1iZXI7XG4gICAgdG90YWxUaW1lOiBudW1iZXI7XG4gIH0+IHtcbiAgICBjb25zdCB0aW1lczogbnVtYmVyW10gPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGF3YWl0IHRoaXMucG9vbC5xdWVyeShxdWVyeSwgcGFyYW1zKTtcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIHRpbWVzLnB1c2goZW5kVGltZSAtIHN0YXJ0VGltZSk7XG4gICAgfVxuXG4gICAgY29uc3Qgc29ydGVkID0gdGltZXMuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICAgIHJldHVybiB7XG4gICAgICBhdmVyYWdlVGltZTogdGltZXMucmVkdWNlKChzdW0sIHRpbWUpID0+IHN1bSArIHRpbWUsIDApIC8gdGltZXMubGVuZ3RoLFxuICAgICAgbWluVGltZTogc29ydGVkWzBdLFxuICAgICAgbWF4VGltZTogc29ydGVkW3NvcnRlZC5sZW5ndGggLSAxXSxcbiAgICAgIHRvdGFsVGltZTogdGltZXMucmVkdWNlKChzdW0sIHRpbWUpID0+IHN1bSArIHRpbWUsIDApXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUZXN0IGNvbmN1cnJlbnQgcXVlcnkgcGVyZm9ybWFuY2VcbiAgICovXG4gIGFzeW5jIHRlc3RDb25jdXJyZW50UXVlcnlQZXJmb3JtYW5jZShcbiAgICBxdWVyeTogc3RyaW5nLCBcbiAgICBwYXJhbXM6IGFueVtdID0gW10sIFxuICAgIGNvbmN1cnJlbnRRdWVyaWVzOiBudW1iZXIgPSAxMCxcbiAgICBpdGVyYXRpb25zOiBudW1iZXIgPSAxMFxuICApOiBQcm9taXNlPHtcbiAgICBhdmVyYWdlVGltZTogbnVtYmVyO1xuICAgIG1pblRpbWU6IG51bWJlcjtcbiAgICBtYXhUaW1lOiBudW1iZXI7XG4gICAgdG90YWxUaW1lOiBudW1iZXI7XG4gICAgcXVlcmllc1BlclNlY29uZDogbnVtYmVyO1xuICB9PiB7XG4gICAgY29uc3QgdGltZXM6IG51bWJlcltdID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZXJhdGlvbnM7IGkrKykge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBcbiAgICAgIC8vIEV4ZWN1dGUgY29uY3VycmVudCBxdWVyaWVzXG4gICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5KGNvbmN1cnJlbnRRdWVyaWVzKS5maWxsKG51bGwpLm1hcCgoKSA9PiBcbiAgICAgICAgdGhpcy5wb29sLnF1ZXJ5KHF1ZXJ5LCBwYXJhbXMpXG4gICAgICApO1xuICAgICAgXG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICB0aW1lcy5wdXNoKGVuZFRpbWUgLSBzdGFydFRpbWUpO1xuICAgIH1cblxuICAgIGNvbnN0IHNvcnRlZCA9IHRpbWVzLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcbiAgICBjb25zdCBhdmVyYWdlVGltZSA9IHRpbWVzLnJlZHVjZSgoc3VtLCB0aW1lKSA9PiBzdW0gKyB0aW1lLCAwKSAvIHRpbWVzLmxlbmd0aDtcbiAgICBjb25zdCB0b3RhbFRpbWUgPSB0aW1lcy5yZWR1Y2UoKHN1bSwgdGltZSkgPT4gc3VtICsgdGltZSwgMCk7XG4gICAgY29uc3QgcXVlcmllc1BlclNlY29uZCA9IChjb25jdXJyZW50UXVlcmllcyAqIGl0ZXJhdGlvbnMpIC8gKHRvdGFsVGltZSAvIDEwMDApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGF2ZXJhZ2VUaW1lLFxuICAgICAgbWluVGltZTogc29ydGVkWzBdLFxuICAgICAgbWF4VGltZTogc29ydGVkW3NvcnRlZC5sZW5ndGggLSAxXSxcbiAgICAgIHRvdGFsVGltZSxcbiAgICAgIHF1ZXJpZXNQZXJTZWNvbmRcbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=