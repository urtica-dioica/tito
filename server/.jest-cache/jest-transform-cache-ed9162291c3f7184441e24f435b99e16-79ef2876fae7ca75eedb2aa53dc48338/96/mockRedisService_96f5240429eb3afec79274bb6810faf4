6b7bed6c0b64e519dd3983208ef6e619
"use strict";
/**
 * Mock Redis Service for Testing
 *
 * This mock service provides the same interface as the real Redis service
 * but stores data in memory instead of connecting to Redis.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockRedisService = exports.MockRedisService = void 0;
class MockRedisService {
    constructor() {
        this.data = {};
        this.isConnected = true;
        // Simulate connection delay
        this.connect();
    }
    async connect() {
        this.isConnected = true;
    }
    async disconnect() {
        this.isConnected = false;
    }
    async isRedisConnected() {
        return this.isConnected;
    }
    async getCache(key) {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        const item = this.data[key];
        if (!item) {
            return null;
        }
        // Check if expired
        if (item.expiresAt && Date.now() > item.expiresAt) {
            delete this.data[key];
            return null;
        }
        return item.value;
    }
    async setCache(key, value, ttlSeconds) {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        const expiresAt = ttlSeconds ? Date.now() + (ttlSeconds * 1000) : undefined;
        this.data[key] = {
            value,
            ttl: ttlSeconds,
            expiresAt
        };
    }
    async deleteCache(key) {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        delete this.data[key];
    }
    async flushDb() {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        this.data = {};
    }
    async exists(key) {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        const item = this.data[key];
        if (!item) {
            return false;
        }
        // Check if expired
        if (item.expiresAt && Date.now() > item.expiresAt) {
            delete this.data[key];
            return false;
        }
        return true;
    }
    async keys(pattern) {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        const regex = new RegExp(pattern.replace(/\*/g, '.*'));
        return Object.keys(this.data).filter(key => regex.test(key));
    }
    async expire(key, ttlSeconds) {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        const item = this.data[key];
        if (!item) {
            return false;
        }
        item.ttl = ttlSeconds;
        item.expiresAt = Date.now() + (ttlSeconds * 1000);
        return true;
    }
    async ttl(key) {
        if (!this.isConnected) {
            throw new Error('Redis client is not connected');
        }
        const item = this.data[key];
        if (!item || !item.expiresAt) {
            return -1; // No expiration
        }
        const remaining = Math.ceil((item.expiresAt - Date.now()) / 1000);
        return remaining > 0 ? remaining : -2; // Expired
    }
    // Test utilities
    getData() {
        return { ...this.data };
    }
    clearData() {
        this.data = {};
    }
    setConnected(connected) {
        this.isConnected = connected;
    }
    // Simulate Redis connection issues for testing
    simulateConnectionError() {
        this.isConnected = false;
    }
    simulateConnectionRecovery() {
        this.isConnected = true;
    }
}
exports.MockRedisService = MockRedisService;
// Singleton instance for tests
exports.mockRedisService = new MockRedisService();
// Export for use in tests
exports.default = exports.mockRedisService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva2ltL3RpdG8vc2VydmVyL3Rlc3RzL3V0aWxzL21vY2tSZWRpc1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUFVSCxNQUFhLGdCQUFnQjtJQUkzQjtRQUhRLFNBQUksR0FBa0IsRUFBRSxDQUFDO1FBQ3pCLGdCQUFXLEdBQVksSUFBSSxDQUFDO1FBR2xDLDRCQUE0QjtRQUM1QixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakIsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPO1FBQ1gsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7SUFDMUIsQ0FBQztJQUVELEtBQUssQ0FBQyxVQUFVO1FBQ2QsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7SUFDM0IsQ0FBQztJQUVELEtBQUssQ0FBQyxnQkFBZ0I7UUFDcEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7SUFFRCxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQVc7UUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN0QixNQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDLENBQUM7UUFDbkQsQ0FBQztRQUVELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ1YsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsbUJBQW1CO1FBQ25CLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ2xELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QixPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDcEIsQ0FBQztJQUVELEtBQUssQ0FBQyxRQUFRLENBQUMsR0FB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Q0FvSkM7QUFFRCwrQkFBK0I7QUFDbEIsUUFBQSxnQkFBZ0IsR0FBRyxJQUFJLGdCQUFnQixFQUFFLENBQUM7QUFFdkQsMEJBQTBCO0FBQzFCLGtCQUFlLHdCQUFnQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2tpbS90aXRvL3NlcnZlci90ZXN0cy91dGlscy9tb2NrUmVkaXNTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9jayBSZWRpcyBTZXJ2aWNlIGZvciBUZXN0aW5nXG4gKiBcbiAqIFRoaXMgbW9jayBzZXJ2aWNlIHByb3ZpZGVzIHRoZSBzYW1lIGludGVyZmFjZSBhcyB0aGUgcmVhbCBSZWRpcyBzZXJ2aWNlXG4gKiBidXQgc3RvcmVzIGRhdGEgaW4gbWVtb3J5IGluc3RlYWQgb2YgY29ubmVjdGluZyB0byBSZWRpcy5cbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIE1vY2tSZWRpc0RhdGEge1xuICBba2V5OiBzdHJpbmddOiB7XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICB0dGw/OiBudW1iZXI7XG4gICAgZXhwaXJlc0F0PzogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgY2xhc3MgTW9ja1JlZGlzU2VydmljZSB7XG4gIHByaXZhdGUgZGF0YTogTW9ja1JlZGlzRGF0YSA9IHt9O1xuICBwcml2YXRlIGlzQ29ubmVjdGVkOiBib29sZWFuID0gdHJ1ZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBTaW11bGF0ZSBjb25uZWN0aW9uIGRlbGF5XG4gICAgdGhpcy5jb25uZWN0KCk7XG4gIH1cblxuICBhc3luYyBjb25uZWN0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuaXNDb25uZWN0ZWQgPSB0cnVlO1xuICB9XG5cbiAgYXN5bmMgZGlzY29ubmVjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gIH1cblxuICBhc3luYyBpc1JlZGlzQ29ubmVjdGVkKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmlzQ29ubmVjdGVkO1xuICB9XG5cbiAgYXN5bmMgZ2V0Q2FjaGUoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICBpZiAoIXRoaXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkaXMgY2xpZW50IGlzIG5vdCBjb25uZWN0ZWQnKTtcbiAgICB9XG5cbiAgICBjb25zdCBpdGVtID0gdGhpcy5kYXRhW2tleV07XG4gICAgaWYgKCFpdGVtKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBleHBpcmVkXG4gICAgaWYgKGl0ZW0uZXhwaXJlc0F0ICYmIERhdGUubm93KCkgPiBpdGVtLmV4cGlyZXNBdCkge1xuICAgICAgZGVsZXRlIHRoaXMuZGF0YVtrZXldO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGl0ZW0udmFsdWU7XG4gIH1cblxuICBhc3luYyBzZXRDYWNoZShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZywgdHRsU2Vjb25kcz86IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5pc0Nvbm5lY3RlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWRpcyBjbGllbnQgaXMgbm90IGNvbm5lY3RlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IHR0bFNlY29uZHMgPyBEYXRlLm5vdygpICsgKHR0bFNlY29uZHMgKiAxMDAwKSA6IHVuZGVmaW5lZDtcbiAgICBcbiAgICB0aGlzLmRhdGFba2V5XSA9IHtcbiAgICAgIHZhbHVlLFxuICAgICAgdHRsOiB0dGxTZWNvbmRzLFxuICAgICAgZXhwaXJlc0F0XG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUNhY2hlKGtleTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmlzQ29ubmVjdGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZGlzIGNsaWVudCBpcyBub3QgY29ubmVjdGVkJyk7XG4gICAgfVxuXG4gICAgZGVsZXRlIHRoaXMuZGF0YVtrZXldO1xuICB9XG5cbiAgYXN5bmMgZmx1c2hEYigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuaXNDb25uZWN0ZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVkaXMgY2xpZW50IGlzIG5vdCBjb25uZWN0ZWQnKTtcbiAgICB9XG5cbiAgICB0aGlzLmRhdGEgPSB7fTtcbiAgfVxuXG4gIGFzeW5jIGV4aXN0cyhrZXk6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5pc0Nvbm5lY3RlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWRpcyBjbGllbnQgaXMgbm90IGNvbm5lY3RlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmRhdGFba2V5XTtcbiAgICBpZiAoIWl0ZW0pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBleHBpcmVkXG4gICAgaWYgKGl0ZW0uZXhwaXJlc0F0ICYmIERhdGUubm93KCkgPiBpdGVtLmV4cGlyZXNBdCkge1xuICAgICAgZGVsZXRlIHRoaXMuZGF0YVtrZXldO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgYXN5bmMga2V5cyhwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgaWYgKCF0aGlzLmlzQ29ubmVjdGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZGlzIGNsaWVudCBpcyBub3QgY29ubmVjdGVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4ucmVwbGFjZSgvXFwqL2csICcuKicpKTtcbiAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5kYXRhKS5maWx0ZXIoa2V5ID0+IHJlZ2V4LnRlc3Qoa2V5KSk7XG4gIH1cblxuICBhc3luYyBleHBpcmUoa2V5OiBzdHJpbmcsIHR0bFNlY29uZHM6IG51bWJlcik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmICghdGhpcy5pc0Nvbm5lY3RlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWRpcyBjbGllbnQgaXMgbm90IGNvbm5lY3RlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmRhdGFba2V5XTtcbiAgICBpZiAoIWl0ZW0pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpdGVtLnR0bCA9IHR0bFNlY29uZHM7XG4gICAgaXRlbS5leHBpcmVzQXQgPSBEYXRlLm5vdygpICsgKHR0bFNlY29uZHMgKiAxMDAwKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGFzeW5jIHR0bChrZXk6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgaWYgKCF0aGlzLmlzQ29ubmVjdGVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZGlzIGNsaWVudCBpcyBub3QgY29ubmVjdGVkJyk7XG4gICAgfVxuXG4gICAgY29uc3QgaXRlbSA9IHRoaXMuZGF0YVtrZXldO1xuICAgIGlmICghaXRlbSB8fCAhaXRlbS5leHBpcmVzQXQpIHtcbiAgICAgIHJldHVybiAtMTsgLy8gTm8gZXhwaXJhdGlvblxuICAgIH1cblxuICAgIGNvbnN0IHJlbWFpbmluZyA9IE1hdGguY2VpbCgoaXRlbS5leHBpcmVzQXQgLSBEYXRlLm5vdygpKSAvIDEwMDApO1xuICAgIHJldHVybiByZW1haW5pbmcgPiAwID8gcmVtYWluaW5nIDogLTI7IC8vIEV4cGlyZWRcbiAgfVxuXG4gIC8vIFRlc3QgdXRpbGl0aWVzXG4gIGdldERhdGEoKTogTW9ja1JlZGlzRGF0YSB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5kYXRhIH07XG4gIH1cblxuICBjbGVhckRhdGEoKTogdm9pZCB7XG4gICAgdGhpcy5kYXRhID0ge307XG4gIH1cblxuICBzZXRDb25uZWN0ZWQoY29ubmVjdGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGNvbm5lY3RlZDtcbiAgfVxuXG4gIC8vIFNpbXVsYXRlIFJlZGlzIGNvbm5lY3Rpb24gaXNzdWVzIGZvciB0ZXN0aW5nXG4gIHNpbXVsYXRlQ29ubmVjdGlvbkVycm9yKCk6IHZvaWQge1xuICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHNpbXVsYXRlQ29ubmVjdGlvblJlY292ZXJ5KCk6IHZvaWQge1xuICAgIHRoaXMuaXNDb25uZWN0ZWQgPSB0cnVlO1xuICB9XG59XG5cbi8vIFNpbmdsZXRvbiBpbnN0YW5jZSBmb3IgdGVzdHNcbmV4cG9ydCBjb25zdCBtb2NrUmVkaXNTZXJ2aWNlID0gbmV3IE1vY2tSZWRpc1NlcnZpY2UoKTtcblxuLy8gRXhwb3J0IGZvciB1c2UgaW4gdGVzdHNcbmV4cG9ydCBkZWZhdWx0IG1vY2tSZWRpc1NlcnZpY2U7XG4iXSwidmVyc2lvbiI6M30=