7c305c8cab70fd67a68eefdca36e3899
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const attendanceService_1 = require("../../../src/services/attendance/attendanceService");
const testHelpers_1 = require("../../utils/testHelpers");
const setup_1 = require("../../setup");
describe('AttendanceService', () => {
    let testHelpers;
    let createdUserIds = [];
    let createdEmployeeIds = [];
    let createdDepartmentIds = [];
    beforeAll(async () => {
        const { testDbPool } = await (0, setup_1.initializeTestConnections)();
        testHelpers = new testHelpers_1.TestHelpers(testDbPool);
    });
    afterEach(async () => {
        // Clean up created data after each test
        for (const employeeId of createdEmployeeIds) {
            try {
                await testHelpers.deleteEmployee(employeeId);
            }
            catch (error) {
                // Ignore cleanup errors
            }
        }
        for (const userId of createdUserIds) {
            try {
                await testHelpers.deleteUser(userId);
            }
            catch (error) {
                // Ignore cleanup errors
            }
        }
        for (const departmentId of createdDepartmentIds) {
            try {
                await testHelpers.deleteDepartment(departmentId);
            }
            catch (error) {
                // Ignore cleanup errors
            }
        }
        createdUserIds = [];
        createdEmployeeIds = [];
        createdDepartmentIds = [];
    });
    describe('clockIn', () => {
        it('should successfully clock in employee', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            const clockInData = {
                employeeId: employee.id,
                qrCodeHash: 'test-qr-hash',
                timestamp: new Date('2025-01-15T08:00:00Z'),
                selfieImagePath: '/uploads/selfies/test-selfie.jpg'
            };
            // Act
            const result = await attendanceService_1.attendanceService.clockIn(clockInData);
            // Assert
            expect(result).toHaveProperty('employeeId');
            expect(result).toHaveProperty('date');
            expect(result).toHaveProperty('sessions');
            expect(result.employeeId).toBe(employee.id);
        });
        it('should handle clock in for non-existent employee', async () => {
            // Arrange
            const clockInData = {
                employeeId: 'non-existent-id',
                qrCodeHash: 'test-qr-hash',
                timestamp: new Date('2025-01-15T08:00:00Z'),
                selfieImagePath: '/uploads/selfies/test-selfie.jpg'
            };
            // Act & Assert
            await expect(attendanceService_1.attendanceService.clockIn(clockInData)).rejects.toThrow('Employee not found');
        });
    });
    describe('clockOut', () => {
        it('should successfully clock out employee', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            // First clock in
            const clockInData = {
                employeeId: employee.id,
                qrCodeHash: 'test-qr-hash',
                timestamp: new Date('2025-01-15T08:00:00Z'),
                selfieImagePath: '/uploads/selfies/test-selfie.jpg'
            };
            await attendanceService_1.attendanceService.clockIn(clockInData);
            const clockOutData = {
                employeeId: employee.id,
                qrCodeHash: 'test-qr-hash',
                timestamp: new Date('2025-01-15T12:00:00Z'),
                selfieImagePath: '/uploads/selfies/test-selfie-out.jpg'
            };
            // Act
            const result = await attendanceService_1.attendanceService.clockOut(clockOutData);
            // Assert
            expect(result).toHaveProperty('employeeId');
            expect(result).toHaveProperty('totalHours');
            expect(result.totalHours).toBeGreaterThan(0);
        });
        it('should handle clock out without clock in', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            const clockOutData = {
                employeeId: employee.id,
                qrCodeHash: 'test-qr-hash',
                timestamp: new Date('2025-01-15T12:00:00Z'),
                selfieImagePath: '/uploads/selfies/test-selfie-out.jpg'
            };
            // Act & Assert
            await expect(attendanceService_1.attendanceService.clockOut(clockOutData)).rejects.toThrow();
        });
    });
    describe('getAttendanceSummary', () => {
        it('should get attendance summary for employee and date', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            const date = new Date('2025-01-15');
            // Act
            const result = await attendanceService_1.attendanceService.getAttendanceSummary(employee.id, date);
            // Assert
            expect(result).toHaveProperty('employeeId');
            expect(result).toHaveProperty('date');
            expect(result.employeeId).toBe(employee.id);
        });
    });
    describe('getEmployeeAttendanceHistory', () => {
        it('should get attendance history for employee', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            const startDate = new Date('2025-01-01');
            const endDate = new Date('2025-01-31');
            // Act
            const result = await attendanceService_1.attendanceService.getEmployeeAttendanceHistory(employee.id, startDate, endDate);
            // Assert
            expect(Array.isArray(result)).toBe(true);
        });
    });
    describe('getEmployeeAttendanceStats', () => {
        it('should get attendance stats for employee', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            const startDate = new Date('2025-01-01');
            const endDate = new Date('2025-01-31');
            // Act
            const result = await attendanceService_1.attendanceService.getEmployeeAttendanceStats(employee.id, startDate, endDate);
            // Assert
            expect(result).toHaveProperty('totalDays');
            expect(result).toHaveProperty('presentDays');
            expect(result).toHaveProperty('lateDays');
            expect(result).toHaveProperty('absentDays');
            expect(result).toHaveProperty('totalHours');
            expect(typeof result.totalDays).toBe('number');
            expect(typeof result.presentDays).toBe('number');
            expect(typeof result.lateDays).toBe('number');
            expect(typeof result.absentDays).toBe('number');
            expect(typeof result.totalHours).toBe('number');
        });
    });
    describe('getAttendanceRecords', () => {
        it('should get attendance records', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            const startDate = new Date('2025-01-01');
            const endDate = new Date('2025-01-31');
            // Act
            const result = await attendanceService_1.attendanceService.getAttendanceRecords(startDate, endDate);
            // Assert
            expect(result).toHaveProperty('records');
            expect(result).toHaveProperty('total');
            expect(Array.isArray(result.records)).toBe(true);
            expect(typeof result.total).toBe('number');
        });
    });
    describe('validateAttendanceAction', () => {
        it('should validate attendance action', async () => {
            // Act
            const result = await attendanceService_1.attendanceService.validateAttendanceAction('valid-employee-id', 'morning_in');
            // Assert
            expect(result).toHaveProperty('canPerform');
            expect(typeof result.canPerform).toBe('boolean');
        });
    });
    describe('verifyQRCode', () => {
        it('should verify QR code', async () => {
            // Act
            const result = await attendanceService_1.attendanceService.verifyQRCode('test-qr-hash');
            // Assert
            expect(result).toHaveProperty('isValid');
            expect(typeof result.isValid).toBe('boolean');
        });
    });
    describe('getCurrentAttendanceStatus', () => {
        it('should get current attendance status', async () => {
            // Arrange
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            const employee = await testHelpers.createTestEmployee({
                departmentId: department.id,
                employmentType: 'regular'
            });
            createdEmployeeIds.push(employee.id);
            createdUserIds.push(employee.userId);
            // Act
            const result = await attendanceService_1.attendanceService.getCurrentAttendanceStatus(employee.id);
            // Assert
            expect(result).toHaveProperty('isClockedIn');
            expect(result).toHaveProperty('currentSession');
            expect(typeof result.isClockedIn).toBe('boolean');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva2ltL3RpdG8vc2VydmVyL3Rlc3RzL3VuaXQvc2VydmljZXMvYXR0ZW5kYW5jZVNlcnZpY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDBGQUF1RjtBQUN2Rix5REFBc0Q7QUFDdEQsdUNBQXdEO0FBRXhELFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxXQUF3QixDQUFDO0lBQzdCLElBQUksY0FBYyxHQUFhLEVBQUUsQ0FBQztJQUNsQyxJQUFJLGtCQUFrQixHQUFhLEVBQUUsQ0FBQztJQUN0QyxJQUFJLG9CQUFvQixHQUFhLEVBQUUsQ0FBQztJQUV4QyxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxFQUFFLFVBQVUsRUFBRSxHQUFHLE1BQU0sSUFBQSxpQ0FBeUIsR0FBRSxDQUFDO1FBQ3pELFdBQVcsR0FBRyxJQUFJLHlCQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsd0NBQXdDO1FBQ3hDLEtBQUssTUFBTSxVQUFVLElBQUksa0JBQWtCLEVBQUUsQ0FBQztZQUM1QyxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxXQUFXLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQy9DLENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNmLHdCQUF3QjtZQUMxQixDQUFDO1FBQ0gsQ0FBQztRQUNELEtBQUssTUFBTSxNQUFNLElBQUksY0FBYyxFQUFFLENBQUM7WUFDcEMsSUFBSSxDQUFDO2dCQUNILE1BQU0sV0FBVyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN2QyxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZix3QkFBd0I7WUFDMUIsQ0FBQztRQUNILENBQUM7UUFDRCxLQUFLLE1BQU0sWUFBWSxJQUFJLG9CQUFvQixFQUFFLENBQUM7WUFDaEQsSUFBSSxDQUFDO2dCQUNILE1B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QUVyQyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxxQ0FBaUIsQ0FBQywwQkFBMEIsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFL0UsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxPQUFPLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDcEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2tpbS90aXRvL3NlcnZlci90ZXN0cy91bml0L3NlcnZpY2VzL2F0dGVuZGFuY2VTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXR0ZW5kYW5jZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zcmMvc2VydmljZXMvYXR0ZW5kYW5jZS9hdHRlbmRhbmNlU2VydmljZSc7XG5pbXBvcnQgeyBUZXN0SGVscGVycyB9IGZyb20gJy4uLy4uL3V0aWxzL3Rlc3RIZWxwZXJzJztcbmltcG9ydCB7IGluaXRpYWxpemVUZXN0Q29ubmVjdGlvbnMgfSBmcm9tICcuLi8uLi9zZXR1cCc7XG5cbmRlc2NyaWJlKCdBdHRlbmRhbmNlU2VydmljZScsICgpID0+IHtcbiAgbGV0IHRlc3RIZWxwZXJzOiBUZXN0SGVscGVycztcbiAgbGV0IGNyZWF0ZWRVc2VySWRzOiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgY3JlYXRlZEVtcGxveWVlSWRzOiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgY3JlYXRlZERlcGFydG1lbnRJZHM6IHN0cmluZ1tdID0gW107XG5cbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7IHRlc3REYlBvb2wgfSA9IGF3YWl0IGluaXRpYWxpemVUZXN0Q29ubmVjdGlvbnMoKTtcbiAgICB0ZXN0SGVscGVycyA9IG5ldyBUZXN0SGVscGVycyh0ZXN0RGJQb29sKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCBjcmVhdGVkIGRhdGEgYWZ0ZXIgZWFjaCB0ZXN0XG4gICAgZm9yIChjb25zdCBlbXBsb3llZUlkIG9mIGNyZWF0ZWRFbXBsb3llZUlkcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGVzdEhlbHBlcnMuZGVsZXRlRW1wbG95ZWUoZW1wbG95ZWVJZCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBJZ25vcmUgY2xlYW51cCBlcnJvcnNcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCB1c2VySWQgb2YgY3JlYXRlZFVzZXJJZHMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRlc3RIZWxwZXJzLmRlbGV0ZVVzZXIodXNlcklkKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIElnbm9yZSBjbGVhbnVwIGVycm9yc1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGNvbnN0IGRlcGFydG1lbnRJZCBvZiBjcmVhdGVkRGVwYXJ0bWVudElkcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGVzdEhlbHBlcnMuZGVsZXRlRGVwYXJ0bWVudChkZXBhcnRtZW50SWQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gSWdub3JlIGNsZWFudXAgZXJyb3JzXG4gICAgICB9XG4gICAgfVxuICAgIGNyZWF0ZWRVc2VySWRzID0gW107XG4gICAgY3JlYXRlZEVtcGxveWVlSWRzID0gW107XG4gICAgY3JlYXRlZERlcGFydG1lbnRJZHMgPSBbXTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Nsb2NrSW4nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgY2xvY2sgaW4gZW1wbG95ZWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkZXBhcnRtZW50ID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdERlcGFydG1lbnQoKTtcbiAgICAgIGNyZWF0ZWREZXBhcnRtZW50SWRzLnB1c2goZGVwYXJ0bWVudC5pZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGVtcGxveWVlID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdEVtcGxveWVlKHtcbiAgICAgICAgZGVwYXJ0bWVudElkOiBkZXBhcnRtZW50LmlkLFxuICAgICAgICBlbXBsb3ltZW50VHlwZTogJ3JlZ3VsYXInXG4gICAgICB9KTtcbiAgICAgIGNyZWF0ZWRFbXBsb3llZUlkcy5wdXNoKGVtcGxveWVlLmlkKTtcbiAgICAgIGNyZWF0ZWRVc2VySWRzLnB1c2goZW1wbG95ZWUudXNlcklkKTtcblxuICAgICAgY29uc3QgY2xvY2tJbkRhdGEgPSB7XG4gICAgICAgIGVtcGxveWVlSWQ6IGVtcGxveWVlLmlkLFxuICAgICAgICBxckNvZGVIYXNoOiAndGVzdC1xci1oYXNoJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgnMjAyNS0wMS0xNVQwODowMDowMFonKSxcbiAgICAgICAgc2VsZmllSW1hZ2VQYXRoOiAnL3VwbG9hZHMvc2VsZmllcy90ZXN0LXNlbGZpZS5qcGcnXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF0dGVuZGFuY2VTZXJ2aWNlLmNsb2NrSW4oY2xvY2tJbkRhdGEpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdlbXBsb3llZUlkJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnZGF0ZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3Nlc3Npb25zJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmVtcGxveWVlSWQpLnRvQmUoZW1wbG95ZWUuaWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2xvY2sgaW4gZm9yIG5vbi1leGlzdGVudCBlbXBsb3llZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNsb2NrSW5EYXRhID0ge1xuICAgICAgICBlbXBsb3llZUlkOiAnbm9uLWV4aXN0ZW50LWlkJyxcbiAgICAgICAgcXJDb2RlSGFzaDogJ3Rlc3QtcXItaGFzaCcsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoJzIwMjUtMDEtMTVUMDg6MDA6MDBaJyksXG4gICAgICAgIHNlbGZpZUltYWdlUGF0aDogJy91cGxvYWRzL3NlbGZpZXMvdGVzdC1zZWxmaWUuanBnJ1xuICAgICAgfTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXR0ZW5kYW5jZVNlcnZpY2UuY2xvY2tJbihjbG9ja0luRGF0YSkpLnJlamVjdHMudG9UaHJvdygnRW1wbG95ZWUgbm90IGZvdW5kJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjbG9ja091dCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBjbG9jayBvdXQgZW1wbG95ZWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkZXBhcnRtZW50ID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdERlcGFydG1lbnQoKTtcbiAgICAgIGNyZWF0ZWREZXBhcnRtZW50SWRzLnB1c2goZGVwYXJ0bWVudC5pZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGVtcGxveWVlID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdEVtcGxveWVlKHtcbiAgICAgICAgZGVwYXJ0bWVudElkOiBkZXBhcnRtZW50LmlkLFxuICAgICAgICBlbXBsb3ltZW50VHlwZTogJ3JlZ3VsYXInXG4gICAgICB9KTtcbiAgICAgIGNyZWF0ZWRFbXBsb3llZUlkcy5wdXNoKGVtcGxveWVlLmlkKTtcbiAgICAgIGNyZWF0ZWRVc2VySWRzLnB1c2goZW1wbG95ZWUudXNlcklkKTtcblxuICAgICAgLy8gRmlyc3QgY2xvY2sgaW5cbiAgICAgIGNvbnN0IGNsb2NrSW5EYXRhID0ge1xuICAgICAgICBlbXBsb3llZUlkOiBlbXBsb3llZS5pZCxcbiAgICAgICAgcXJDb2RlSGFzaDogJ3Rlc3QtcXItaGFzaCcsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoJzIwMjUtMDEtMTVUMDg6MDA6MDBaJyksXG4gICAgICAgIHNlbGZpZUltYWdlUGF0aDogJy91cGxvYWRzL3NlbGZpZXMvdGVzdC1zZWxmaWUuanBnJ1xuICAgICAgfTtcbiAgICAgIGF3YWl0IGF0dGVuZGFuY2VTZXJ2aWNlLmNsb2NrSW4oY2xvY2tJbkRhdGEpO1xuXG4gICAgICBjb25zdCBjbG9ja091dERhdGEgPSB7XG4gICAgICAgIGVtcGxveWVlSWQ6IGVtcGxveWVlLmlkLFxuICAgICAgICBxckNvZGVIYXNoOiAndGVzdC1xci1oYXNoJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgnMjAyNS0wMS0xNVQxMjowMDowMFonKSxcbiAgICAgICAgc2VsZmllSW1hZ2VQYXRoOiAnL3VwbG9hZHMvc2VsZmllcy90ZXN0LXNlbGZpZS1vdXQuanBnJ1xuICAgICAgfTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdHRlbmRhbmNlU2VydmljZS5jbG9ja091dChjbG9ja091dERhdGEpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdlbXBsb3llZUlkJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndG90YWxIb3VycycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbEhvdXJzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjbG9jayBvdXQgd2l0aG91dCBjbG9jayBpbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGRlcGFydG1lbnQgPSBhd2FpdCB0ZXN0SGVscGVycy5jcmVhdGVUZXN0RGVwYXJ0bWVudCgpO1xuICAgICAgY3JlYXRlZERlcGFydG1lbnRJZHMucHVzaChkZXBhcnRtZW50LmlkKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW1wbG95ZWUgPSBhd2FpdCB0ZXN0SGVscGVycy5jcmVhdGVUZXN0RW1wbG95ZWUoe1xuICAgICAgICBkZXBhcnRtZW50SWQ6IGRlcGFydG1lbnQuaWQsXG4gICAgICAgIGVtcGxveW1lbnRUeXBlOiAncmVndWxhcidcbiAgICAgIH0pO1xuICAgICAgY3JlYXRlZEVtcGxveWVlSWRzLnB1c2goZW1wbG95ZWUuaWQpO1xuICAgICAgY3JlYXRlZFVzZXJJZHMucHVzaChlbXBsb3llZS51c2VySWQpO1xuXG4gICAgICBjb25zdCBjbG9ja091dERhdGEgPSB7XG4gICAgICAgIGVtcGxveWVlSWQ6IGVtcGxveWVlLmlkLFxuICAgICAgICBxckNvZGVIYXNoOiAndGVzdC1xci1oYXNoJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgnMjAyNS0wMS0xNVQxMjowMDowMFonKSxcbiAgICAgICAgc2VsZmllSW1hZ2VQYXRoOiAnL3VwbG9hZHMvc2VsZmllcy90ZXN0LXNlbGZpZS1vdXQuanBnJ1xuICAgICAgfTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXR0ZW5kYW5jZVNlcnZpY2UuY2xvY2tPdXQoY2xvY2tPdXREYXRhKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBdHRlbmRhbmNlU3VtbWFyeScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBhdHRlbmRhbmNlIHN1bW1hcnkgZm9yIGVtcGxveWVlIGFuZCBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZGVwYXJ0bWVudCA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3REZXBhcnRtZW50KCk7XG4gICAgICBjcmVhdGVkRGVwYXJ0bWVudElkcy5wdXNoKGRlcGFydG1lbnQuaWQpO1xuICAgICAgXG4gICAgICBjb25zdCBlbXBsb3llZSA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3RFbXBsb3llZSh7XG4gICAgICAgIGRlcGFydG1lbnRJZDogZGVwYXJ0bWVudC5pZCxcbiAgICAgICAgZW1wbG95bWVudFR5cGU6ICdyZWd1bGFyJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkRW1wbG95ZWVJZHMucHVzaChlbXBsb3llZS5pZCk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKGVtcGxveWVlLnVzZXJJZCk7XG5cbiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgnMjAyNS0wMS0xNScpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF0dGVuZGFuY2VTZXJ2aWNlLmdldEF0dGVuZGFuY2VTdW1tYXJ5KGVtcGxveWVlLmlkLCBkYXRlKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnZW1wbG95ZWVJZCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2RhdGUnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZW1wbG95ZWVJZCkudG9CZShlbXBsb3llZS5pZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRFbXBsb3llZUF0dGVuZGFuY2VIaXN0b3J5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGF0dGVuZGFuY2UgaGlzdG9yeSBmb3IgZW1wbG95ZWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkZXBhcnRtZW50ID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdERlcGFydG1lbnQoKTtcbiAgICAgIGNyZWF0ZWREZXBhcnRtZW50SWRzLnB1c2goZGVwYXJ0bWVudC5pZCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGVtcGxveWVlID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdEVtcGxveWVlKHtcbiAgICAgICAgZGVwYXJ0bWVudElkOiBkZXBhcnRtZW50LmlkLFxuICAgICAgICBlbXBsb3ltZW50VHlwZTogJ3JlZ3VsYXInXG4gICAgICB9KTtcbiAgICAgIGNyZWF0ZWRFbXBsb3llZUlkcy5wdXNoKGVtcGxveWVlLmlkKTtcbiAgICAgIGNyZWF0ZWRVc2VySWRzLnB1c2goZW1wbG95ZWUudXNlcklkKTtcblxuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoJzIwMjUtMDEtMDEnKTtcbiAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSgnMjAyNS0wMS0zMScpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF0dGVuZGFuY2VTZXJ2aWNlLmdldEVtcGxveWVlQXR0ZW5kYW5jZUhpc3RvcnkoZW1wbG95ZWUuaWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEVtcGxveWVlQXR0ZW5kYW5jZVN0YXRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGF0dGVuZGFuY2Ugc3RhdHMgZm9yIGVtcGxveWVlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZGVwYXJ0bWVudCA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3REZXBhcnRtZW50KCk7XG4gICAgICBjcmVhdGVkRGVwYXJ0bWVudElkcy5wdXNoKGRlcGFydG1lbnQuaWQpO1xuICAgICAgXG4gICAgICBjb25zdCBlbXBsb3llZSA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3RFbXBsb3llZSh7XG4gICAgICAgIGRlcGFydG1lbnRJZDogZGVwYXJ0bWVudC5pZCxcbiAgICAgICAgZW1wbG95bWVudFR5cGU6ICdyZWd1bGFyJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkRW1wbG95ZWVJZHMucHVzaChlbXBsb3llZS5pZCk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKGVtcGxveWVlLnVzZXJJZCk7XG5cbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKCcyMDI1LTAxLTAxJyk7XG4gICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoJzIwMjUtMDEtMzEnKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdHRlbmRhbmNlU2VydmljZS5nZXRFbXBsb3llZUF0dGVuZGFuY2VTdGF0cyhlbXBsb3llZS5pZCwgc3RhcnREYXRlLCBlbmREYXRlKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndG90YWxEYXlzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncHJlc2VudERheXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdsYXRlRGF5cycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2Fic2VudERheXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbEhvdXJzJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC50b3RhbERheXMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQucHJlc2VudERheXMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQubGF0ZURheXMpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQuYWJzZW50RGF5cykudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC50b3RhbEhvdXJzKS50b0JlKCdudW1iZXInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEF0dGVuZGFuY2VSZWNvcmRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IGF0dGVuZGFuY2UgcmVjb3JkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGRlcGFydG1lbnQgPSBhd2FpdCB0ZXN0SGVscGVycy5jcmVhdGVUZXN0RGVwYXJ0bWVudCgpO1xuICAgICAgY3JlYXRlZERlcGFydG1lbnRJZHMucHVzaChkZXBhcnRtZW50LmlkKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW1wbG95ZWUgPSBhd2FpdCB0ZXN0SGVscGVycy5jcmVhdGVUZXN0RW1wbG95ZWUoe1xuICAgICAgICBkZXBhcnRtZW50SWQ6IGRlcGFydG1lbnQuaWQsXG4gICAgICAgIGVtcGxveW1lbnRUeXBlOiAncmVndWxhcidcbiAgICAgIH0pO1xuICAgICAgY3JlYXRlZEVtcGxveWVlSWRzLnB1c2goZW1wbG95ZWUuaWQpO1xuICAgICAgY3JlYXRlZFVzZXJJZHMucHVzaChlbXBsb3llZS51c2VySWQpO1xuXG4gICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgnMjAyNS0wMS0wMScpO1xuICAgICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKCcyMDI1LTAxLTMxJyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXR0ZW5kYW5jZVNlcnZpY2UuZ2V0QXR0ZW5kYW5jZVJlY29yZHMoc3RhcnREYXRlLCBlbmREYXRlKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncmVjb3JkcycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3RvdGFsJyk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXN1bHQucmVjb3JkcykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC50b3RhbCkudG9CZSgnbnVtYmVyJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZUF0dGVuZGFuY2VBY3Rpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhdHRlbmRhbmNlIGFjdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXR0ZW5kYW5jZVNlcnZpY2UudmFsaWRhdGVBdHRlbmRhbmNlQWN0aW9uKCd2YWxpZC1lbXBsb3llZS1pZCcsICdtb3JuaW5nX2luJyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2NhblBlcmZvcm0nKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmNhblBlcmZvcm0pLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZlcmlmeVFSQ29kZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZlcmlmeSBRUiBjb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdHRlbmRhbmNlU2VydmljZS52ZXJpZnlRUkNvZGUoJ3Rlc3QtcXItaGFzaCcpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdpc1ZhbGlkJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5pc1ZhbGlkKS50b0JlKCdib29sZWFuJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRDdXJyZW50QXR0ZW5kYW5jZVN0YXR1cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBjdXJyZW50IGF0dGVuZGFuY2Ugc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZGVwYXJ0bWVudCA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3REZXBhcnRtZW50KCk7XG4gICAgICBjcmVhdGVkRGVwYXJ0bWVudElkcy5wdXNoKGRlcGFydG1lbnQuaWQpO1xuICAgICAgXG4gICAgICBjb25zdCBlbXBsb3llZSA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3RFbXBsb3llZSh7XG4gICAgICAgIGRlcGFydG1lbnRJZDogZGVwYXJ0bWVudC5pZCxcbiAgICAgICAgZW1wbG95bWVudFR5cGU6ICdyZWd1bGFyJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkRW1wbG95ZWVJZHMucHVzaChlbXBsb3llZS5pZCk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKGVtcGxveWVlLnVzZXJJZCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXR0ZW5kYW5jZVNlcnZpY2UuZ2V0Q3VycmVudEF0dGVuZGFuY2VTdGF0dXMoZW1wbG95ZWUuaWQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdpc0Nsb2NrZWRJbicpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ2N1cnJlbnRTZXNzaW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3VsdC5pc0Nsb2NrZWRJbikudG9CZSgnYm9vbGVhbicpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==