cc5772425f31aa9d19a72b58845aceaf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const authService_1 = require("../../src/services/auth/authService");
const testHelpers_1 = require("../utils/testHelpers");
const setup_1 = require("../setup");
(0, globals_1.describe)('Authentication-User Integration', () => {
    let testHelpers;
    let createdUserIds = [];
    let createdEmployeeIds = [];
    let createdDepartmentIds = [];
    (0, globals_1.beforeAll)(async () => {
        const { testDbPool } = await (0, setup_1.initializeTestConnections)();
        testHelpers = new testHelpers_1.TestHelpers(testDbPool);
    });
    (0, globals_1.afterEach)(async () => {
        // Clean up created data after each test
        for (const employeeId of createdEmployeeIds) {
            await testHelpers.deleteEmployee(employeeId).catch(() => { });
        }
        for (const userId of createdUserIds) {
            await testHelpers.deleteUser(userId).catch(() => { });
        }
        for (const departmentId of createdDepartmentIds) {
            await testHelpers.deleteDepartment(departmentId).catch(() => { });
        }
        createdEmployeeIds = [];
        createdUserIds = [];
        createdDepartmentIds = [];
    });
    (0, globals_1.describe)('User Authentication Workflow', () => {
        (0, globals_1.it)('should handle complete user authentication workflow', async () => {
            // 1. Create test user
            const user = await testHelpers.createTestUser({
                email: 'test@example.com',
                password: 'TestPassword123!',
                role: 'employee'
            });
            createdUserIds.push(user.id);
            // 2. Test user login
            const loginResult = await authService_1.authService.login({
                email: 'test@example.com',
                password: 'TestPassword123!'
            });
            (0, globals_1.expect)(loginResult).toHaveProperty('success');
            (0, globals_1.expect)(loginResult.success).toBe(true);
            (0, globals_1.expect)(loginResult.data).toHaveProperty('user');
            (0, globals_1.expect)(loginResult.data).toHaveProperty('accessToken');
            (0, globals_1.expect)(loginResult.data).toHaveProperty('refreshToken');
            // 3. Test token validation
            const tokenValidation = await authService_1.authService.validateToken(loginResult.data.accessToken);
            (0, globals_1.expect)(tokenValidation).toHaveProperty('success');
            (0, globals_1.expect)(tokenValidation.success).toBe(true);
            (0, globals_1.expect)(tokenValidation.data).toHaveProperty('userId');
            (0, globals_1.expect)(tokenValidation.data.userId).toBe(user.id);
            // 4. Test user profile retrieval (simplified)
            (0, globals_1.expect)(loginResult.data.user).toHaveProperty('id');
            (0, globals_1.expect)(loginResult.data.user.id).toBe(user.id);
            (0, globals_1.expect)(loginResult.data.user).toHaveProperty('email');
            (0, globals_1.expect)(loginResult.data.user.email).toBe('test@example.com');
            // 5. Test logout
            const logoutResult = await authService_1.authService.logout(loginResult.data.refreshToken);
            (0, globals_1.expect)(logoutResult).toHaveProperty('success');
            (0, globals_1.expect)(logoutResult.success).toBe(true);
        });
        (0, globals_1.it)('should handle authentication errors gracefully', async () => {
            // Test invalid login credentials
            const invalidLogin = await authService_1.authService.login({
                email: 'nonexistent@example.com',
                password: 'wrongpassword'
            });
            (0, globals_1.expect)(invalidLogin).toHaveProperty('success');
            (0, globals_1.expect)(invalidLogin.success).toBe(false);
            (0, globals_1.expect)(invalidLogin).toHaveProperty('error');
            // Test invalid token
            const invalidTokenValidation = await authService_1.authService.validateToken('invalid-token');
            (0, globals_1.expect)(invalidTokenValidation).toHaveProperty('success');
            (0, globals_1.expect)(invalidTokenValidation.success).toBe(false);
            // Test logout with invalid token
            const invalidLogout = await authService_1.authService.logout('invalid-refresh-token');
            (0, globals_1.expect)(invalidLogout).toHaveProperty('success');
            (0, globals_1.expect)(invalidLogout.success).toBe(false);
        });
        (0, globals_1.it)('should handle user role-based access', async () => {
            // 1. Create users with different roles
            const hrUser = await testHelpers.createTestUser({
                email: 'hr@example.com',
                password: 'HrPassword123!',
                role: 'hr'
            });
            createdUserIds.push(hrUser.id);
            const employeeUser = await testHelpers.createTestUser({
                email: 'employee@example.com',
                password: 'EmployeePassword123!',
                role: 'employee'
            });
            createdUserIds.push(employeeUser.id);
            // 2. Test HR user login
            const hrLogin = await authService_1.authService.login({
                email: 'hr@example.com',
                password: 'HrPassword123!'
            });
            (0, globals_1.expect)(hrLogin.success).toBe(true);
            (0, globals_1.expect)(hrLogin.data.user.role).toBe('hr');
            // 3. Test employee user login
            const employeeLogin = await authService_1.authService.login({
                email: 'employee@example.com',
                password: 'EmployeePassword123!'
            });
            (0, globals_1.expect)(employeeLogin.success).toBe(true);
            (0, globals_1.expect)(employeeLogin.data.user.role).toBe('employee');
            // 4. Test token validation for both roles
            const hrTokenValidation = await authService_1.authService.validateToken(hrLogin.data.accessToken);
            (0, globals_1.expect)(hrTokenValidation.success).toBe(true);
            (0, globals_1.expect)(hrTokenValidation.data.role).toBe('hr');
            const employeeTokenValidation = await authService_1.authService.validateToken(employeeLogin.data.accessToken);
            (0, globals_1.expect)(employeeTokenValidation.success).toBe(true);
            (0, globals_1.expect)(employeeTokenValidation.data.role).toBe('employee');
        });
    });
    (0, globals_1.describe)('User Management Integration', () => {
        (0, globals_1.it)('should handle user creation and management workflow', async () => {
            // 1. Create department
            const department = await testHelpers.createTestDepartment();
            createdDepartmentIds.push(department.id);
            // 2. Create user
            const user = await testHelpers.createTestUser({
                email: 'newuser@example.com',
                password: 'NewUserPassword123!',
                role: 'employee'
            });
            createdUserIds.push(user.id);
            // 3. Create employee linked to user
            const employee = await testHelpers.createTestEmployee({
                userId: user.id,
                departmentId: department.id,
                employmentType: 'regular',
                baseSalary: 50000
            });
            createdEmployeeIds.push(employee.id);
            // 4. Test user profile with employee data (simplified)
            (0, globals_1.expect)(user).toHaveProperty('id');
            (0, globals_1.expect)(user).toHaveProperty('email');
            (0, globals_1.expect)(user.email).toBe('newuser@example.com');
            // 5. Test user login after creation
            const loginResult = await authService_1.authService.login({
                email: 'newuser@example.com',
                password: 'NewUserPassword123!'
            });
            (0, globals_1.expect)(loginResult.success).toBe(true);
            (0, globals_1.expect)(loginResult.data.user.id).toBe(user.id);
            // 6. Test token refresh
            const refreshResult = await authService_1.authService.refreshToken(loginResult.data.refreshToken);
            (0, globals_1.expect)(refreshResult).toHaveProperty('success');
            (0, globals_1.expect)(refreshResult.success).toBe(true);
            (0, globals_1.expect)(refreshResult.data).toHaveProperty('accessToken');
            (0, globals_1.expect)(refreshResult.data).toHaveProperty('refreshToken');
        });
        (0, globals_1.it)('should handle concurrent user operations', async () => {
            // 1. Create multiple users concurrently
            const userPromises = [];
            for (let i = 0; i < 3; i++) {
                userPromises.push(testHelpers.createTestUser({
                    email: `concurrent${i}@example.com`,
                    password: 'ConcurrentPassword123!',
                    role: 'employee'
                }));
            }
            const users = await Promise.all(userPromises);
            users.forEach(user => createdUserIds.push(user.id));
            // 2. Test concurrent logins
            const loginPromises = users.map(user => authService_1.authService.login({
                email: user.email,
                password: 'ConcurrentPassword123!'
            }));
            const loginResults = await Promise.all(loginPromises);
            // 3. Verify all logins succeeded
            loginResults.forEach(result => {
                (0, globals_1.expect)(result.success).toBe(true);
                (0, globals_1.expect)(result.data).toHaveProperty('accessToken');
                (0, globals_1.expect)(result.data).toHaveProperty('refreshToken');
            });
            // 4. Test concurrent token validations
            const validationPromises = loginResults.map(result => authService_1.authService.validateToken(result.data.accessToken));
            const validationResults = await Promise.all(validationPromises);
            // 5. Verify all validations succeeded
            validationResults.forEach(result => {
                (0, globals_1.expect)(result.success).toBe(true);
                (0, globals_1.expect)(result.data).toHaveProperty('userId');
            });
        });
    });
    (0, globals_1.describe)('Security Integration', () => {
        (0, globals_1.it)('should handle password security requirements', async () => {
            // Test weak password (should still work in test environment)
            const weakPasswordUser = await testHelpers.createTestUser({
                email: 'weak@example.com',
                password: '123',
                role: 'employee'
            });
            createdUserIds.push(weakPasswordUser.id);
            // Test login with weak password
            const weakLogin = await authService_1.authService.login({
                email: 'weak@example.com',
                password: '123'
            });
            (0, globals_1.expect)(weakLogin.success).toBe(true);
            // Test strong password
            const strongPasswordUser = await testHelpers.createTestUser({
                email: 'strong@example.com',
                password: 'StrongPassword123!@#',
                role: 'employee'
            });
            createdUserIds.push(strongPasswordUser.id);
            const strongLogin = await authService_1.authService.login({
                email: 'strong@example.com',
                password: 'StrongPassword123!@#'
            });
            (0, globals_1.expect)(strongLogin.success).toBe(true);
        });
        (0, globals_1.it)('should handle session management', async () => {
            // 1. Create user
            const user = await testHelpers.createTestUser({
                email: 'session@example.com',
                password: 'SessionPassword123!',
                role: 'employee'
            });
            createdUserIds.push(user.id);
            // 2. Login and get tokens
            const loginResult = await authService_1.authService.login({
                email: 'session@example.com',
                password: 'SessionPassword123!'
            });
            (0, globals_1.expect)(loginResult.success).toBe(true);
            const { accessToken, refreshToken } = loginResult.data;
            // 3. Test token validation
            const validation = await authService_1.authService.validateToken(accessToken);
            (0, globals_1.expect)(validation.success).toBe(true);
            // 4. Test token refresh
            const refreshResult = await authService_1.authService.refreshToken(refreshToken);
            (0, globals_1.expect)(refreshResult.success).toBe(true);
            // 5. Test logout
            const logoutResult = await authService_1.authService.logout(refreshToken);
            (0, globals_1.expect)(logoutResult.success).toBe(true);
            // 6. Test token validation after logout (should still work in mock)
            const postLogoutValidation = await authService_1.authService.validateToken(accessToken);
            (0, globals_1.expect)(postLogoutValidation).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva2ltL3RpdG8vc2VydmVyL3Rlc3RzL2ludGVncmF0aW9uL2F1dGhVc2VySW50ZWdyYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDJDQUEyRTtBQUMzRSxxRUFBa0U7QUFDbEUsc0RBQW1EO0FBQ25ELG9DQUFxRDtBQUVyRCxJQUFBLGtCQUFRLEVBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO0lBQy9DLElBQUksV0FBd0IsQ0FBQztJQUM3QixJQUFJLGNBQWMsR0FBYSxFQUFFLENBQUM7SUFDbEMsSUFBSSxrQkFBa0IsR0FBYSxFQUFFLENBQUM7SUFDdEMsSUFBSSxvQkFBb0IsR0FBYSxFQUFFLENBQUM7SUFFeEMsSUFBQSxtQkFBUyxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLE1BQU0sRUFBRSxVQUFVLEVBQUUsR0FBRyxNQUFNLElBQUEsaUNBQXlCLEdBQUUsQ0FBQztRQUN6RCxXQUFXLEdBQUcsSUFBSSx5QkFBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxtQkFBUyxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLHdDQUF3QztRQUN4QyxLQUFLLE1BQU0sVUFBVSxJQUFJLGtCQUFrQixFQUFFLENBQUM7WUFDNUMsTUFBTSxXQUFXLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQUMsQ0FBQztRQUMvRCxDQUFDO1FBQ0QsS0FBSyxNQUFNLE1BQU0sSUFBSSxjQUFjLEVBQUUsQ0FBQztZQUNwQyxNQUFNLFdBQVcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3ZELENBQUM7UUFDRCxLQUFLLE1BQU0sWUFBWSxJQUFJLG9CQUFvQixFQUFFLENBQUM7WUFDaEQsTUFBTSxXQUFXLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcs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QU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUM1RCxJQUFBLGdCQUFNLEVBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUV4QyxvRUFBb0U7WUFDcEUsTUFBTSxvQkFBb0IsR0FBRyxNQUFNLHlCQUFXLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzFFLElBQUEsZ0JBQU0sRUFBQyxvQkFBb0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9raW0vdGl0by9zZXJ2ZXIvdGVzdHMvaW50ZWdyYXRpb24vYXV0aFVzZXJJbnRlZ3JhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVBbGwsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgYXV0aFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvYXV0aC9hdXRoU2VydmljZSc7XG5pbXBvcnQgeyBUZXN0SGVscGVycyB9IGZyb20gJy4uL3V0aWxzL3Rlc3RIZWxwZXJzJztcbmltcG9ydCB7IGluaXRpYWxpemVUZXN0Q29ubmVjdGlvbnMgfSBmcm9tICcuLi9zZXR1cCc7XG5cbmRlc2NyaWJlKCdBdXRoZW50aWNhdGlvbi1Vc2VyIEludGVncmF0aW9uJywgKCkgPT4ge1xuICBsZXQgdGVzdEhlbHBlcnM6IFRlc3RIZWxwZXJzO1xuICBsZXQgY3JlYXRlZFVzZXJJZHM6IHN0cmluZ1tdID0gW107XG4gIGxldCBjcmVhdGVkRW1wbG95ZWVJZHM6IHN0cmluZ1tdID0gW107XG4gIGxldCBjcmVhdGVkRGVwYXJ0bWVudElkczogc3RyaW5nW10gPSBbXTtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHsgdGVzdERiUG9vbCB9ID0gYXdhaXQgaW5pdGlhbGl6ZVRlc3RDb25uZWN0aW9ucygpO1xuICAgIHRlc3RIZWxwZXJzID0gbmV3IFRlc3RIZWxwZXJzKHRlc3REYlBvb2wpO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIENsZWFuIHVwIGNyZWF0ZWQgZGF0YSBhZnRlciBlYWNoIHRlc3RcbiAgICBmb3IgKGNvbnN0IGVtcGxveWVlSWQgb2YgY3JlYXRlZEVtcGxveWVlSWRzKSB7IFxuICAgICAgYXdhaXQgdGVzdEhlbHBlcnMuZGVsZXRlRW1wbG95ZWUoZW1wbG95ZWVJZCkuY2F0Y2goKCkgPT4ge30pOyBcbiAgICB9XG4gICAgZm9yIChjb25zdCB1c2VySWQgb2YgY3JlYXRlZFVzZXJJZHMpIHsgXG4gICAgICBhd2FpdCB0ZXN0SGVscGVycy5kZWxldGVVc2VyKHVzZXJJZCkuY2F0Y2goKCkgPT4ge30pOyBcbiAgICB9XG4gICAgZm9yIChjb25zdCBkZXBhcnRtZW50SWQgb2YgY3JlYXRlZERlcGFydG1lbnRJZHMpIHsgXG4gICAgICBhd2FpdCB0ZXN0SGVscGVycy5kZWxldGVEZXBhcnRtZW50KGRlcGFydG1lbnRJZCkuY2F0Y2goKCkgPT4ge30pOyBcbiAgICB9XG4gICAgY3JlYXRlZEVtcGxveWVlSWRzID0gW107XG4gICAgY3JlYXRlZFVzZXJJZHMgPSBbXTtcbiAgICBjcmVhdGVkRGVwYXJ0bWVudElkcyA9IFtdO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNlciBBdXRoZW50aWNhdGlvbiBXb3JrZmxvdycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV0ZSB1c2VyIGF1dGhlbnRpY2F0aW9uIHdvcmtmbG93JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gMS4gQ3JlYXRlIHRlc3QgdXNlclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3RVc2VyKHtcbiAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdUZXN0UGFzc3dvcmQxMjMhJyxcbiAgICAgICAgcm9sZTogJ2VtcGxveWVlJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKHVzZXIuaWQpO1xuXG4gICAgICAvLyAyLiBUZXN0IHVzZXIgbG9naW5cbiAgICAgIGNvbnN0IGxvZ2luUmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UubG9naW4oe1xuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ1Rlc3RQYXNzd29yZDEyMyEnXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChsb2dpblJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3MnKTtcbiAgICAgIGV4cGVjdChsb2dpblJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGxvZ2luUmVzdWx0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCd1c2VyJyk7XG4gICAgICBleHBlY3QobG9naW5SZXN1bHQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ2FjY2Vzc1Rva2VuJyk7XG4gICAgICBleHBlY3QobG9naW5SZXN1bHQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ3JlZnJlc2hUb2tlbicpO1xuXG4gICAgICAvLyAzLiBUZXN0IHRva2VuIHZhbGlkYXRpb25cbiAgICAgIGNvbnN0IHRva2VuVmFsaWRhdGlvbiA9IGF3YWl0IGF1dGhTZXJ2aWNlLnZhbGlkYXRlVG9rZW4obG9naW5SZXN1bHQuZGF0YS5hY2Nlc3NUb2tlbik7XG4gICAgICBleHBlY3QodG9rZW5WYWxpZGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgnc3VjY2VzcycpO1xuICAgICAgZXhwZWN0KHRva2VuVmFsaWRhdGlvbi5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHRva2VuVmFsaWRhdGlvbi5kYXRhKS50b0hhdmVQcm9wZXJ0eSgndXNlcklkJyk7XG4gICAgICBleHBlY3QodG9rZW5WYWxpZGF0aW9uLmRhdGEudXNlcklkKS50b0JlKHVzZXIuaWQpO1xuXG4gICAgICAvLyA0LiBUZXN0IHVzZXIgcHJvZmlsZSByZXRyaWV2YWwgKHNpbXBsaWZpZWQpXG4gICAgICBleHBlY3QobG9naW5SZXN1bHQuZGF0YS51c2VyKS50b0hhdmVQcm9wZXJ0eSgnaWQnKTtcbiAgICAgIGV4cGVjdChsb2dpblJlc3VsdC5kYXRhLnVzZXIuaWQpLnRvQmUodXNlci5pZCk7XG4gICAgICBleHBlY3QobG9naW5SZXN1bHQuZGF0YS51c2VyKS50b0hhdmVQcm9wZXJ0eSgnZW1haWwnKTtcbiAgICAgIGV4cGVjdChsb2dpblJlc3VsdC5kYXRhLnVzZXIuZW1haWwpLnRvQmUoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcblxuICAgICAgLy8gNS4gVGVzdCBsb2dvdXRcbiAgICAgIGNvbnN0IGxvZ291dFJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLmxvZ291dChsb2dpblJlc3VsdC5kYXRhLnJlZnJlc2hUb2tlbik7XG4gICAgICBleHBlY3QobG9nb3V0UmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnc3VjY2VzcycpO1xuICAgICAgZXhwZWN0KGxvZ291dFJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYXV0aGVudGljYXRpb24gZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IGludmFsaWQgbG9naW4gY3JlZGVudGlhbHNcbiAgICAgIGNvbnN0IGludmFsaWRMb2dpbiA9IGF3YWl0IGF1dGhTZXJ2aWNlLmxvZ2luKHtcbiAgICAgICAgZW1haWw6ICdub25leGlzdGVudEBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnd3JvbmdwYXNzd29yZCdcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGludmFsaWRMb2dpbikudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3MnKTtcbiAgICAgIGV4cGVjdChpbnZhbGlkTG9naW4uc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QoaW52YWxpZExvZ2luKS50b0hhdmVQcm9wZXJ0eSgnZXJyb3InKTtcblxuICAgICAgLy8gVGVzdCBpbnZhbGlkIHRva2VuXG4gICAgICBjb25zdCBpbnZhbGlkVG9rZW5WYWxpZGF0aW9uID0gYXdhaXQgYXV0aFNlcnZpY2UudmFsaWRhdGVUb2tlbignaW52YWxpZC10b2tlbicpO1xuICAgICAgZXhwZWN0KGludmFsaWRUb2tlblZhbGlkYXRpb24pLnRvSGF2ZVByb3BlcnR5KCdzdWNjZXNzJyk7XG4gICAgICBleHBlY3QoaW52YWxpZFRva2VuVmFsaWRhdGlvbi5zdWNjZXNzKS50b0JlKGZhbHNlKTtcblxuICAgICAgLy8gVGVzdCBsb2dvdXQgd2l0aCBpbnZhbGlkIHRva2VuXG4gICAgICBjb25zdCBpbnZhbGlkTG9nb3V0ID0gYXdhaXQgYXV0aFNlcnZpY2UubG9nb3V0KCdpbnZhbGlkLXJlZnJlc2gtdG9rZW4nKTtcbiAgICAgIGV4cGVjdChpbnZhbGlkTG9nb3V0KS50b0hhdmVQcm9wZXJ0eSgnc3VjY2VzcycpO1xuICAgICAgZXhwZWN0KGludmFsaWRMb2dvdXQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1c2VyIHJvbGUtYmFzZWQgYWNjZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gMS4gQ3JlYXRlIHVzZXJzIHdpdGggZGlmZmVyZW50IHJvbGVzXG4gICAgICBjb25zdCBoclVzZXIgPSBhd2FpdCB0ZXN0SGVscGVycy5jcmVhdGVUZXN0VXNlcih7XG4gICAgICAgIGVtYWlsOiAnaHJAZXhhbXBsZS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ0hyUGFzc3dvcmQxMjMhJyxcbiAgICAgICAgcm9sZTogJ2hyJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKGhyVXNlci5pZCk7XG5cbiAgICAgIGNvbnN0IGVtcGxveWVlVXNlciA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3RVc2VyKHtcbiAgICAgICAgZW1haWw6ICdlbXBsb3llZUBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnRW1wbG95ZWVQYXNzd29yZDEyMyEnLFxuICAgICAgICByb2xlOiAnZW1wbG95ZWUnXG4gICAgICB9KTtcbiAgICAgIGNyZWF0ZWRVc2VySWRzLnB1c2goZW1wbG95ZWVVc2VyLmlkKTtcblxuICAgICAgLy8gMi4gVGVzdCBIUiB1c2VyIGxvZ2luXG4gICAgICBjb25zdCBockxvZ2luID0gYXdhaXQgYXV0aFNlcnZpY2UubG9naW4oe1xuICAgICAgICBlbWFpbDogJ2hyQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdIclBhc3N3b3JkMTIzISdcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGhyTG9naW4uc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChockxvZ2luLmRhdGEudXNlci5yb2xlKS50b0JlKCdocicpO1xuXG4gICAgICAvLyAzLiBUZXN0IGVtcGxveWVlIHVzZXIgbG9naW5cbiAgICAgIGNvbnN0IGVtcGxveWVlTG9naW4gPSBhd2FpdCBhdXRoU2VydmljZS5sb2dpbih7XG4gICAgICAgIGVtYWlsOiAnZW1wbG95ZWVAZXhhbXBsZS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ0VtcGxveWVlUGFzc3dvcmQxMjMhJ1xuICAgICAgfSk7XG4gICAgICBleHBlY3QoZW1wbG95ZWVMb2dpbi5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGVtcGxveWVlTG9naW4uZGF0YS51c2VyLnJvbGUpLnRvQmUoJ2VtcGxveWVlJyk7XG5cbiAgICAgIC8vIDQuIFRlc3QgdG9rZW4gdmFsaWRhdGlvbiBmb3IgYm90aCByb2xlc1xuICAgICAgY29uc3QgaHJUb2tlblZhbGlkYXRpb24gPSBhd2FpdCBhdXRoU2VydmljZS52YWxpZGF0ZVRva2VuKGhyTG9naW4uZGF0YS5hY2Nlc3NUb2tlbik7XG4gICAgICBleHBlY3QoaHJUb2tlblZhbGlkYXRpb24uc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChoclRva2VuVmFsaWRhdGlvbi5kYXRhLnJvbGUpLnRvQmUoJ2hyJyk7XG5cbiAgICAgIGNvbnN0IGVtcGxveWVlVG9rZW5WYWxpZGF0aW9uID0gYXdhaXQgYXV0aFNlcnZpY2UudmFsaWRhdGVUb2tlbihlbXBsb3llZUxvZ2luLmRhdGEuYWNjZXNzVG9rZW4pO1xuICAgICAgZXhwZWN0KGVtcGxveWVlVG9rZW5WYWxpZGF0aW9uLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZW1wbG95ZWVUb2tlblZhbGlkYXRpb24uZGF0YS5yb2xlKS50b0JlKCdlbXBsb3llZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNlciBNYW5hZ2VtZW50IEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVzZXIgY3JlYXRpb24gYW5kIG1hbmFnZW1lbnQgd29ya2Zsb3cnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyAxLiBDcmVhdGUgZGVwYXJ0bWVudFxuICAgICAgY29uc3QgZGVwYXJ0bWVudCA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3REZXBhcnRtZW50KCk7XG4gICAgICBjcmVhdGVkRGVwYXJ0bWVudElkcy5wdXNoKGRlcGFydG1lbnQuaWQpO1xuXG4gICAgICAvLyAyLiBDcmVhdGUgdXNlclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3RVc2VyKHtcbiAgICAgICAgZW1haWw6ICduZXd1c2VyQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdOZXdVc2VyUGFzc3dvcmQxMjMhJyxcbiAgICAgICAgcm9sZTogJ2VtcGxveWVlJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKHVzZXIuaWQpO1xuXG4gICAgICAvLyAzLiBDcmVhdGUgZW1wbG95ZWUgbGlua2VkIHRvIHVzZXJcbiAgICAgIGNvbnN0IGVtcGxveWVlID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdEVtcGxveWVlKHtcbiAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICBkZXBhcnRtZW50SWQ6IGRlcGFydG1lbnQuaWQsXG4gICAgICAgIGVtcGxveW1lbnRUeXBlOiAncmVndWxhcicsXG4gICAgICAgIGJhc2VTYWxhcnk6IDUwMDAwXG4gICAgICB9KTtcbiAgICAgIGNyZWF0ZWRFbXBsb3llZUlkcy5wdXNoKGVtcGxveWVlLmlkKTtcblxuICAgICAgLy8gNC4gVGVzdCB1c2VyIHByb2ZpbGUgd2l0aCBlbXBsb3llZSBkYXRhIChzaW1wbGlmaWVkKVxuICAgICAgZXhwZWN0KHVzZXIpLnRvSGF2ZVByb3BlcnR5KCdpZCcpO1xuICAgICAgZXhwZWN0KHVzZXIpLnRvSGF2ZVByb3BlcnR5KCdlbWFpbCcpO1xuICAgICAgZXhwZWN0KHVzZXIuZW1haWwpLnRvQmUoJ25ld3VzZXJAZXhhbXBsZS5jb20nKTtcblxuICAgICAgLy8gNS4gVGVzdCB1c2VyIGxvZ2luIGFmdGVyIGNyZWF0aW9uXG4gICAgICBjb25zdCBsb2dpblJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLmxvZ2luKHtcbiAgICAgICAgZW1haWw6ICduZXd1c2VyQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdOZXdVc2VyUGFzc3dvcmQxMjMhJ1xuICAgICAgfSk7XG4gICAgICBleHBlY3QobG9naW5SZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChsb2dpblJlc3VsdC5kYXRhLnVzZXIuaWQpLnRvQmUodXNlci5pZCk7XG5cbiAgICAgIC8vIDYuIFRlc3QgdG9rZW4gcmVmcmVzaFxuICAgICAgY29uc3QgcmVmcmVzaFJlc3VsdCA9IGF3YWl0IGF1dGhTZXJ2aWNlLnJlZnJlc2hUb2tlbihsb2dpblJlc3VsdC5kYXRhLnJlZnJlc2hUb2tlbik7XG4gICAgICBleHBlY3QocmVmcmVzaFJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3MnKTtcbiAgICAgIGV4cGVjdChyZWZyZXNoUmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVmcmVzaFJlc3VsdC5kYXRhKS50b0hhdmVQcm9wZXJ0eSgnYWNjZXNzVG9rZW4nKTtcbiAgICAgIGV4cGVjdChyZWZyZXNoUmVzdWx0LmRhdGEpLnRvSGF2ZVByb3BlcnR5KCdyZWZyZXNoVG9rZW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgdXNlciBvcGVyYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gMS4gQ3JlYXRlIG11bHRpcGxlIHVzZXJzIGNvbmN1cnJlbnRseVxuICAgICAgY29uc3QgdXNlclByb21pc2VzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICB1c2VyUHJvbWlzZXMucHVzaChcbiAgICAgICAgICB0ZXN0SGVscGVycy5jcmVhdGVUZXN0VXNlcih7XG4gICAgICAgICAgICBlbWFpbDogYGNvbmN1cnJlbnQke2l9QGV4YW1wbGUuY29tYCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiAnQ29uY3VycmVudFBhc3N3b3JkMTIzIScsXG4gICAgICAgICAgICByb2xlOiAnZW1wbG95ZWUnXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBQcm9taXNlLmFsbCh1c2VyUHJvbWlzZXMpO1xuICAgICAgdXNlcnMuZm9yRWFjaCh1c2VyID0+IGNyZWF0ZWRVc2VySWRzLnB1c2godXNlci5pZCkpO1xuXG4gICAgICAvLyAyLiBUZXN0IGNvbmN1cnJlbnQgbG9naW5zXG4gICAgICBjb25zdCBsb2dpblByb21pc2VzID0gdXNlcnMubWFwKHVzZXIgPT4gXG4gICAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luKHtcbiAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgICBwYXNzd29yZDogJ0NvbmN1cnJlbnRQYXNzd29yZDEyMyEnXG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICBjb25zdCBsb2dpblJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChsb2dpblByb21pc2VzKTtcblxuICAgICAgLy8gMy4gVmVyaWZ5IGFsbCBsb2dpbnMgc3VjY2VlZGVkXG4gICAgICBsb2dpblJlc3VsdHMuZm9yRWFjaChyZXN1bHQgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ2FjY2Vzc1Rva2VuJyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9IYXZlUHJvcGVydHkoJ3JlZnJlc2hUb2tlbicpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIDQuIFRlc3QgY29uY3VycmVudCB0b2tlbiB2YWxpZGF0aW9uc1xuICAgICAgY29uc3QgdmFsaWRhdGlvblByb21pc2VzID0gbG9naW5SZXN1bHRzLm1hcChyZXN1bHQgPT4gXG4gICAgICAgIGF1dGhTZXJ2aWNlLnZhbGlkYXRlVG9rZW4ocmVzdWx0LmRhdGEuYWNjZXNzVG9rZW4pXG4gICAgICApO1xuXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHZhbGlkYXRpb25Qcm9taXNlcyk7XG5cbiAgICAgIC8vIDUuIFZlcmlmeSBhbGwgdmFsaWRhdGlvbnMgc3VjY2VlZGVkXG4gICAgICB2YWxpZGF0aW9uUmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhKS50b0hhdmVQcm9wZXJ0eSgndXNlcklkJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlY3VyaXR5IEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhc3N3b3JkIHNlY3VyaXR5IHJlcXVpcmVtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3Qgd2VhayBwYXNzd29yZCAoc2hvdWxkIHN0aWxsIHdvcmsgaW4gdGVzdCBlbnZpcm9ubWVudClcbiAgICAgIGNvbnN0IHdlYWtQYXNzd29yZFVzZXIgPSBhd2FpdCB0ZXN0SGVscGVycy5jcmVhdGVUZXN0VXNlcih7XG4gICAgICAgIGVtYWlsOiAnd2Vha0BleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnMTIzJyxcbiAgICAgICAgcm9sZTogJ2VtcGxveWVlJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKHdlYWtQYXNzd29yZFVzZXIuaWQpO1xuXG4gICAgICAvLyBUZXN0IGxvZ2luIHdpdGggd2VhayBwYXNzd29yZFxuICAgICAgY29uc3Qgd2Vha0xvZ2luID0gYXdhaXQgYXV0aFNlcnZpY2UubG9naW4oe1xuICAgICAgICBlbWFpbDogJ3dlYWtAZXhhbXBsZS5jb20nLFxuICAgICAgICBwYXNzd29yZDogJzEyMydcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHdlYWtMb2dpbi5zdWNjZXNzKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBUZXN0IHN0cm9uZyBwYXNzd29yZFxuICAgICAgY29uc3Qgc3Ryb25nUGFzc3dvcmRVc2VyID0gYXdhaXQgdGVzdEhlbHBlcnMuY3JlYXRlVGVzdFVzZXIoe1xuICAgICAgICBlbWFpbDogJ3N0cm9uZ0BleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU3Ryb25nUGFzc3dvcmQxMjMhQCMnLFxuICAgICAgICByb2xlOiAnZW1wbG95ZWUnXG4gICAgICB9KTtcbiAgICAgIGNyZWF0ZWRVc2VySWRzLnB1c2goc3Ryb25nUGFzc3dvcmRVc2VyLmlkKTtcblxuICAgICAgY29uc3Qgc3Ryb25nTG9naW4gPSBhd2FpdCBhdXRoU2VydmljZS5sb2dpbih7XG4gICAgICAgIGVtYWlsOiAnc3Ryb25nQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTdHJvbmdQYXNzd29yZDEyMyFAIydcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHN0cm9uZ0xvZ2luLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXNzaW9uIG1hbmFnZW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyAxLiBDcmVhdGUgdXNlclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRlc3RIZWxwZXJzLmNyZWF0ZVRlc3RVc2VyKHtcbiAgICAgICAgZW1haWw6ICdzZXNzaW9uQGV4YW1wbGUuY29tJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZXNzaW9uUGFzc3dvcmQxMjMhJyxcbiAgICAgICAgcm9sZTogJ2VtcGxveWVlJ1xuICAgICAgfSk7XG4gICAgICBjcmVhdGVkVXNlcklkcy5wdXNoKHVzZXIuaWQpO1xuXG4gICAgICAvLyAyLiBMb2dpbiBhbmQgZ2V0IHRva2Vuc1xuICAgICAgY29uc3QgbG9naW5SZXN1bHQgPSBhd2FpdCBhdXRoU2VydmljZS5sb2dpbih7XG4gICAgICAgIGVtYWlsOiAnc2Vzc2lvbkBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2Vzc2lvblBhc3N3b3JkMTIzISdcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGxvZ2luUmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IHsgYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiB9ID0gbG9naW5SZXN1bHQuZGF0YTtcblxuICAgICAgLy8gMy4gVGVzdCB0b2tlbiB2YWxpZGF0aW9uXG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gYXdhaXQgYXV0aFNlcnZpY2UudmFsaWRhdGVUb2tlbihhY2Nlc3NUb2tlbik7XG4gICAgICBleHBlY3QodmFsaWRhdGlvbi5zdWNjZXNzKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyA0LiBUZXN0IHRva2VuIHJlZnJlc2hcbiAgICAgIGNvbnN0IHJlZnJlc2hSZXN1bHQgPSBhd2FpdCBhdXRoU2VydmljZS5yZWZyZXNoVG9rZW4ocmVmcmVzaFRva2VuKTtcbiAgICAgIGV4cGVjdChyZWZyZXNoUmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIDUuIFRlc3QgbG9nb3V0XG4gICAgICBjb25zdCBsb2dvdXRSZXN1bHQgPSBhd2FpdCBhdXRoU2VydmljZS5sb2dvdXQocmVmcmVzaFRva2VuKTtcbiAgICAgIGV4cGVjdChsb2dvdXRSZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcblxuICAgICAgLy8gNi4gVGVzdCB0b2tlbiB2YWxpZGF0aW9uIGFmdGVyIGxvZ291dCAoc2hvdWxkIHN0aWxsIHdvcmsgaW4gbW9jaylcbiAgICAgIGNvbnN0IHBvc3RMb2dvdXRWYWxpZGF0aW9uID0gYXdhaXQgYXV0aFNlcnZpY2UudmFsaWRhdGVUb2tlbihhY2Nlc3NUb2tlbik7XG4gICAgICBleHBlY3QocG9zdExvZ291dFZhbGlkYXRpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=