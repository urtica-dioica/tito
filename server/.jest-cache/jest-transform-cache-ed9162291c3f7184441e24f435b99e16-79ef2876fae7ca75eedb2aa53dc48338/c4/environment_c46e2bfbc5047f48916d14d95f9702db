ae0ab787ab0fdf371c7a0083ae4df499
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.isTest = exports.isDevelopment = exports.isProduction = exports.validateEnvironment = exports.config = void 0;
const dotenv_1 = __importDefault(require("dotenv"));
// Load environment variables from .env file
dotenv_1.default.config();
exports.config = {
    // Server Configuration
    server: {
        port: parseInt(process.env['PORT'] || '3000'),
        host: process.env['HOST'] || 'localhost',
        nodeEnv: process.env['NODE_ENV'] || 'development',
    },
    // Frontend Configuration
    frontend: {
        port: parseInt(process.env['FRONTEND_PORT'] || '3001'),
        host: process.env['FRONTEND_HOST'] || 'localhost',
        url: process.env['FRONTEND_URL'] || 'http://localhost:3001',
    },
    // Database Configuration (PostgreSQL)
    database: {
        host: process.env['DB_HOST'] || 'localhost',
        port: parseInt(process.env['DB_PORT'] || '5432'),
        name: process.env['DB_NAME'] || 'tito_hr',
        user: process.env['DB_USER'] || 'postgres',
        password: process.env['DB_PASSWORD'] || '',
        ssl: process.env['DB_SSL'] === 'true',
        maxConnections: 20,
        idleTimeoutMillis: 30000,
        connectionTimeoutMillis: 10000,
    },
    // Redis Configuration
    redis: {
        host: process.env['REDIS_HOST'] || 'localhost',
        port: parseInt(process.env['REDIS_PORT'] || '6379'),
        password: process.env['REDIS_PASSWORD'] || undefined,
        db: parseInt(process.env['REDIS_DB'] || '0'),
    },
    // JWT Configuration
    jwt: {
        secret: process.env['JWT_SECRET'] || 'dev-secret-change-in-production',
        expiresIn: process.env['JWT_EXPIRES_IN'] || '15m',
        refreshExpiresIn: process.env['JWT_REFRESH_EXPIRES_IN'] || '7d',
    },
    // Security Configuration
    security: {
        bcryptRounds: parseInt(process.env['BCRYPT_ROUNDS'] || '12'),
        rateLimitWindowMs: parseInt(process.env['RATE_LIMIT_WINDOW_MS'] || '900000'),
        rateLimitMaxRequests: parseInt(process.env['RATE_LIMIT_MAX_REQUESTS'] || '100'),
    },
    // Email Configuration
    email: {
        host: process.env['EMAIL_HOST'] || 'smtp.gmail.com',
        port: parseInt(process.env['EMAIL_PORT'] || '587'),
        user: process.env['EMAIL_USER'] || '',
        pass: process.env['EMAIL_PASS'] || '',
        from: process.env['EMAIL_FROM'] || 'noreply@tito-hr.com',
    },
    // File Upload Configuration
    upload: {
        maxSize: parseInt(process.env['UPLOAD_MAX_SIZE'] || '5242880'), // 5MB
        path: process.env['UPLOAD_PATH'] || './uploads',
        selfieRetentionDays: parseInt(process.env['SELFIE_RETENTION_DAYS'] || '2'),
    },
    // Logging Configuration
    logging: {
        level: process.env['LOG_LEVEL'] || 'info',
        file: process.env['LOG_FILE'] || './logs/app.log',
    },
    // CORS Configuration - Enhanced Security
    cors: {
        origin: (origin, callback) => {
            // SECURITY: Define strict allowed origins
            const allowedOrigins = process.env['CORS_ORIGIN']
                ? process.env['CORS_ORIGIN'].split(',').map(origin => origin.trim())
                : ['http://localhost:3001', 'http://localhost:5173'];
            // SECURITY: Only allow HTTPS in production
            if (process.env['NODE_ENV'] === 'production') {
                // Validate that all origins use HTTPS
                const invalidOrigins = allowedOrigins.filter(origin => !origin.startsWith('https://'));
                if (invalidOrigins.length > 0) {
                    console.warn('SECURITY WARNING: Non-HTTPS origins found in production:', invalidOrigins);
                }
            }
            // SECURITY: Validate origin format
            const validateOrigin = (origin) => {
                try {
                    const url = new URL(origin);
                    // Only allow http/https protocols
                    return ['http:', 'https:'].includes(url.protocol);
                }
                catch {
                    return false;
                }
            };
            // SECURITY: Reject requests with no origin (prevents some CSRF attacks)
            // Allow requests without origin in development for testing
            if (!origin && process.env['NODE_ENV'] !== 'production') {
                return callback(null, true);
            }
            if (!origin) {
                return callback(new Error('Origin header required'));
            }
            // SECURITY: Validate origin format
            if (!validateOrigin(origin)) {
                return callback(new Error('Invalid origin format'));
            }
            // SECURITY: Check against allowed origins
            if (allowedOrigins.includes(origin)) {
                callback(null, true);
            }
            else {
                console.warn('CORS blocked request from:', origin);
                callback(new Error('Not allowed by CORS policy'));
            }
        },
        credentials: process.env['CORS_CREDENTIALS'] === 'true',
        methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
        allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With', 'Accept'],
        maxAge: 86400, // 24 hours
        optionsSuccessStatus: 200 // Some legacy browsers choke on 204
    },
    // API Configuration
    api: {
        prefix: process.env['API_PREFIX'] || '/api',
        version: process.env['API_VERSION'] || 'v1',
    },
    // Health Check Configuration
    healthCheck: {
        interval: parseInt(process.env['HEALTH_CHECK_INTERVAL'] || '30000'),
        timeout: parseInt(process.env['HEALTH_CHECK_TIMEOUT'] || '5000'),
    },
};
// Validate required environment variables
const validateEnvironment = () => {
    // Only require JWT_SECRET for development
    const required = process.env['NODE_ENV'] === 'production' ? [
        'DB_HOST',
        'DB_NAME',
        'DB_USER',
        'DB_PASSWORD',
        'JWT_SECRET',
    ] : [
        'JWT_SECRET',
    ];
    const missing = required.filter(key => !process.env[key]);
    if (missing.length > 0) {
        throw new Error(`Missing required environment variables: ${missing.join(', ')}`);
    }
};
exports.validateEnvironment = validateEnvironment;
// Check if we're in production
const isProduction = () => exports.config.server.nodeEnv === 'production';
exports.isProduction = isProduction;
const isDevelopment = () => exports.config.server.nodeEnv === 'development';
exports.isDevelopment = isDevelopment;
const isTest = () => exports.config.server.nodeEnv === 'test';
exports.isTest = isTest;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGlCQUEwRDtBQUM3RSxNQUFNLE1BQU0sR0FBRyxHQUFZLEVBQUUsQ0FBQyxjQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sS0FBSyxNQUFNLENBQUM7QUFBekQsUUFBQSxNQUFNLFVBQW1EIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2tpbS90aXRvL3NlcnZlci9zcmMvY29uZmlnL2Vudmlyb25tZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkb3RlbnYgZnJvbSAnZG90ZW52JztcblxuLy8gTG9hZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZnJvbSAuZW52IGZpbGVcbmRvdGVudi5jb25maWcoKTtcblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgLy8gU2VydmVyIENvbmZpZ3VyYXRpb25cbiAgc2VydmVyOiB7XG4gICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnZbJ1BPUlQnXSB8fCAnMzAwMCcpLFxuICAgIGhvc3Q6IHByb2Nlc3MuZW52WydIT1NUJ10gfHwgJ2xvY2FsaG9zdCcsXG4gICAgbm9kZUVudjogcHJvY2Vzcy5lbnZbJ05PREVfRU5WJ10gfHwgJ2RldmVsb3BtZW50JyxcbiAgfSxcblxuICAvLyBGcm9udGVuZCBDb25maWd1cmF0aW9uXG4gIGZyb250ZW5kOiB7XG4gICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnZbJ0ZST05URU5EX1BPUlQnXSB8fCAnMzAwMScpLFxuICAgIGhvc3Q6IHByb2Nlc3MuZW52WydGUk9OVEVORF9IT1NUJ10gfHwgJ2xvY2FsaG9zdCcsXG4gICAgdXJsOiBwcm9jZXNzLmVudlsnRlJPTlRFTkRfVVJMJ10gfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMScsXG4gIH0sXG5cbiAgLy8gRGF0YWJhc2UgQ29uZmlndXJhdGlvbiAoUG9zdGdyZVNRTClcbiAgZGF0YWJhc2U6IHtcbiAgICBob3N0OiBwcm9jZXNzLmVudlsnREJfSE9TVCddIHx8ICdsb2NhbGhvc3QnLFxuICAgIHBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52WydEQl9QT1JUJ10gfHwgJzU0MzInKSxcbiAgICBuYW1lOiBwcm9jZXNzLmVudlsnREJfTkFNRSddIHx8ICd0aXRvX2hyJyxcbiAgICB1c2VyOiBwcm9jZXNzLmVudlsnREJfVVNFUiddIHx8ICdwb3N0Z3JlcycsXG4gICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52WydEQl9QQVNTV09SRCddIHx8ICcnLFxuICAgIHNzbDogcHJvY2Vzcy5lbnZbJ0RCX1NTTCddID09PSAndHJ1ZScsXG4gICAgbWF4Q29ubmVjdGlvbnM6IDIwLFxuICAgIGlkbGVUaW1lb3V0TWlsbGlzOiAzMDAwMCxcbiAgICBjb25uZWN0aW9uVGltZW91dE1pbGxpczogMTAwMDAsXG4gIH0sXG5cbiAgLy8gUmVkaXMgQ29uZmlndXJhdGlvblxuICByZWRpczoge1xuICAgIGhvc3Q6IHByb2Nlc3MuZW52WydSRURJU19IT1NUJ10gfHwgJ2xvY2FsaG9zdCcsXG4gICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnZbJ1JFRElTX1BPUlQnXSB8fCAnNjM3OScpLFxuICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudlsnUkVESVNfUEFTU1dPUkQnXSB8fCB1bmRlZmluZWQsXG4gICAgZGI6IHBhcnNlSW50KHByb2Nlc3MuZW52WydSRURJU19EQiddIHx8ICcwJyksXG4gIH0sXG5cbiAgLy8gSldUIENvbmZpZ3VyYXRpb25cbiAgand0OiB7XG4gICAgc2VjcmV0OiBwcm9jZXNzLmVudlsnSldUX1NFQ1JFVCddIHx8ICdkZXYtc2VjcmV0LWNoYW5nZS1pbi1wcm9kdWN0aW9uJyxcbiAgICBleHBpcmVzSW46IHByb2Nlc3MuZW52WydKV1RfRVhQSVJFU19JTiddIHx8ICcxNW0nLFxuICAgIHJlZnJlc2hFeHBpcmVzSW46IHByb2Nlc3MuZW52WydKV1RfUkVGUkVTSF9FWFBJUkVTX0lOJ10gfHwgJzdkJyxcbiAgfSxcblxuICAvLyBTZWN1cml0eSBDb25maWd1cmF0aW9uXG4gIHNlY3VyaXR5OiB7XG4gICAgYmNyeXB0Um91bmRzOiBwYXJzZUludChwcm9jZXNzLmVudlsnQkNSWVBUX1JPVU5EUyddIHx8ICcxMicpLFxuICAgIHJhdGVMaW1pdFdpbmRvd01zOiBwYXJzZUludChwcm9jZXNzLmVudlsnUkFURV9MSU1JVF9XSU5ET1dfTVMnXSB8fCAnOTAwMDAwJyksXG4gICAgcmF0ZUxpbWl0TWF4UmVxdWVzdHM6IHBhcnNlSW50KHByb2Nlc3MuZW52WydSQVRFX0xJTUlUX01BWF9SRVFVRVNUUyddIHx8ICcxMDAnKSxcbiAgfSxcblxuICAvLyBFbWFpbCBDb25maWd1cmF0aW9uXG4gIGVtYWlsOiB7XG4gICAgaG9zdDogcHJvY2Vzcy5lbnZbJ0VNQUlMX0hPU1QnXSB8fCAnc210cC5nbWFpbC5jb20nLFxuICAgIHBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52WydFTUFJTF9QT1JUJ10gfHwgJzU4NycpLFxuICAgIHVzZXI6IHByb2Nlc3MuZW52WydFTUFJTF9VU0VSJ10gfHwgJycsXG4gICAgcGFzczogcHJvY2Vzcy5lbnZbJ0VNQUlMX1BBU1MnXSB8fCAnJyxcbiAgICBmcm9tOiBwcm9jZXNzLmVudlsnRU1BSUxfRlJPTSddIHx8ICdub3JlcGx5QHRpdG8taHIuY29tJyxcbiAgfSxcblxuICAvLyBGaWxlIFVwbG9hZCBDb25maWd1cmF0aW9uXG4gIHVwbG9hZDoge1xuICAgIG1heFNpemU6IHBhcnNlSW50KHByb2Nlc3MuZW52WydVUExPQURfTUFYX1NJWkUnXSB8fCAnNTI0Mjg4MCcpLCAvLyA1TUJcbiAgICBwYXRoOiBwcm9jZXNzLmVudlsnVVBMT0FEX1BBVEgnXSB8fCAnLi91cGxvYWRzJyxcbiAgICBzZWxmaWVSZXRlbnRpb25EYXlzOiBwYXJzZUludChwcm9jZXNzLmVudlsnU0VMRklFX1JFVEVOVElPTl9EQVlTJ10gfHwgJzInKSxcbiAgfSxcblxuICAvLyBMb2dnaW5nIENvbmZpZ3VyYXRpb25cbiAgbG9nZ2luZzoge1xuICAgIGxldmVsOiBwcm9jZXNzLmVudlsnTE9HX0xFVkVMJ10gfHwgJ2luZm8nLFxuICAgIGZpbGU6IHByb2Nlc3MuZW52WydMT0dfRklMRSddIHx8ICcuL2xvZ3MvYXBwLmxvZycsXG4gIH0sXG5cbiAgLy8gQ09SUyBDb25maWd1cmF0aW9uIC0gRW5oYW5jZWQgU2VjdXJpdHlcbiAgY29yczoge1xuICAgIG9yaWdpbjogKG9yaWdpbjogc3RyaW5nIHwgdW5kZWZpbmVkLCBjYWxsYmFjazogKGVycjogRXJyb3IgfCBudWxsLCBhbGxvdz86IGJvb2xlYW4pID0+IHZvaWQpID0+IHtcbiAgICAgIC8vIFNFQ1VSSVRZOiBEZWZpbmUgc3RyaWN0IGFsbG93ZWQgb3JpZ2luc1xuICAgICAgY29uc3QgYWxsb3dlZE9yaWdpbnMgPSBwcm9jZXNzLmVudlsnQ09SU19PUklHSU4nXVxuICAgICAgICA/IHByb2Nlc3MuZW52WydDT1JTX09SSUdJTiddLnNwbGl0KCcsJykubWFwKG9yaWdpbiA9PiBvcmlnaW4udHJpbSgpKVxuICAgICAgICA6IFsnaHR0cDovL2xvY2FsaG9zdDozMDAxJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6NTE3MyddO1xuXG4gICAgICAvLyBTRUNVUklUWTogT25seSBhbGxvdyBIVFRQUyBpbiBwcm9kdWN0aW9uXG4gICAgICBpZiAocHJvY2Vzcy5lbnZbJ05PREVfRU5WJ10gPT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgICAvLyBWYWxpZGF0ZSB0aGF0IGFsbCBvcmlnaW5zIHVzZSBIVFRQU1xuICAgICAgICBjb25zdCBpbnZhbGlkT3JpZ2lucyA9IGFsbG93ZWRPcmlnaW5zLmZpbHRlcihvcmlnaW4gPT4gIW9yaWdpbi5zdGFydHNXaXRoKCdodHRwczovLycpKTtcbiAgICAgICAgaWYgKGludmFsaWRPcmlnaW5zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ1NFQ1VSSVRZIFdBUk5JTkc6IE5vbi1IVFRQUyBvcmlnaW5zIGZvdW5kIGluIHByb2R1Y3Rpb246JywgaW52YWxpZE9yaWdpbnMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNFQ1VSSVRZOiBWYWxpZGF0ZSBvcmlnaW4gZm9ybWF0XG4gICAgICBjb25zdCB2YWxpZGF0ZU9yaWdpbiA9IChvcmlnaW46IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwob3JpZ2luKTtcbiAgICAgICAgICAvLyBPbmx5IGFsbG93IGh0dHAvaHR0cHMgcHJvdG9jb2xzXG4gICAgICAgICAgcmV0dXJuIFsnaHR0cDonLCAnaHR0cHM6J10uaW5jbHVkZXModXJsLnByb3RvY29sKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBTRUNVUklUWTogUmVqZWN0IHJlcXVlc3RzIHdpdGggbm8gb3JpZ2luIChwcmV2ZW50cyBzb21lIENTUkYgYXR0YWNrcylcbiAgICAgIC8vIEFsbG93IHJlcXVlc3RzIHdpdGhvdXQgb3JpZ2luIGluIGRldmVsb3BtZW50IGZvciB0ZXN0aW5nXG4gICAgICBpZiAoIW9yaWdpbiAmJiBwcm9jZXNzLmVudlsnTk9ERV9FTlYnXSAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB0cnVlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFvcmlnaW4pIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBFcnJvcignT3JpZ2luIGhlYWRlciByZXF1aXJlZCcpKTtcbiAgICAgIH1cblxuICAgICAgLy8gU0VDVVJJVFk6IFZhbGlkYXRlIG9yaWdpbiBmb3JtYXRcbiAgICAgIGlmICghdmFsaWRhdGVPcmlnaW4ob3JpZ2luKSkge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobmV3IEVycm9yKCdJbnZhbGlkIG9yaWdpbiBmb3JtYXQnKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNFQ1VSSVRZOiBDaGVjayBhZ2FpbnN0IGFsbG93ZWQgb3JpZ2luc1xuICAgICAgaWYgKGFsbG93ZWRPcmlnaW5zLmluY2x1ZGVzKG9yaWdpbikpIHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0NPUlMgYmxvY2tlZCByZXF1ZXN0IGZyb206Jywgb3JpZ2luKTtcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCdOb3QgYWxsb3dlZCBieSBDT1JTIHBvbGljeScpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNyZWRlbnRpYWxzOiBwcm9jZXNzLmVudlsnQ09SU19DUkVERU5USUFMUyddID09PSAndHJ1ZScsXG4gICAgbWV0aG9kczogWydHRVQnLCAnUE9TVCcsICdQVVQnLCAnREVMRVRFJywgJ1BBVENIJywgJ09QVElPTlMnXSxcbiAgICBhbGxvd2VkSGVhZGVyczogWydDb250ZW50LVR5cGUnLCAnQXV0aG9yaXphdGlvbicsICdYLVJlcXVlc3RlZC1XaXRoJywgJ0FjY2VwdCddLFxuICAgIG1heEFnZTogODY0MDAsIC8vIDI0IGhvdXJzXG4gICAgb3B0aW9uc1N1Y2Nlc3NTdGF0dXM6IDIwMCAvLyBTb21lIGxlZ2FjeSBicm93c2VycyBjaG9rZSBvbiAyMDRcbiAgfSxcblxuICAvLyBBUEkgQ29uZmlndXJhdGlvblxuICBhcGk6IHtcbiAgICBwcmVmaXg6IHByb2Nlc3MuZW52WydBUElfUFJFRklYJ10gfHwgJy9hcGknLFxuICAgIHZlcnNpb246IHByb2Nlc3MuZW52WydBUElfVkVSU0lPTiddIHx8ICd2MScsXG4gIH0sXG5cbiAgLy8gSGVhbHRoIENoZWNrIENvbmZpZ3VyYXRpb25cbiAgaGVhbHRoQ2hlY2s6IHtcbiAgICBpbnRlcnZhbDogcGFyc2VJbnQocHJvY2Vzcy5lbnZbJ0hFQUxUSF9DSEVDS19JTlRFUlZBTCddIHx8ICczMDAwMCcpLFxuICAgIHRpbWVvdXQ6IHBhcnNlSW50KHByb2Nlc3MuZW52WydIRUFMVEhfQ0hFQ0tfVElNRU9VVCddIHx8ICc1MDAwJyksXG4gIH0sXG59O1xuXG4vLyBWYWxpZGF0ZSByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbmV4cG9ydCBjb25zdCB2YWxpZGF0ZUVudmlyb25tZW50ID0gKCk6IHZvaWQgPT4ge1xuICAvLyBPbmx5IHJlcXVpcmUgSldUX1NFQ1JFVCBmb3IgZGV2ZWxvcG1lbnRcbiAgY29uc3QgcmVxdWlyZWQgPSBwcm9jZXNzLmVudlsnTk9ERV9FTlYnXSA9PT0gJ3Byb2R1Y3Rpb24nID8gW1xuICAgICdEQl9IT1NUJyxcbiAgICAnREJfTkFNRScsXG4gICAgJ0RCX1VTRVInLFxuICAgICdEQl9QQVNTV09SRCcsXG4gICAgJ0pXVF9TRUNSRVQnLFxuICBdIDogW1xuICAgICdKV1RfU0VDUkVUJyxcbiAgXTtcblxuICBjb25zdCBtaXNzaW5nID0gcmVxdWlyZWQuZmlsdGVyKGtleSA9PiAhcHJvY2Vzcy5lbnZba2V5XSk7XG4gIFxuICBpZiAobWlzc2luZy5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIHJlcXVpcmVkIGVudmlyb25tZW50IHZhcmlhYmxlczogJHttaXNzaW5nLmpvaW4oJywgJyl9YCk7XG4gIH1cbn07XG5cbi8vIENoZWNrIGlmIHdlJ3JlIGluIHByb2R1Y3Rpb25cbmV4cG9ydCBjb25zdCBpc1Byb2R1Y3Rpb24gPSAoKTogYm9vbGVhbiA9PiBjb25maWcuc2VydmVyLm5vZGVFbnYgPT09ICdwcm9kdWN0aW9uJztcbmV4cG9ydCBjb25zdCBpc0RldmVsb3BtZW50ID0gKCk6IGJvb2xlYW4gPT4gY29uZmlnLnNlcnZlci5ub2RlRW52ID09PSAnZGV2ZWxvcG1lbnQnO1xuZXhwb3J0IGNvbnN0IGlzVGVzdCA9ICgpOiBib29sZWFuID0+IGNvbmZpZy5zZXJ2ZXIubm9kZUVudiA9PT0gJ3Rlc3QnOyAiXSwidmVyc2lvbiI6M30=