beed8d5db22fcd5d3da0d3bfbd37a2ce
"use strict";
/**
 * Mock Database Service for Testing
 *
 * This mock service provides the same interface as the real database service
 * but stores data in memory instead of connecting to PostgreSQL.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockDatabaseService = exports.MockDatabaseService = void 0;
class MockDatabaseService {
    constructor() {
        this.data = {};
        this.sequenceCounters = {};
        this.initializeSequences();
    }
    initializeSequences() {
        // Initialize sequence counters
        this.sequenceCounters = {
            users_id_seq: 1,
            departments_id_seq: 1,
            employees_id_seq: 1,
            attendance_records_id_seq: 1,
            attendance_sessions_id_seq: 1,
            time_correction_requests_id_seq: 1,
            overtime_requests_id_seq: 1,
            leaves_id_seq: 1,
            leave_balances_id_seq: 1,
            payroll_periods_id_seq: 1,
            payroll_records_id_seq: 1,
            payroll_deductions_id_seq: 1,
            deduction_types_id_seq: 1,
            payroll_approvals_id_seq: 1,
            system_settings_id_seq: 1,
            id_cards_id_seq: 1
        };
        // Initialize table data
        this.data = {
            users: {},
            departments: {},
            employees: {},
            attendance_records: {},
            attendance_sessions: {},
            time_correction_requests: {},
            overtime_requests: {},
            leaves: {},
            leave_balances: {},
            payroll_periods: {},
            payroll_records: {},
            payroll_deductions: {},
            deduction_types: {},
            payroll_approvals: {},
            system_settings: {},
            id_cards: {}
        };
    }
    // Event emitter methods
    on(_event, _callback) {
        // Mock event emitter - do nothing for tests
    }
    // Connection methods
    async connect() {
        return {
            query: this.query.bind(this),
            release: () => { }
        };
    }
    async query(query, values = []) {
        const normalizedQuery = query.trim().toLowerCase();
        // Handle INSERT queries
        if (normalizedQuery.startsWith('insert into')) {
            return this.handleInsert(query, values);
        }
        // Handle SELECT queries
        if (normalizedQuery.startsWith('select')) {
            return this.handleSelect(query, values);
        }
        // Handle UPDATE queries
        if (normalizedQuery.startsWith('update')) {
            return this.handleUpdate(query, values);
        }
        // Handle DELETE queries
        if (normalizedQuery.startsWith('delete')) {
            return this.handleDelete(query, values);
        }
        // Handle ALTER SEQUENCE queries
        if (normalizedQuery.startsWith('alter sequence')) {
            return this.handleAlterSequence(query, values);
        }
        // Handle SET queries
        if (normalizedQuery.startsWith('set')) {
            return { rows: [], rowCount: 0 };
        }
        // Default response for other queries
        return { rows: [], rowCount: 0 };
    }
    handleInsert(query, values) {
        // Extract table name from INSERT query
        const tableMatch = query.match(/insert into\s+(\w+)/i);
        if (!tableMatch) {
            return { rows: [], rowCount: 0 };
        }
        const tableName = tableMatch[1];
        // Generate ID if not provided
        const id = this.generateId(tableName);
        // Create row data
        const row = { id };
        // Map values to columns (simplified - assumes values are in order)
        const columnMatch = query.match(/insert into\s+\w+\s*\(([^)]+)\)/i);
        if (columnMatch) {
            const columns = columnMatch[1].split(',').map(col => col.trim());
            columns.forEach((column, index) => {
                if (values[index] !== undefined) {
                    row[column] = values[index];
                }
            });
        }
        // Store in mock data
        this.data[tableName][id] = row;
        // Return the inserted row
        return { rows: [row], rowCount: 1 };
    }
    handleSelect(query, values) {
        // Handle COUNT(*) queries (case-insensitive)
        if (query.toLowerCase().includes('count(*)')) {
            const tableMatch = query.match(/from\s+(\w+)/i);
            if (!tableMatch) {
                return { rows: [{ count: '0' }], rowCount: 1 };
            }
            const tableName = tableMatch[1];
            const tableData = this.data[tableName] || {};
            let count = Object.keys(tableData).length;
            // Handle WHERE clauses for COUNT
            if (query.includes('where')) {
                let rows = Object.values(tableData);
                // Handle WHERE status = $1
                if (query.includes('where status = $1') && values[0]) {
                    rows = rows.filter(row => row.status === values[0]);
                }
                // Handle WHERE employee_id = $1
                if (query.includes('where employee_id = $1') && values[0]) {
                    rows = rows.filter(row => row.employee_id === values[0]);
                }
                count = rows.length;
            }
            return { rows: [{ count: count.toString() }], rowCount: 1 };
        }
        // Handle SUM queries (case-insensitive)
        if (query.toLowerCase().includes('sum(')) {
            const tableMatch = query.match(/from\s+(\w+)/i);
            if (!tableMatch) {
                return { rows: [{ total: '0' }], rowCount: 1 };
            }
            const tableName = tableMatch[1];
            const tableData = this.data[tableName] || {};
            let rows = Object.values(tableData);
            // Handle WHERE clauses for SUM
            if (query.includes('where')) {
                // Handle WHERE status = $1
                if (query.includes('where status = $1') && values[0]) {
                    rows = rows.filter(row => row.status === values[0]);
                }
            }
            // Calculate sum (for simplicity, assume we're summing a numeric field)
            const sum = rows.reduce((total, row) => {
                // Try to find a numeric field to sum (net_pay, gross_pay, etc.)
                const numericFields = ['net_pay', 'gross_pay', 'total_deductions', 'total_benefits'];
                for (const field of numericFields) {
                    if (row[field] !== undefined) {
                        return total + (parseFloat(row[field]) || 0);
                    }
                }
                return total;
            }, 0);
            return { rows: [{ total: sum.toString() }], rowCount: 1 };
        }
        // Extract table name from SELECT query
        const tableMatch = query.match(/from\s+(\w+)/i);
        if (!tableMatch) {
            return { rows: [], rowCount: 0 };
        }
        const tableName = tableMatch[1];
        const tableData = this.data[tableName] || {};
        // Simple WHERE clause handling
        let rows = Object.values(tableData);
        // Handle WHERE id = $1
        if (query.includes('where id = $1') && values[0]) {
            rows = rows.filter(row => row.id === values[0]);
        }
        // Handle WHERE email = $1
        if (query.includes('where email = $1') && values[0]) {
            rows = rows.filter(row => row.email === values[0]);
        }
        // Handle WHERE status = $1
        if (query.includes('where status = $1') && values[0]) {
            rows = rows.filter(row => row.status === values[0]);
        }
        // Handle WHERE employee_id = $1
        if (query.includes('where employee_id = $1') && values[0]) {
            rows = rows.filter(row => row.employee_id === values[0]);
        }
        // Handle WHERE attendance_record_id = $1
        if (query.includes('where attendance_record_id = $1') && values[0]) {
            rows = rows.filter(row => row.attendance_record_id === values[0]);
        }
        // Handle WHERE date = $1
        if (query.includes('where date = $1') && values[0]) {
            rows = rows.filter(row => row.date === values[0]);
        }
        // Handle ORDER BY
        if (query.includes('order by')) {
            if (query.includes('order by first_name, last_name')) {
                rows.sort((a, b) => {
                    const nameA = `${a.first_name || ''} ${a.last_name || ''}`.trim();
                    const nameB = `${b.first_name || ''} ${b.last_name || ''}`.trim();
                    return nameA.localeCompare(nameB);
                });
            }
        }
        // Handle LIMIT
        if (query.includes('limit')) {
            const limitMatch = query.match(/limit\s+(\d+)/i);
            if (limitMatch) {
                const limit = parseInt(limitMatch[1]);
                rows = rows.slice(0, limit);
            }
        }
        return { rows, rowCount: rows.length };
    }
    handleUpdate(query, values) {
        // Extract table name from UPDATE query
        const tableMatch = query.match(/update\s+(\w+)/i);
        if (!tableMatch) {
            return { rows: [], rowCount: 0 };
        }
        const tableName = tableMatch[1];
        const tableData = this.data[tableName] || {};
        // Handle WHERE id = $1
        if (query.includes('where id = $1') && values[0]) {
            const id = values[0];
            if (tableData[id]) {
                // Update the row (simplified - assumes SET clause is at the end)
                const setMatch = query.match(/set\s+(.+?)\s+where/i);
                if (setMatch) {
                    const setClause = setMatch[1];
                    const updates = setClause.split(',').map(update => update.trim());
                    updates.forEach(update => {
                        const [column, value] = update.split('=').map(part => part.trim());
                        if (value.startsWith('$')) {
                            const paramIndex = parseInt(value.substring(1)) - 1;
                            if (values[paramIndex] !== undefined) {
                                tableData[id][column] = values[paramIndex];
                            }
                        }
                    });
                }
                return { rows: [tableData[id]], rowCount: 1 };
            }
        }
        return { rows: [], rowCount: 0 };
    }
    handleDelete(query, values) {
        // Extract table name from DELETE query
        const tableMatch = query.match(/delete from\s+(\w+)/i);
        if (!tableMatch) {
            return { rows: [], rowCount: 0 };
        }
        const tableName = tableMatch[1];
        const tableData = this.data[tableName] || {};
        // Handle WHERE id = $1
        if (query.includes('where id = $1') && values[0]) {
            const id = values[0];
            if (tableData[id]) {
                delete tableData[id];
                return { rows: [], rowCount: 1 };
            }
        }
        // Handle DELETE FROM table (no WHERE clause)
        if (!query.includes('where')) {
            const rowCount = Object.keys(tableData).length;
            this.data[tableName] = {};
            return { rows: [], rowCount };
        }
        return { rows: [], rowCount: 0 };
    }
    handleAlterSequence(query, _values) {
        // Extract sequence name from ALTER SEQUENCE query
        const sequenceMatch = query.match(/alter sequence\s+(\w+)/i);
        if (sequenceMatch) {
            const sequenceName = sequenceMatch[1];
            this.sequenceCounters[sequenceName] = 1;
        }
        return { rows: [], rowCount: 0 };
    }
    generateId(_tableName) {
        // Generate a UUID-like ID
        const timestamp = Date.now();
        const random = Math.random().toString(36).substring(2, 15);
        return `${timestamp}-${random}`;
    }
    // Test utilities
    getData() {
        return { ...this.data };
    }
    clearData() {
        this.initializeSequences();
    }
    setData(tableName, data) {
        this.data[tableName] = { ...data };
    }
    getTableData(tableName) {
        return { ...this.data[tableName] };
    }
}
exports.MockDatabaseService = MockDatabaseService;
// Singleton instance for tests
exports.mockDatabaseService = new MockDatabaseService();
// Export for use in tests
exports.default = exports.mockDatabaseService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUva2ltL3RpdG8vc2VydmVyL3Rlc3RzL3V0aWxzL21vY2tEYXRhYmFzZVNlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUFhSCxNQUFhLG1CQUFtQjtJQUk5QjtRQUhRLFNBQUksR0FBcUIsRUFBRSxDQUFDO1FBQzVCLHFCQUFnQixHQUF1QyxFQUFFLENBQUM7UUFHaEUsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVPLG1CQUFtQjtRQUN6QiwrQkFBK0I7UUFDL0IsSUFBSSxDQUFDLGdCQUFnQixHQUFHO1lBQ3RCLFlBQVksRUFBRSxDQUFDO1lBQ2Ysa0JBQWtCLEVBQUUsQ0FBQztZQUNyQixnQkFBZ0IsRUFBRSxDQUFDO1lBQ25CLHlCQUF5QixFQUFFLENBQUM7WUFDNUIsMEJBQTBCLEVBQUUsQ0FBQztZQUM3QiwrQkFBK0IsRUFBRSxDQUFDO1lBQ2xDLHdCQUF3QixFQUFFLENBQUM7WUFDM0IsYUFBYSxFQUFFLENBQUM7WUFDaEIscUJBQXFCLEVBQUUsQ0FBQztZQUN4QixzQkFBc0IsRUFBRSxDQUFDO1lBQ3pCLHNCQUFzQixFQUFFLENBQUM7WUFDekIseUJBQXlCLEVBQUUsQ0FBQztZQUM1QixzQkFBc0IsRUFBRSxDQUFDO1lBQ3pCLHdCQUF3QixFQUFFLENBQUM7WUFDM0Isc0JBQXNCLEVBQUUsQ0FBQztZQUN6QixlQUFlLEVBQUUsQ0FBQztTQUNuQixDQUFDO1FBRUYsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxJQUFJLEdBQUc7WUFDVixLQUFLLEVBQUUsRUFBRTtZQUNULFdBQVcsRUFBRSxFQUFFO1lBQ2YsU0FBUyxFQUFFLEVBQUU7WUFDYixrQkFBa0IsRUFBRSxFQUFFO1lBQ3RCLG1CQUFtQixFQUFFLEVBQUU7WUFDdkIsd0JBQXdCLEVBQUUsRUFBRTtZQUM1QixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLE1BQU0sRUFBRSxFQUFFO1lBQ1YsY0FBYyxFQUFFLEVBQUU7WUFDbEIsZUFBZSxFQUFFLEVBQUU7WUFDbkIs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MUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzdCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzRCxPQUFPLEdBQUcsU0FBUyxJQUFJLE1BQU0sRUFBRSxDQUFDO0lBQ2xDLENBQUM7SUFFRCxpQkFBaUI7SUFDakIsT0FBTztRQUNMLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRUQsU0FBUztRQUNQLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxPQUFPLENBQUMsU0FBaUIsRUFBRSxJQUFTO1FBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFFRCxZQUFZLENBQUMsU0FBaUI7UUFDNUIsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO0lBQ3JDLENBQUM7Q0FDRjtBQTNXRCxrREEyV0M7QUFFRCwrQkFBK0I7QUFDbEIsUUFBQSxtQkFBbUIsR0FBRyxJQUFJLG1CQUFtQixFQUFFLENBQUM7QUFFN0QsMEJBQTBCO0FBQzFCLGtCQUFlLDJCQUFtQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2tpbS90aXRvL3NlcnZlci90ZXN0cy91dGlscy9tb2NrRGF0YWJhc2VTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9jayBEYXRhYmFzZSBTZXJ2aWNlIGZvciBUZXN0aW5nXG4gKiBcbiAqIFRoaXMgbW9jayBzZXJ2aWNlIHByb3ZpZGVzIHRoZSBzYW1lIGludGVyZmFjZSBhcyB0aGUgcmVhbCBkYXRhYmFzZSBzZXJ2aWNlXG4gKiBidXQgc3RvcmVzIGRhdGEgaW4gbWVtb3J5IGluc3RlYWQgb2YgY29ubmVjdGluZyB0byBQb3N0Z3JlU1FMLlxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9ja1F1ZXJ5UmVzdWx0IHtcbiAgcm93czogYW55W107XG4gIHJvd0NvdW50OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9ja0RhdGFiYXNlRGF0YSB7XG4gIFt0YWJsZU5hbWU6IHN0cmluZ106IHtcbiAgICBbaWQ6IHN0cmluZ106IGFueTtcbiAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIE1vY2tEYXRhYmFzZVNlcnZpY2Uge1xuICBwcml2YXRlIGRhdGE6IE1vY2tEYXRhYmFzZURhdGEgPSB7fTtcbiAgcHJpdmF0ZSBzZXF1ZW5jZUNvdW50ZXJzOiB7IFtzZXF1ZW5jZU5hbWU6IHN0cmluZ106IG51bWJlciB9ID0ge307XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplU2VxdWVuY2VzKCk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVTZXF1ZW5jZXMoKTogdm9pZCB7XG4gICAgLy8gSW5pdGlhbGl6ZSBzZXF1ZW5jZSBjb3VudGVyc1xuICAgIHRoaXMuc2VxdWVuY2VDb3VudGVycyA9IHtcbiAgICAgIHVzZXJzX2lkX3NlcTogMSxcbiAgICAgIGRlcGFydG1lbnRzX2lkX3NlcTogMSxcbiAgICAgIGVtcGxveWVlc19pZF9zZXE6IDEsXG4gICAgICBhdHRlbmRhbmNlX3JlY29yZHNfaWRfc2VxOiAxLFxuICAgICAgYXR0ZW5kYW5jZV9zZXNzaW9uc19pZF9zZXE6IDEsXG4gICAgICB0aW1lX2NvcnJlY3Rpb25fcmVxdWVzdHNfaWRfc2VxOiAxLFxuICAgICAgb3ZlcnRpbWVfcmVxdWVzdHNfaWRfc2VxOiAxLFxuICAgICAgbGVhdmVzX2lkX3NlcTogMSxcbiAgICAgIGxlYXZlX2JhbGFuY2VzX2lkX3NlcTogMSxcbiAgICAgIHBheXJvbGxfcGVyaW9kc19pZF9zZXE6IDEsXG4gICAgICBwYXlyb2xsX3JlY29yZHNfaWRfc2VxOiAxLFxuICAgICAgcGF5cm9sbF9kZWR1Y3Rpb25zX2lkX3NlcTogMSxcbiAgICAgIGRlZHVjdGlvbl90eXBlc19pZF9zZXE6IDEsXG4gICAgICBwYXlyb2xsX2FwcHJvdmFsc19pZF9zZXE6IDEsXG4gICAgICBzeXN0ZW1fc2V0dGluZ3NfaWRfc2VxOiAxLFxuICAgICAgaWRfY2FyZHNfaWRfc2VxOiAxXG4gICAgfTtcblxuICAgIC8vIEluaXRpYWxpemUgdGFibGUgZGF0YVxuICAgIHRoaXMuZGF0YSA9IHtcbiAgICAgIHVzZXJzOiB7fSxcbiAgICAgIGRlcGFydG1lbnRzOiB7fSxcbiAgICAgIGVtcGxveWVlczoge30sXG4gICAgICBhdHRlbmRhbmNlX3JlY29yZHM6IHt9LFxuICAgICAgYXR0ZW5kYW5jZV9zZXNzaW9uczoge30sXG4gICAgICB0aW1lX2NvcnJlY3Rpb25fcmVxdWVzdHM6IHt9LFxuICAgICAgb3ZlcnRpbWVfcmVxdWVzdHM6IHt9LFxuICAgICAgbGVhdmVzOiB7fSxcbiAgICAgIGxlYXZlX2JhbGFuY2VzOiB7fSxcbiAgICAgIHBheXJvbGxfcGVyaW9kczoge30sXG4gICAgICBwYXlyb2xsX3JlY29yZHM6IHt9LFxuICAgICAgcGF5cm9sbF9kZWR1Y3Rpb25zOiB7fSxcbiAgICAgIGRlZHVjdGlvbl90eXBlczoge30sXG4gICAgICBwYXlyb2xsX2FwcHJvdmFsczoge30sXG4gICAgICBzeXN0ZW1fc2V0dGluZ3M6IHt9LFxuICAgICAgaWRfY2FyZHM6IHt9XG4gICAgfTtcbiAgfVxuXG4gIC8vIEV2ZW50IGVtaXR0ZXIgbWV0aG9kc1xuICBvbihfZXZlbnQ6IHN0cmluZywgX2NhbGxiYWNrOiAoLi4uYXJnczogYW55W10pID0+IHZvaWQpOiB2b2lkIHtcbiAgICAvLyBNb2NrIGV2ZW50IGVtaXR0ZXIgLSBkbyBub3RoaW5nIGZvciB0ZXN0c1xuICB9XG5cbiAgLy8gQ29ubmVjdGlvbiBtZXRob2RzXG4gIGFzeW5jIGNvbm5lY3QoKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4ge1xuICAgICAgcXVlcnk6IHRoaXMucXVlcnkuYmluZCh0aGlzKSxcbiAgICAgIHJlbGVhc2U6ICgpID0+IHt9XG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIHF1ZXJ5KHF1ZXJ5OiBzdHJpbmcsIHZhbHVlczogYW55W10gPSBbXSk6IFByb21pc2U8TW9ja1F1ZXJ5UmVzdWx0PiB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFF1ZXJ5ID0gcXVlcnkudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgXG4gICAgLy8gSGFuZGxlIElOU0VSVCBxdWVyaWVzXG4gICAgaWYgKG5vcm1hbGl6ZWRRdWVyeS5zdGFydHNXaXRoKCdpbnNlcnQgaW50bycpKSB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVJbnNlcnQocXVlcnksIHZhbHVlcyk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBTRUxFQ1QgcXVlcmllc1xuICAgIGlmIChub3JtYWxpemVkUXVlcnkuc3RhcnRzV2l0aCgnc2VsZWN0JykpIHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZVNlbGVjdChxdWVyeSwgdmFsdWVzKTtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIFVQREFURSBxdWVyaWVzXG4gICAgaWYgKG5vcm1hbGl6ZWRRdWVyeS5zdGFydHNXaXRoKCd1cGRhdGUnKSkge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVXBkYXRlKHF1ZXJ5LCB2YWx1ZXMpO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgREVMRVRFIHF1ZXJpZXNcbiAgICBpZiAobm9ybWFsaXplZFF1ZXJ5LnN0YXJ0c1dpdGgoJ2RlbGV0ZScpKSB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVEZWxldGUocXVlcnksIHZhbHVlcyk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBBTFRFUiBTRVFVRU5DRSBxdWVyaWVzXG4gICAgaWYgKG5vcm1hbGl6ZWRRdWVyeS5zdGFydHNXaXRoKCdhbHRlciBzZXF1ZW5jZScpKSB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVBbHRlclNlcXVlbmNlKHF1ZXJ5LCB2YWx1ZXMpO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgU0VUIHF1ZXJpZXNcbiAgICBpZiAobm9ybWFsaXplZFF1ZXJ5LnN0YXJ0c1dpdGgoJ3NldCcpKSB7XG4gICAgICByZXR1cm4geyByb3dzOiBbXSwgcm93Q291bnQ6IDAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gRGVmYXVsdCByZXNwb25zZSBmb3Igb3RoZXIgcXVlcmllc1xuICAgIHJldHVybiB7IHJvd3M6IFtdLCByb3dDb3VudDogMCB9O1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVJbnNlcnQocXVlcnk6IHN0cmluZywgdmFsdWVzOiBhbnlbXSk6IE1vY2tRdWVyeVJlc3VsdCB7XG4gICAgLy8gRXh0cmFjdCB0YWJsZSBuYW1lIGZyb20gSU5TRVJUIHF1ZXJ5XG4gICAgY29uc3QgdGFibGVNYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9pbnNlcnQgaW50b1xccysoXFx3KykvaSk7XG4gICAgaWYgKCF0YWJsZU1hdGNoKSB7XG4gICAgICByZXR1cm4geyByb3dzOiBbXSwgcm93Q291bnQ6IDAgfTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdGFibGVOYW1lID0gdGFibGVNYXRjaFsxXTtcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBJRCBpZiBub3QgcHJvdmlkZWRcbiAgICBjb25zdCBpZCA9IHRoaXMuZ2VuZXJhdGVJZCh0YWJsZU5hbWUpO1xuICAgIFxuICAgIC8vIENyZWF0ZSByb3cgZGF0YVxuICAgIGNvbnN0IHJvdzogYW55ID0geyBpZCB9O1xuICAgIFxuICAgIC8vIE1hcCB2YWx1ZXMgdG8gY29sdW1ucyAoc2ltcGxpZmllZCAtIGFzc3VtZXMgdmFsdWVzIGFyZSBpbiBvcmRlcilcbiAgICBjb25zdCBjb2x1bW5NYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9pbnNlcnQgaW50b1xccytcXHcrXFxzKlxcKChbXildKylcXCkvaSk7XG4gICAgaWYgKGNvbHVtbk1hdGNoKSB7XG4gICAgICBjb25zdCBjb2x1bW5zID0gY29sdW1uTWF0Y2hbMV0uc3BsaXQoJywnKS5tYXAoY29sID0+IGNvbC50cmltKCkpO1xuICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4sIGluZGV4KSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZXNbaW5kZXhdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByb3dbY29sdW1uXSA9IHZhbHVlc1tpbmRleF07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBTdG9yZSBpbiBtb2NrIGRhdGFcbiAgICB0aGlzLmRhdGFbdGFibGVOYW1lXVtpZF0gPSByb3c7XG4gICAgXG4gICAgLy8gUmV0dXJuIHRoZSBpbnNlcnRlZCByb3dcbiAgICByZXR1cm4geyByb3dzOiBbcm93XSwgcm93Q291bnQ6IDEgfTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlU2VsZWN0KHF1ZXJ5OiBzdHJpbmcsIHZhbHVlczogYW55W10pOiBNb2NrUXVlcnlSZXN1bHQge1xuICAgIC8vIEhhbmRsZSBDT1VOVCgqKSBxdWVyaWVzIChjYXNlLWluc2Vuc2l0aXZlKVxuICAgIGlmIChxdWVyeS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdjb3VudCgqKScpKSB7XG4gICAgICBjb25zdCB0YWJsZU1hdGNoID0gcXVlcnkubWF0Y2goL2Zyb21cXHMrKFxcdyspL2kpO1xuICAgICAgaWYgKCF0YWJsZU1hdGNoKSB7XG4gICAgICAgIHJldHVybiB7IHJvd3M6IFt7IGNvdW50OiAnMCcgfV0sIHJvd0NvdW50OiAxIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHRhYmxlTmFtZSA9IHRhYmxlTWF0Y2hbMV07XG4gICAgICBjb25zdCB0YWJsZURhdGEgPSB0aGlzLmRhdGFbdGFibGVOYW1lXSB8fCB7fTtcbiAgICAgIGxldCBjb3VudCA9IE9iamVjdC5rZXlzKHRhYmxlRGF0YSkubGVuZ3RoO1xuICAgICAgXG4gICAgICAvLyBIYW5kbGUgV0hFUkUgY2xhdXNlcyBmb3IgQ09VTlRcbiAgICAgIGlmIChxdWVyeS5pbmNsdWRlcygnd2hlcmUnKSkge1xuICAgICAgICBsZXQgcm93cyA9IE9iamVjdC52YWx1ZXModGFibGVEYXRhKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSBXSEVSRSBzdGF0dXMgPSAkMVxuICAgICAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ3doZXJlIHN0YXR1cyA9ICQxJykgJiYgdmFsdWVzWzBdKSB7XG4gICAgICAgICAgcm93cyA9IHJvd3MuZmlsdGVyKHJvdyA9PiByb3cuc3RhdHVzID09PSB2YWx1ZXNbMF0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBIYW5kbGUgV0hFUkUgZW1wbG95ZWVfaWQgPSAkMVxuICAgICAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ3doZXJlIGVtcGxveWVlX2lkID0gJDEnKSAmJiB2YWx1ZXNbMF0pIHtcbiAgICAgICAgICByb3dzID0gcm93cy5maWx0ZXIocm93ID0+IHJvdy5lbXBsb3llZV9pZCA9PT0gdmFsdWVzWzBdKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY291bnQgPSByb3dzLmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHsgcm93czogW3sgY291bnQ6IGNvdW50LnRvU3RyaW5nKCkgfV0sIHJvd0NvdW50OiAxIH07XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBTVU0gcXVlcmllcyAoY2FzZS1pbnNlbnNpdGl2ZSlcbiAgICBpZiAocXVlcnkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc3VtKCcpKSB7XG4gICAgICBjb25zdCB0YWJsZU1hdGNoID0gcXVlcnkubWF0Y2goL2Zyb21cXHMrKFxcdyspL2kpO1xuICAgICAgaWYgKCF0YWJsZU1hdGNoKSB7XG4gICAgICAgIHJldHVybiB7IHJvd3M6IFt7IHRvdGFsOiAnMCcgfV0sIHJvd0NvdW50OiAxIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHRhYmxlTmFtZSA9IHRhYmxlTWF0Y2hbMV07XG4gICAgICBjb25zdCB0YWJsZURhdGEgPSB0aGlzLmRhdGFbdGFibGVOYW1lXSB8fCB7fTtcbiAgICAgIGxldCByb3dzID0gT2JqZWN0LnZhbHVlcyh0YWJsZURhdGEpO1xuICAgICAgXG4gICAgICAvLyBIYW5kbGUgV0hFUkUgY2xhdXNlcyBmb3IgU1VNXG4gICAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ3doZXJlJykpIHtcbiAgICAgICAgLy8gSGFuZGxlIFdIRVJFIHN0YXR1cyA9ICQxXG4gICAgICAgIGlmIChxdWVyeS5pbmNsdWRlcygnd2hlcmUgc3RhdHVzID0gJDEnKSAmJiB2YWx1ZXNbMF0pIHtcbiAgICAgICAgICByb3dzID0gcm93cy5maWx0ZXIocm93ID0+IHJvdy5zdGF0dXMgPT09IHZhbHVlc1swXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXRlIHN1bSAoZm9yIHNpbXBsaWNpdHksIGFzc3VtZSB3ZSdyZSBzdW1taW5nIGEgbnVtZXJpYyBmaWVsZClcbiAgICAgIGNvbnN0IHN1bSA9IHJvd3MucmVkdWNlKCh0b3RhbCwgcm93KSA9PiB7XG4gICAgICAgIC8vIFRyeSB0byBmaW5kIGEgbnVtZXJpYyBmaWVsZCB0byBzdW0gKG5ldF9wYXksIGdyb3NzX3BheSwgZXRjLilcbiAgICAgICAgY29uc3QgbnVtZXJpY0ZpZWxkcyA9IFsnbmV0X3BheScsICdncm9zc19wYXknLCAndG90YWxfZGVkdWN0aW9ucycsICd0b3RhbF9iZW5lZml0cyddO1xuICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIG51bWVyaWNGaWVsZHMpIHtcbiAgICAgICAgICBpZiAocm93W2ZpZWxkXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdG90YWwgKyAocGFyc2VGbG9hdChyb3dbZmllbGRdKSB8fCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRvdGFsO1xuICAgICAgfSwgMCk7XG4gICAgICBcbiAgICAgIHJldHVybiB7IHJvd3M6IFt7IHRvdGFsOiBzdW0udG9TdHJpbmcoKSB9XSwgcm93Q291bnQ6IDEgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gRXh0cmFjdCB0YWJsZSBuYW1lIGZyb20gU0VMRUNUIHF1ZXJ5XG4gICAgY29uc3QgdGFibGVNYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9mcm9tXFxzKyhcXHcrKS9pKTtcbiAgICBpZiAoIXRhYmxlTWF0Y2gpIHtcbiAgICAgIHJldHVybiB7IHJvd3M6IFtdLCByb3dDb3VudDogMCB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB0YWJsZU5hbWUgPSB0YWJsZU1hdGNoWzFdO1xuICAgIGNvbnN0IHRhYmxlRGF0YSA9IHRoaXMuZGF0YVt0YWJsZU5hbWVdIHx8IHt9O1xuICAgIFxuICAgIC8vIFNpbXBsZSBXSEVSRSBjbGF1c2UgaGFuZGxpbmdcbiAgICBsZXQgcm93cyA9IE9iamVjdC52YWx1ZXModGFibGVEYXRhKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgV0hFUkUgaWQgPSAkMVxuICAgIGlmIChxdWVyeS5pbmNsdWRlcygnd2hlcmUgaWQgPSAkMScpICYmIHZhbHVlc1swXSkge1xuICAgICAgcm93cyA9IHJvd3MuZmlsdGVyKHJvdyA9PiByb3cuaWQgPT09IHZhbHVlc1swXSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBXSEVSRSBlbWFpbCA9ICQxXG4gICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCd3aGVyZSBlbWFpbCA9ICQxJykgJiYgdmFsdWVzWzBdKSB7XG4gICAgICByb3dzID0gcm93cy5maWx0ZXIocm93ID0+IHJvdy5lbWFpbCA9PT0gdmFsdWVzWzBdKTtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIFdIRVJFIHN0YXR1cyA9ICQxXG4gICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCd3aGVyZSBzdGF0dXMgPSAkMScpICYmIHZhbHVlc1swXSkge1xuICAgICAgcm93cyA9IHJvd3MuZmlsdGVyKHJvdyA9PiByb3cuc3RhdHVzID09PSB2YWx1ZXNbMF0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgV0hFUkUgZW1wbG95ZWVfaWQgPSAkMVxuICAgIGlmIChxdWVyeS5pbmNsdWRlcygnd2hlcmUgZW1wbG95ZWVfaWQgPSAkMScpICYmIHZhbHVlc1swXSkge1xuICAgICAgcm93cyA9IHJvd3MuZmlsdGVyKHJvdyA9PiByb3cuZW1wbG95ZWVfaWQgPT09IHZhbHVlc1swXSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBXSEVSRSBhdHRlbmRhbmNlX3JlY29yZF9pZCA9ICQxXG4gICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCd3aGVyZSBhdHRlbmRhbmNlX3JlY29yZF9pZCA9ICQxJykgJiYgdmFsdWVzWzBdKSB7XG4gICAgICByb3dzID0gcm93cy5maWx0ZXIocm93ID0+IHJvdy5hdHRlbmRhbmNlX3JlY29yZF9pZCA9PT0gdmFsdWVzWzBdKTtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIFdIRVJFIGRhdGUgPSAkMVxuICAgIGlmIChxdWVyeS5pbmNsdWRlcygnd2hlcmUgZGF0ZSA9ICQxJykgJiYgdmFsdWVzWzBdKSB7XG4gICAgICByb3dzID0gcm93cy5maWx0ZXIocm93ID0+IHJvdy5kYXRlID09PSB2YWx1ZXNbMF0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgT1JERVIgQllcbiAgICBpZiAocXVlcnkuaW5jbHVkZXMoJ29yZGVyIGJ5JykpIHtcbiAgICAgIGlmIChxdWVyeS5pbmNsdWRlcygnb3JkZXIgYnkgZmlyc3RfbmFtZSwgbGFzdF9uYW1lJykpIHtcbiAgICAgICAgcm93cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgY29uc3QgbmFtZUEgPSBgJHthLmZpcnN0X25hbWUgfHwgJyd9ICR7YS5sYXN0X25hbWUgfHwgJyd9YC50cmltKCk7XG4gICAgICAgICAgY29uc3QgbmFtZUIgPSBgJHtiLmZpcnN0X25hbWUgfHwgJyd9ICR7Yi5sYXN0X25hbWUgfHwgJyd9YC50cmltKCk7XG4gICAgICAgICAgcmV0dXJuIG5hbWVBLmxvY2FsZUNvbXBhcmUobmFtZUIpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIExJTUlUXG4gICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCdsaW1pdCcpKSB7XG4gICAgICBjb25zdCBsaW1pdE1hdGNoID0gcXVlcnkubWF0Y2goL2xpbWl0XFxzKyhcXGQrKS9pKTtcbiAgICAgIGlmIChsaW1pdE1hdGNoKSB7XG4gICAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQobGltaXRNYXRjaFsxXSk7XG4gICAgICAgIHJvd3MgPSByb3dzLnNsaWNlKDAsIGxpbWl0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgcm93cywgcm93Q291bnQ6IHJvd3MubGVuZ3RoIH07XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVVwZGF0ZShxdWVyeTogc3RyaW5nLCB2YWx1ZXM6IGFueVtdKTogTW9ja1F1ZXJ5UmVzdWx0IHtcbiAgICAvLyBFeHRyYWN0IHRhYmxlIG5hbWUgZnJvbSBVUERBVEUgcXVlcnlcbiAgICBjb25zdCB0YWJsZU1hdGNoID0gcXVlcnkubWF0Y2goL3VwZGF0ZVxccysoXFx3KykvaSk7XG4gICAgaWYgKCF0YWJsZU1hdGNoKSB7XG4gICAgICByZXR1cm4geyByb3dzOiBbXSwgcm93Q291bnQ6IDAgfTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdGFibGVOYW1lID0gdGFibGVNYXRjaFsxXTtcbiAgICBjb25zdCB0YWJsZURhdGEgPSB0aGlzLmRhdGFbdGFibGVOYW1lXSB8fCB7fTtcbiAgICBcbiAgICAvLyBIYW5kbGUgV0hFUkUgaWQgPSAkMVxuICAgIGlmIChxdWVyeS5pbmNsdWRlcygnd2hlcmUgaWQgPSAkMScpICYmIHZhbHVlc1swXSkge1xuICAgICAgY29uc3QgaWQgPSB2YWx1ZXNbMF07XG4gICAgICBpZiAodGFibGVEYXRhW2lkXSkge1xuICAgICAgICAvLyBVcGRhdGUgdGhlIHJvdyAoc2ltcGxpZmllZCAtIGFzc3VtZXMgU0VUIGNsYXVzZSBpcyBhdCB0aGUgZW5kKVxuICAgICAgICBjb25zdCBzZXRNYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9zZXRcXHMrKC4rPylcXHMrd2hlcmUvaSk7XG4gICAgICAgIGlmIChzZXRNYXRjaCkge1xuICAgICAgICAgIGNvbnN0IHNldENsYXVzZSA9IHNldE1hdGNoWzFdO1xuICAgICAgICAgIGNvbnN0IHVwZGF0ZXMgPSBzZXRDbGF1c2Uuc3BsaXQoJywnKS5tYXAodXBkYXRlID0+IHVwZGF0ZS50cmltKCkpO1xuICAgICAgICAgIHVwZGF0ZXMuZm9yRWFjaCh1cGRhdGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2NvbHVtbiwgdmFsdWVdID0gdXBkYXRlLnNwbGl0KCc9JykubWFwKHBhcnQgPT4gcGFydC50cmltKCkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJyQnKSkge1xuICAgICAgICAgICAgICBjb25zdCBwYXJhbUluZGV4ID0gcGFyc2VJbnQodmFsdWUuc3Vic3RyaW5nKDEpKSAtIDE7XG4gICAgICAgICAgICAgIGlmICh2YWx1ZXNbcGFyYW1JbmRleF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRhYmxlRGF0YVtpZF1bY29sdW1uXSA9IHZhbHVlc1twYXJhbUluZGV4XTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IHJvd3M6IFt0YWJsZURhdGFbaWRdXSwgcm93Q291bnQ6IDEgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgcm93czogW10sIHJvd0NvdW50OiAwIH07XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZURlbGV0ZShxdWVyeTogc3RyaW5nLCB2YWx1ZXM6IGFueVtdKTogTW9ja1F1ZXJ5UmVzdWx0IHtcbiAgICAvLyBFeHRyYWN0IHRhYmxlIG5hbWUgZnJvbSBERUxFVEUgcXVlcnlcbiAgICBjb25zdCB0YWJsZU1hdGNoID0gcXVlcnkubWF0Y2goL2RlbGV0ZSBmcm9tXFxzKyhcXHcrKS9pKTtcbiAgICBpZiAoIXRhYmxlTWF0Y2gpIHtcbiAgICAgIHJldHVybiB7IHJvd3M6IFtdLCByb3dDb3VudDogMCB9O1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB0YWJsZU5hbWUgPSB0YWJsZU1hdGNoWzFdO1xuICAgIGNvbnN0IHRhYmxlRGF0YSA9IHRoaXMuZGF0YVt0YWJsZU5hbWVdIHx8IHt9O1xuICAgIFxuICAgIC8vIEhhbmRsZSBXSEVSRSBpZCA9ICQxXG4gICAgaWYgKHF1ZXJ5LmluY2x1ZGVzKCd3aGVyZSBpZCA9ICQxJykgJiYgdmFsdWVzWzBdKSB7XG4gICAgICBjb25zdCBpZCA9IHZhbHVlc1swXTtcbiAgICAgIGlmICh0YWJsZURhdGFbaWRdKSB7XG4gICAgICAgIGRlbGV0ZSB0YWJsZURhdGFbaWRdO1xuICAgICAgICByZXR1cm4geyByb3dzOiBbXSwgcm93Q291bnQ6IDEgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIERFTEVURSBGUk9NIHRhYmxlIChubyBXSEVSRSBjbGF1c2UpXG4gICAgaWYgKCFxdWVyeS5pbmNsdWRlcygnd2hlcmUnKSkge1xuICAgICAgY29uc3Qgcm93Q291bnQgPSBPYmplY3Qua2V5cyh0YWJsZURhdGEpLmxlbmd0aDtcbiAgICAgIHRoaXMuZGF0YVt0YWJsZU5hbWVdID0ge307XG4gICAgICByZXR1cm4geyByb3dzOiBbXSwgcm93Q291bnQgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgcm93czogW10sIHJvd0NvdW50OiAwIH07XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUFsdGVyU2VxdWVuY2UocXVlcnk6IHN0cmluZywgX3ZhbHVlczogYW55W10pOiBNb2NrUXVlcnlSZXN1bHQge1xuICAgIC8vIEV4dHJhY3Qgc2VxdWVuY2UgbmFtZSBmcm9tIEFMVEVSIFNFUVVFTkNFIHF1ZXJ5XG4gICAgY29uc3Qgc2VxdWVuY2VNYXRjaCA9IHF1ZXJ5Lm1hdGNoKC9hbHRlciBzZXF1ZW5jZVxccysoXFx3KykvaSk7XG4gICAgaWYgKHNlcXVlbmNlTWF0Y2gpIHtcbiAgICAgIGNvbnN0IHNlcXVlbmNlTmFtZSA9IHNlcXVlbmNlTWF0Y2hbMV07XG4gICAgICB0aGlzLnNlcXVlbmNlQ291bnRlcnNbc2VxdWVuY2VOYW1lXSA9IDE7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB7IHJvd3M6IFtdLCByb3dDb3VudDogMCB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUlkKF90YWJsZU5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gR2VuZXJhdGUgYSBVVUlELWxpa2UgSURcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJhbmRvbSA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAxNSk7XG4gICAgcmV0dXJuIGAke3RpbWVzdGFtcH0tJHtyYW5kb219YDtcbiAgfVxuXG4gIC8vIFRlc3QgdXRpbGl0aWVzXG4gIGdldERhdGEoKTogTW9ja0RhdGFiYXNlRGF0YSB7XG4gICAgcmV0dXJuIHsgLi4udGhpcy5kYXRhIH07XG4gIH1cblxuICBjbGVhckRhdGEoKTogdm9pZCB7XG4gICAgdGhpcy5pbml0aWFsaXplU2VxdWVuY2VzKCk7XG4gIH1cblxuICBzZXREYXRhKHRhYmxlTmFtZTogc3RyaW5nLCBkYXRhOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmRhdGFbdGFibGVOYW1lXSA9IHsgLi4uZGF0YSB9O1xuICB9XG5cbiAgZ2V0VGFibGVEYXRhKHRhYmxlTmFtZTogc3RyaW5nKTogYW55IHtcbiAgICByZXR1cm4geyAuLi50aGlzLmRhdGFbdGFibGVOYW1lXSB9O1xuICB9XG59XG5cbi8vIFNpbmdsZXRvbiBpbnN0YW5jZSBmb3IgdGVzdHNcbmV4cG9ydCBjb25zdCBtb2NrRGF0YWJhc2VTZXJ2aWNlID0gbmV3IE1vY2tEYXRhYmFzZVNlcnZpY2UoKTtcblxuLy8gRXhwb3J0IGZvciB1c2UgaW4gdGVzdHNcbmV4cG9ydCBkZWZhdWx0IG1vY2tEYXRhYmFzZVNlcnZpY2U7XG4iXSwidmVyc2lvbiI6M30=