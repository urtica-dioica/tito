7a86221ac9416e619c0937116ea56ebe
"use strict";

/* istanbul ignore next */
function cov_2sefjesn() {
  var path = "/home/kim/tito/server/src/services/kiosk/kioskService.ts";
  var hash = "3197a2ab476e56c24a000d8e1eb167ccc2e3e63e";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/kim/tito/server/src/services/kiosk/kioskService.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 2,
          column: 62
        }
      },
      "1": {
        start: {
          line: 3,
          column: 19
        },
        end: {
          line: 3,
          column: 51
        }
      },
      "2": {
        start: {
          line: 4,
          column: 28
        },
        end: {
          line: 4,
          column: 70
        }
      },
      "3": {
        start: {
          line: 10,
          column: 8
        },
        end: {
          line: 55,
          column: 9
        }
      },
      "4": {
        start: {
          line: 13,
          column: 12
        },
        end: {
          line: 18,
          column: 13
        }
      },
      "5": {
        start: {
          line: 14,
          column: 16
        },
        end: {
          line: 14,
          column: 48
        }
      },
      "6": {
        start: {
          line: 17,
          column: 16
        },
        end: {
          line: 17,
          column: 58
        }
      },
      "7": {
        start: {
          line: 20,
          column: 31
        },
        end: {
          line: 20,
          column: 48
        }
      },
      "8": {
        start: {
          line: 21,
          column: 12
        },
        end: {
          line: 23,
          column: 13
        }
      },
      "9": {
        start: {
          line: 22,
          column: 16
        },
        end: {
          line: 22,
          column: 68
        }
      },
      "10": {
        start: {
          line: 25,
          column: 26
        },
        end: {
          line: 45,
          column: 7
        }
      },
      "11": {
        start: {
          line: 46,
          column: 27
        },
        end: {
          line: 46,
          column: 85
        }
      },
      "12": {
        start: {
          line: 47,
          column: 12
        },
        end: {
          line: 49,
          column: 13
        }
      },
      "13": {
        start: {
          line: 48,
          column: 16
        },
        end: {
          line: 48,
          column: 66
        }
      },
      "14": {
        start: {
          line: 50,
          column: 12
        },
        end: {
          line: 50,
          column: 34
        }
      },
      "15": {
        start: {
          line: 53,
          column: 12
        },
        end: {
          line: 53,
          column: 68
        }
      },
      "16": {
        start: {
          line: 54,
          column: 12
        },
        end: {
          line: 54,
          column: 24
        }
      },
      "17": {
        start: {
          line: 61,
          column: 8
        },
        end: {
          line: 169,
          column: 9
        }
      },
      "18": {
        start: {
          line: 62,
          column: 74
        },
        end: {
          line: 62,
          column: 78
        }
      },
      "19": {
        start: {
          line: 63,
          column: 12
        },
        end: {
          line: 63,
          column: 125
        }
      },
      "20": {
        start: {
          line: 65,
          column: 26
        },
        end: {
          line: 65,
          column: 64
        }
      },
      "21": {
        start: {
          line: 66,
          column: 42
        },
        end: {
          line: 71,
          column: 7
        }
      },
      "22": {
        start: {
          line: 72,
          column: 43
        },
        end: {
          line: 72,
          column: 124
        }
      },
      "23": {
        start: {
          line: 75,
          column: 12
        },
        end: {
          line: 86,
          column: 13
        }
      },
      "24": {
        start: {
          line: 76,
          column: 16
        },
        end: {
          line: 76,
          column: 71
        }
      },
      "25": {
        start: {
          line: 80,
          column: 44
        },
        end: {
          line: 83,
          column: 9
        }
      },
      "26": {
        start: {
          line: 84,
          column: 39
        },
        end: {
          line: 84,
          column: 118
        }
      },
      "27": {
        start: {
          line: 85,
          column: 16
        },
        end: {
          line: 85,
          column: 63
        }
      },
      "28": {
        start: {
          line: 87,
          column: 24
        },
        end: {
          line: 87,
          column: 34
        }
      },
      "29": {
        start: {
          line: 89,
          column: 41
        },
        end: {
          line: 98,
          column: 7
        }
      },
      "30": {
        start: {
          line: 99,
          column: 36
        },
        end: {
          line: 99,
          column: 116
        }
      },
      "31": {
        start: {
          line: 101,
          column: 12
        },
        end: {
          line: 162,
          column: 13
        }
      },
      "32": {
        start: {
          line: 103,
          column: 32
        },
        end: {
          line: 103,
          column: 55
        }
      },
      "33": {
        start: {
          line: 104,
          column: 16
        },
        end: {
          line: 157,
          column: 17
        }
      },
      "34": {
        start: {
          line: 106,
          column: 40
        },
        end: {
          line: 119,
          column: 11
        }
      },
      "35": {
        start: {
          line: 120,
          column: 20
        },
        end: {
          line: 127,
          column: 23
        }
      },
      "36": {
        start: {
          line: 129,
          column: 21
        },
        end: {
          line: 157,
          column: 17
        }
      },
      "37": {
        start: {
          line: 131,
          column: 40
        },
        end: {
          line: 144,
          column: 11
        }
      },
      "38": {
        start: {
          line: 145,
          column: 20
        },
        end: {
          line: 152,
          column: 23
        }
      },
      "39": {
        start: {
          line: 156,
          column: 20
        },
        end: {
          line: 156,
          column: 133
        }
      },
      "40": {
        start: {
          line: 161,
          column: 16
        },
        end: {
          line: 161,
          column: 129
        }
      },
      "41": {
        start: {
          line: 163,
          column: 12
        },
        end: {
          line: 163,
          column: 81
        }
      },
      "42": {
        start: {
          line: 164,
          column: 12
        },
        end: {
          line: 164,
          column: 34
        }
      },
      "43": {
        start: {
          line: 167,
          column: 12
        },
        end: {
          line: 167,
          column: 64
        }
      },
      "44": {
        start: {
          line: 168,
          column: 12
        },
        end: {
          line: 168,
          column: 24
        }
      },
      "45": {
        start: {
          line: 175,
          column: 24
        },
        end: {
          line: 175,
          column: 76
        }
      },
      "46": {
        start: {
          line: 176,
          column: 25
        },
        end: {
          line: 176,
          column: 78
        }
      },
      "47": {
        start: {
          line: 177,
          column: 28
        },
        end: {
          line: 197,
          column: 5
        }
      },
      "48": {
        start: {
          line: 198,
          column: 8
        },
        end: {
          line: 207,
          column: 11
        }
      },
      "49": {
        start: {
          line: 213,
          column: 8
        },
        end: {
          line: 236,
          column: 9
        }
      },
      "50": {
        start: {
          line: 214,
          column: 26
        },
        end: {
          line: 229,
          column: 7
        }
      },
      "51": {
        start: {
          line: 230,
          column: 27
        },
        end: {
          line: 230,
          column: 85
        }
      },
      "52": {
        start: {
          line: 231,
          column: 12
        },
        end: {
          line: 231,
          column: 66
        }
      },
      "53": {
        start: {
          line: 234,
          column: 12
        },
        end: {
          line: 234,
          column: 67
        }
      },
      "54": {
        start: {
          line: 235,
          column: 12
        },
        end: {
          line: 235,
          column: 24
        }
      },
      "55": {
        start: {
          line: 242,
          column: 8
        },
        end: {
          line: 265,
          column: 9
        }
      },
      "56": {
        start: {
          line: 243,
          column: 26
        },
        end: {
          line: 258,
          column: 7
        }
      },
      "57": {
        start: {
          line: 259,
          column: 27
        },
        end: {
          line: 259,
          column: 92
        }
      },
      "58": {
        start: {
          line: 260,
          column: 12
        },
        end: {
          line: 260,
          column: 31
        }
      },
      "59": {
        start: {
          line: 263,
          column: 12
        },
        end: {
          line: 263,
          column: 70
        }
      },
      "60": {
        start: {
          line: 264,
          column: 12
        },
        end: {
          line: 264,
          column: 24
        }
      },
      "61": {
        start: {
          line: 271,
          column: 8
        },
        end: {
          line: 319,
          column: 9
        }
      },
      "62": {
        start: {
          line: 272,
          column: 81
        },
        end: {
          line: 272,
          column: 85
        }
      },
      "63": {
        start: {
          line: 273,
          column: 12
        },
        end: {
          line: 273,
          column: 141
        }
      },
      "64": {
        start: {
          line: 275,
          column: 35
        },
        end: {
          line: 281,
          column: 13
        }
      },
      "65": {
        start: {
          line: 282,
          column: 12
        },
        end: {
          line: 282,
          column: 98
        }
      },
      "66": {
        start: {
          line: 284,
          column: 26
        },
        end: {
          line: 284,
          column: 36
        }
      },
      "67": {
        start: {
          line: 285,
          column: 12
        },
        end: {
          line: 285,
          column: 39
        }
      },
      "68": {
        start: {
          line: 286,
          column: 26
        },
        end: {
          line: 308,
          column: 7
        }
      },
      "69": {
        start: {
          line: 309,
          column: 27
        },
        end: {
          line: 309,
          column: 127
        }
      },
      "70": {
        start: {
          line: 310,
          column: 12
        },
        end: {
          line: 312,
          column: 13
        }
      },
      "71": {
        start: {
          line: 311,
          column: 16
        },
        end: {
          line: 311,
          column: 82
        }
      },
      "72": {
        start: {
          line: 313,
          column: 12
        },
        end: {
          line: 313,
          column: 90
        }
      },
      "73": {
        start: {
          line: 314,
          column: 12
        },
        end: {
          line: 314,
          column: 34
        }
      },
      "74": {
        start: {
          line: 317,
          column: 12
        },
        end: {
          line: 317,
          column: 75
        }
      },
      "75": {
        start: {
          line: 318,
          column: 12
        },
        end: {
          line: 318,
          column: 24
        }
      },
      "76": {
        start: {
          line: 325,
          column: 8
        },
        end: {
          line: 331,
          column: 9
        }
      },
      "77": {
        start: {
          line: 326,
          column: 12
        },
        end: {
          line: 326,
          column: 98
        }
      },
      "78": {
        start: {
          line: 329,
          column: 12
        },
        end: {
          line: 329,
          column: 73
        }
      },
      "79": {
        start: {
          line: 330,
          column: 12
        },
        end: {
          line: 330,
          column: 24
        }
      },
      "80": {
        start: {
          line: 337,
          column: 8
        },
        end: {
          line: 343,
          column: 9
        }
      },
      "81": {
        start: {
          line: 338,
          column: 12
        },
        end: {
          line: 338,
          column: 113
        }
      },
      "82": {
        start: {
          line: 341,
          column: 12
        },
        end: {
          line: 341,
          column: 72
        }
      },
      "83": {
        start: {
          line: 342,
          column: 12
        },
        end: {
          line: 342,
          column: 24
        }
      },
      "84": {
        start: {
          line: 349,
          column: 8
        },
        end: {
          line: 371,
          column: 9
        }
      },
      "85": {
        start: {
          line: 350,
          column: 26
        },
        end: {
          line: 350,
          column: 36
        }
      },
      "86": {
        start: {
          line: 351,
          column: 12
        },
        end: {
          line: 351,
          column: 39
        }
      },
      "87": {
        start: {
          line: 353,
          column: 29
        },
        end: {
          line: 353,
          column: 76
        }
      },
      "88": {
        start: {
          line: 354,
          column: 34
        },
        end: {
          line: 358,
          column: 14
        }
      },
      "89": {
        start: {
          line: 355,
          column: 36
        },
        end: {
          line: 355,
          column: 63
        }
      },
      "90": {
        start: {
          line: 356,
          column: 16
        },
        end: {
          line: 356,
          column: 49
        }
      },
      "91": {
        start: {
          line: 357,
          column: 16
        },
        end: {
          line: 357,
          column: 65
        }
      },
      "92": {
        start: {
          line: 360,
          column: 32
        },
        end: {
          line: 360,
          column: 77
        }
      },
      "93": {
        start: {
          line: 361,
          column: 12
        },
        end: {
          line: 366,
          column: 14
        }
      },
      "94": {
        start: {
          line: 369,
          column: 12
        },
        end: {
          line: 369,
          column: 76
        }
      },
      "95": {
        start: {
          line: 370,
          column: 12
        },
        end: {
          line: 370,
          column: 24
        }
      },
      "96": {
        start: {
          line: 374,
          column: 0
        },
        end: {
          line: 374,
          column: 37
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 9,
            column: 4
          },
          end: {
            line: 9,
            column: 5
          }
        },
        loc: {
          start: {
            line: 9,
            column: 41
          },
          end: {
            line: 56,
            column: 5
          }
        },
        line: 9
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 60,
            column: 4
          },
          end: {
            line: 60,
            column: 5
          }
        },
        loc: {
          start: {
            line: 60,
            column: 33
          },
          end: {
            line: 170,
            column: 5
          }
        },
        line: 60
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 174,
            column: 4
          },
          end: {
            line: 174,
            column: 5
          }
        },
        loc: {
          start: {
            line: 174,
            column: 109
          },
          end: {
            line: 208,
            column: 5
          }
        },
        line: 174
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 212,
            column: 4
          },
          end: {
            line: 212,
            column: 5
          }
        },
        loc: {
          start: {
            line: 212,
            column: 40
          },
          end: {
            line: 237,
            column: 5
          }
        },
        line: 212
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 241,
            column: 4
          },
          end: {
            line: 241,
            column: 5
          }
        },
        loc: {
          start: {
            line: 241,
            column: 55
          },
          end: {
            line: 266,
            column: 5
          }
        },
        line: 241
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 270,
            column: 4
          },
          end: {
            line: 270,
            column: 5
          }
        },
        loc: {
          start: {
            line: 270,
            column: 42
          },
          end: {
            line: 320,
            column: 5
          }
        },
        line: 270
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 324,
            column: 4
          },
          end: {
            line: 324,
            column: 5
          }
        },
        loc: {
          start: {
            line: 324,
            column: 45
          },
          end: {
            line: 332,
            column: 5
          }
        },
        line: 324
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 336,
            column: 4
          },
          end: {
            line: 336,
            column: 5
          }
        },
        loc: {
          start: {
            line: 336,
            column: 60
          },
          end: {
            line: 344,
            column: 5
          }
        },
        line: 336
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 348,
            column: 4
          },
          end: {
            line: 348,
            column: 5
          }
        },
        loc: {
          start: {
            line: 348,
            column: 48
          },
          end: {
            line: 372,
            column: 5
          }
        },
        line: 348
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 354,
            column: 50
          },
          end: {
            line: 354,
            column: 51
          }
        },
        loc: {
          start: {
            line: 354,
            column: 61
          },
          end: {
            line: 358,
            column: 13
          }
        },
        line: 354
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 21,
            column: 12
          },
          end: {
            line: 23,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 21,
            column: 12
          },
          end: {
            line: 23,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 21
      },
      "1": {
        loc: {
          start: {
            line: 47,
            column: 12
          },
          end: {
            line: 49,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 47,
            column: 12
          },
          end: {
            line: 49,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 47
      },
      "2": {
        loc: {
          start: {
            line: 75,
            column: 12
          },
          end: {
            line: 86,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 75,
            column: 12
          },
          end: {
            line: 86,
            column: 13
          }
        }, {
          start: {
            line: 78,
            column: 17
          },
          end: {
            line: 86,
            column: 13
          }
        }],
        line: 75
      },
      "3": {
        loc: {
          start: {
            line: 101,
            column: 12
          },
          end: {
            line: 162,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 101,
            column: 12
          },
          end: {
            line: 162,
            column: 13
          }
        }, {
          start: {
            line: 159,
            column: 17
          },
          end: {
            line: 162,
            column: 13
          }
        }],
        line: 101
      },
      "4": {
        loc: {
          start: {
            line: 104,
            column: 16
          },
          end: {
            line: 157,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 104,
            column: 16
          },
          end: {
            line: 157,
            column: 17
          }
        }, {
          start: {
            line: 129,
            column: 21
          },
          end: {
            line: 157,
            column: 17
          }
        }],
        line: 104
      },
      "5": {
        loc: {
          start: {
            line: 104,
            column: 20
          },
          end: {
            line: 104,
            column: 82
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 104,
            column: 20
          },
          end: {
            line: 104,
            column: 40
          }
        }, {
          start: {
            line: 104,
            column: 44
          },
          end: {
            line: 104,
            column: 60
          }
        }, {
          start: {
            line: 104,
            column: 64
          },
          end: {
            line: 104,
            column: 82
          }
        }],
        line: 104
      },
      "6": {
        loc: {
          start: {
            line: 125,
            column: 24
          },
          end: {
            line: 125,
            column: 41
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 125,
            column: 24
          },
          end: {
            line: 125,
            column: 33
          }
        }, {
          start: {
            line: 125,
            column: 37
          },
          end: {
            line: 125,
            column: 41
          }
        }],
        line: 125
      },
      "7": {
        loc: {
          start: {
            line: 129,
            column: 21
          },
          end: {
            line: 157,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 129,
            column: 21
          },
          end: {
            line: 157,
            column: 17
          }
        }, {
          start: {
            line: 154,
            column: 21
          },
          end: {
            line: 157,
            column: 17
          }
        }],
        line: 129
      },
      "8": {
        loc: {
          start: {
            line: 129,
            column: 25
          },
          end: {
            line: 129,
            column: 65
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 129,
            column: 25
          },
          end: {
            line: 129,
            column: 44
          }
        }, {
          start: {
            line: 129,
            column: 48
          },
          end: {
            line: 129,
            column: 65
          }
        }],
        line: 129
      },
      "9": {
        loc: {
          start: {
            line: 150,
            column: 24
          },
          end: {
            line: 150,
            column: 41
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 150,
            column: 24
          },
          end: {
            line: 150,
            column: 33
          }
        }, {
          start: {
            line: 150,
            column: 37
          },
          end: {
            line: 150,
            column: 41
          }
        }],
        line: 150
      },
      "10": {
        loc: {
          start: {
            line: 175,
            column: 24
          },
          end: {
            line: 175,
            column: 76
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 175,
            column: 46
          },
          end: {
            line: 175,
            column: 69
          }
        }, {
          start: {
            line: 175,
            column: 72
          },
          end: {
            line: 175,
            column: 76
          }
        }],
        line: 175
      },
      "11": {
        loc: {
          start: {
            line: 176,
            column: 25
          },
          end: {
            line: 176,
            column: 78
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 176,
            column: 48
          },
          end: {
            line: 176,
            column: 71
          }
        }, {
          start: {
            line: 176,
            column: 74
          },
          end: {
            line: 176,
            column: 78
          }
        }],
        line: 176
      },
      "12": {
        loc: {
          start: {
            line: 203,
            column: 12
          },
          end: {
            line: 203,
            column: 29
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 203,
            column: 12
          },
          end: {
            line: 203,
            column: 21
          }
        }, {
          start: {
            line: 203,
            column: 25
          },
          end: {
            line: 203,
            column: 29
          }
        }],
        line: 203
      },
      "13": {
        loc: {
          start: {
            line: 231,
            column: 19
          },
          end: {
            line: 231,
            column: 65
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 231,
            column: 44
          },
          end: {
            line: 231,
            column: 58
          }
        }, {
          start: {
            line: 231,
            column: 61
          },
          end: {
            line: 231,
            column: 65
          }
        }],
        line: 231
      },
      "14": {
        loc: {
          start: {
            line: 241,
            column: 43
          },
          end: {
            line: 241,
            column: 53
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 241,
            column: 51
          },
          end: {
            line: 241,
            column: 53
          }
        }],
        line: 241
      },
      "15": {
        loc: {
          start: {
            line: 310,
            column: 12
          },
          end: {
            line: 312,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 310,
            column: 12
          },
          end: {
            line: 312,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 310
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0,
      "63": 0,
      "64": 0,
      "65": 0,
      "66": 0,
      "67": 0,
      "68": 0,
      "69": 0,
      "70": 0,
      "71": 0,
      "72": 0,
      "73": 0,
      "74": 0,
      "75": 0,
      "76": 0,
      "77": 0,
      "78": 0,
      "79": 0,
      "80": 0,
      "81": 0,
      "82": 0,
      "83": 0,
      "84": 0,
      "85": 0,
      "86": 0,
      "87": 0,
      "88": 0,
      "89": 0,
      "90": 0,
      "91": 0,
      "92": 0,
      "93": 0,
      "94": 0,
      "95": 0,
      "96": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0],
      "15": [0, 0]
    },
    inputSourceMap: {
      file: "/home/kim/tito/server/src/services/kiosk/kioskService.ts",
      mappings: ";;AAAA,oDAAgD;AAChD,uEAA6F;AAgD7F,MAAM,YAAY;IAChB;;OAEG;IACH,KAAK,CAAC,kBAAkB,CAAC,UAAkB;QACzC,IAAI,CAAC;YACH,0CAA0C;YAC1C,IAAI,MAAM,CAAC;YACX,IAAI,CAAC;gBACH,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;YAClC,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,MAAM,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;YAC5C,CAAC;YAED,mCAAmC;YACnC,MAAM,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC;YACrC,IAAI,CAAC,UAAU,EAAE,CAAC;gBAChB,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;YACtD,CAAC;YAED,gCAAgC;YAChC,MAAM,KAAK,GAAG;;;;;;;;;;;;;;;;;;;;OAoBb,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC;YAE1D,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBAC7B,MAAM,IAAI,KAAK,CAAC,gCAAgC,CAAC,CAAC;YACpD,CAAC;YAED,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACxB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,KAAK,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,gBAAgB,CAAC,IAA0B;QAC/C,IAAI,CAAC;YACH,MAAM,EAAE,UAAU,EAAE,IAAI,EAAE,QAAQ,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC;YACnE,OAAO,CAAC,GAAG,CAAC,4CAA4C,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,QAAQ,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC,CAAC;YAEjH,mDAAmD;YACnD,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,oBAAoB;YAE1E,MAAM,qBAAqB,GAAG;;;;;OAK7B,CAAC;YAEF,MAAM,sBAAsB,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,qBAAqB,EAAE,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC;YAEjG,kEAAkE;YAClE,IAAI,kBAAkB,CAAC;YACvB,IAAI,sBAAsB,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAC3C,kBAAkB,GAAG,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACzD,CAAC;iBAAM,CAAC;gBACN,sBAAsB;gBACtB,MAAM,mBAAmB,GAAG;;;SAG3B,CAAC;gBACF,MAAM,cAAc,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,mBAAmB,EAAE,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC;gBACvF,kBAAkB,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACjD,CAAC;YAED,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;YAEvB,4DAA4D;YAC5D,MAAM,oBAAoB,GAAG;;;;;;;;;OAS5B,CAAC;YAEF,MAAM,eAAe,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,oBAAoB,EAAE,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC;YAEzF,IAAI,MAAM,CAAC;YAEX,IAAI,eAAe,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBACpC,0BAA0B;gBAC1B,MAAM,OAAO,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAExC,IAAI,IAAI,KAAK,WAAW,IAAI,OAAO,CAAC,QAAQ,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC;oBACnE,sCAAsC;oBACtC,MAAM,WAAW,GAAG;;;;;;;;;;;;;WAanB,CAAC;oBAEF,MAAM,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,WAAW,EAAE;wBAC1C,GAAG,CAAC,WAAW,EAAE;wBACjB,OAAO,CAAC,EAAE;wBACV,UAAU;wBACV,QAAQ;wBACR,SAAS,IAAI,IAAI;wBACjB,UAAU;qBACX,CAAC,CAAC;gBACL,CAAC;qBAAM,IAAI,IAAI,KAAK,UAAU,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;oBACpD,wCAAwC;oBACxC,MAAM,WAAW,GAAG;;;;;;;;;;;;;WAanB,CAAC;oBAEF,MAAM,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,WAAW,EAAE;wBAC1C,GAAG,CAAC,WAAW,EAAE;wBACjB,OAAO,CAAC,EAAE;wBACV,UAAU;wBACV,QAAQ;wBACR,SAAS,IAAI,IAAI;wBACjB,UAAU;qBACX,CAAC,CAAC;gBACL,CAAC;qBAAM,CAAC;oBACN,sDAAsD;oBACtD,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;gBACnH,CAAC;YACH,CAAC;iBAAM,CAAC;gBACN,qBAAqB;gBACrB,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;YACnH,CAAC;YAED,OAAO,CAAC,GAAG,CAAC,uCAAuC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YACrE,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACxB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,KAAK,CAAC,CAAC;YACpD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACK,KAAK,CAAC,gBAAgB,CAC5B,kBAA0B,EAC1B,IAAY,EACZ,SAAe,EACf,QAAgB,EAChB,SAA6B,EAC7B,UAAkB,EAClB,UAAkB;QAElB,MAAM,OAAO,GAAG,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;QACrE,MAAM,QAAQ,GAAG,IAAI,KAAK,WAAW,CAAC,CAAC,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;QAEvE,MAAM,WAAW,GAAG;;;;;;;;;;;;;;;;;;;;KAoBnB,CAAC;QAEF,OAAO,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,WAAW,EAAE;YACxC,kBAAkB;YAClB,IAAI;YACJ,OAAO;YACP,QAAQ;YACR,SAAS,IAAI,IAAI;YACjB,UAAU;YACV,QAAQ;YACR,UAAU;SACX,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,iBAAiB,CAAC,UAAkB;QACxC,IAAI,CAAC;YACH,MAAM,KAAK,GAAG;;;;;;;;;;;;;;;OAeb,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC;YAE1D,OAAO,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACxD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,gCAAgC,EAAE,KAAK,CAAC,CAAC;YACvD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,oBAAoB,CAAC,UAAkB,EAAE,QAAgB,EAAE;QAC/D,IAAI,CAAC;YACH,MAAM,KAAK,GAAG;;;;;;;;;;;;;;;OAeb,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC;YAEjE,OAAO,MAAM,CAAC,IAAI,CAAC;QACrB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,mCAAmC,EAAE,KAAK,CAAC,CAAC;YAC1D,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,yBAAyB,CAAC,IAAmC;QACjE,IAAI,CAAC;YACH,MAAM,EAAE,UAAU,EAAE,WAAW,EAAE,QAAQ,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC;YAC1E,OAAO,CAAC,GAAG,CAAC,qDAAqD,EAAE,EAAE,UAAU,EAAE,WAAW,EAAE,QAAQ,EAAE,UAAU,EAAE,SAAS,EAAE,CAAC,CAAC;YAEjI,6DAA6D;YAC7D,MAAM,cAAc,GAA4B;gBAC9C,UAAU;gBACV,WAAW;gBACX,UAAU,EAAE,UAAU;gBACtB,eAAe,EAAE,SAAS,EAAE,wCAAwC;gBACpE,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,0DAA0D;aACjF,CAAC;YAEF,MAAM,qCAAiB,CAAC,yBAAyB,CAAC,cAAc,CAAC,CAAC;YAElE,iDAAiD;YACjD,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;YACzB,KAAK,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAE3B,MAAM,KAAK,GAAG;;;;;;;;;;;;;;;;;;;;;;OAsBb,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,IAAA,kBAAO,GAAE,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,QAAQ,EAAE,UAAU,EAAE,UAAU,EAAE,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC;YAEpG,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBAC7B,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;YACpE,CAAC;YAED,OAAO,CAAC,GAAG,CAAC,gDAAgD,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YAC9E,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACxB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,wCAAwC,EAAE,KAAK,CAAC,CAAC;YAC/D,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,sBAAsB,CAAC,UAAkB;QAM7C,IAAI,CAAC;YACH,OAAO,MAAM,qCAAiB,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAC;QACpE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,sCAAsC,EAAE,KAAK,CAAC,CAAC;YAC7D,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,wBAAwB,CAAC,UAAkB,EAAE,WAAwB;QAMzE,IAAI,CAAC;YACH,OAAO,MAAM,qCAAiB,CAAC,wBAAwB,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;QACnF,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,qCAAqC,EAAE,KAAK,CAAC,CAAC;YAC5D,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,yBAAyB,CAAC,UAAkB;QAMhD,IAAI,CAAC;YACH,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;YACzB,KAAK,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAE3B,uBAAuB;YACvB,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,oBAAoB,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YACjE,MAAM,aAAa,GAAG,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE;gBAC9C,MAAM,WAAW,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;gBAChD,WAAW,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBACjC,OAAO,WAAW,CAAC,OAAO,EAAE,KAAK,KAAK,CAAC,OAAO,EAAE,CAAC;YACnD,CAAC,CAAC,CAAC;YAEH,4BAA4B;YAC5B,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,sBAAsB,CAAC,UAAU,CAAC,CAAC;YAElE,OAAO;gBACL,QAAQ,EAAE,aAAa;gBACvB,mBAAmB,EAAE,WAAW,CAAC,WAAW;gBAC5C,cAAc,EAAE,WAAW,CAAC,UAAU;gBACtC,MAAM,EAAE,WAAW,CAAC,MAAM;aAC3B,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,yCAAyC,EAAE,KAAK,CAAC,CAAC;YAChE,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;CACF;AAED,kBAAe,IAAI,YAAY,EAAE,CAAC",
      names: [],
      sources: ["/home/kim/tito/server/src/services/kiosk/kioskService.ts"],
      sourcesContent: ["import { getPool } from '../../config/database';\nimport { attendanceService, TimeBasedAttendanceData } from '../attendance/attendanceService';\nimport { SessionType, getSessionDisplayInfo } from '../../utils/timeValidation';\n\ninterface KioskEmployee {\n  id: string;\n  employeeId: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  departmentId: string;\n  departmentName: string;\n  position: string;\n  employmentType: 'regular' | 'contractual' | 'jo';\n  hireDate: string;\n  baseSalary: number;\n  status: 'active' | 'inactive' | 'terminated' | 'on_leave';\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface KioskAttendanceRecord {\n  id: string;\n  employeeId: string;\n  type: 'clock_in' | 'clock_out';\n  sessionType: SessionType;\n  timestamp: string;\n  location: string;\n  selfieUrl?: string;\n  qrCodeScanned: boolean;\n  qrCodeData?: string;\n}\n\ninterface RecordAttendanceData {\n  employeeId: string;\n  type: 'clock_in' | 'clock_out';\n  location: string;\n  qrCodeData: string;\n  selfieUrl?: string;\n}\n\ninterface TimeBasedRecordAttendanceData {\n  employeeId: string;\n  sessionType: SessionType;\n  location: string;\n  qrCodeData: string;\n  selfieUrl?: string;\n}\n\nclass KioskService {\n  /**\n   * Verify employee by QR code data\n   */\n  async verifyEmployeeByQR(qrCodeData: string): Promise<KioskEmployee> {\n    try {\n      // Parse QR code data (assuming it's JSON)\n      let qrData;\n      try {\n        qrData = JSON.parse(qrCodeData);\n      } catch (error) {\n        throw new Error('Invalid QR code format');\n      }\n\n      // Extract employee ID from QR code\n      const employeeId = qrData.employeeId;\n      if (!employeeId) {\n        throw new Error('Employee ID not found in QR code');\n      }\n\n      // Query employee by employee ID\n      const query = `\n        SELECT \n          e.id,\n          e.employee_id as \"employeeId\",\n          u.first_name as \"firstName\",\n          u.last_name as \"lastName\",\n          u.email,\n          e.department_id as \"departmentId\",\n          d.name as \"departmentName\",\n          e.position,\n          e.employment_type as \"employmentType\",\n          e.hire_date as \"hireDate\",\n          e.base_salary as \"baseSalary\",\n          e.status,\n          e.created_at as \"createdAt\",\n          e.updated_at as \"updatedAt\"\n        FROM employees e\n        JOIN users u ON e.user_id = u.id\n        LEFT JOIN departments d ON e.department_id = d.id\n        WHERE e.employee_id = $1 AND e.status = 'active'\n      `;\n\n      const result = await getPool().query(query, [employeeId]);\n      \n      if (result.rows.length === 0) {\n        throw new Error('Employee not found or inactive');\n      }\n\n      return result.rows[0];\n    } catch (error) {\n      console.error('Error verifying employee by QR:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Record attendance\n   */\n  async recordAttendance(data: RecordAttendanceData): Promise<KioskAttendanceRecord> {\n    try {\n      const { employeeId, type, location, qrCodeData, selfieUrl } = data;\n      console.log('KioskService.recordAttendance called with:', { employeeId, type, location, qrCodeData, selfieUrl });\n\n      // First, ensure attendance record exists for today\n      const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\n      \n      const attendanceRecordQuery = `\n        INSERT INTO attendance_records (employee_id, date, overall_status)\n        VALUES ($1, $2, 'present')\n        ON CONFLICT (employee_id, date) DO NOTHING\n        RETURNING id\n      `;\n\n      const attendanceRecordResult = await getPool().query(attendanceRecordQuery, [employeeId, today]);\n      \n      // Get the attendance record ID (either newly created or existing)\n      let attendanceRecordId;\n      if (attendanceRecordResult.rows.length > 0) {\n        attendanceRecordId = attendanceRecordResult.rows[0].id;\n      } else {\n        // Get existing record\n        const existingRecordQuery = `\n          SELECT id FROM attendance_records \n          WHERE employee_id = $1 AND date = $2\n        `;\n        const existingResult = await getPool().query(existingRecordQuery, [employeeId, today]);\n        attendanceRecordId = existingResult.rows[0].id;\n      }\n\n      const now = new Date();\n\n      // Check if there's an existing incomplete session for today\n      const existingSessionQuery = `\n        SELECT s.id, s.session_type, s.clock_in, s.clock_out\n        FROM attendance_sessions s\n        JOIN attendance_records ar ON s.attendance_record_id = ar.id\n        WHERE ar.employee_id = $1 \n          AND ar.date = $2\n          AND (s.clock_in IS NULL OR s.clock_out IS NULL)\n        ORDER BY s.created_at DESC\n        LIMIT 1\n      `;\n      \n      const existingSession = await getPool().query(existingSessionQuery, [employeeId, today]);\n      \n      let result;\n      \n      if (existingSession.rows.length > 0) {\n        // Update existing session\n        const session = existingSession.rows[0];\n        \n        if (type === 'clock_out' && session.clock_in && !session.clock_out) {\n          // Complete the session with clock_out\n          const updateQuery = `\n            UPDATE attendance_sessions \n            SET clock_out = $1, selfie_image_url = $5, updated_at = NOW()\n            WHERE id = $2\n            RETURNING \n              id,\n              $3 as \"employeeId\",\n              'clock_out' as \"type\",\n              $1 as \"timestamp\",\n              $4 as \"location\",\n              $5 as \"selfieUrl\",\n              $6 as \"qrCodeData\",\n              true as \"qrCodeScanned\"\n          `;\n          \n          result = await getPool().query(updateQuery, [\n            now.toISOString(),\n            session.id,\n            employeeId,\n            location,\n            selfieUrl || null,\n            qrCodeData\n          ]);\n        } else if (type === 'clock_in' && !session.clock_in) {\n          // Update existing session with clock_in\n          const updateQuery = `\n            UPDATE attendance_sessions \n            SET clock_in = $1, selfie_image_url = $5, updated_at = NOW()\n            WHERE id = $2\n            RETURNING \n              id,\n              $3 as \"employeeId\",\n              'clock_in' as \"type\",\n              $1 as \"timestamp\",\n              $4 as \"location\",\n              $5 as \"selfieUrl\",\n              $6 as \"qrCodeData\",\n              true as \"qrCodeScanned\"\n          `;\n          \n          result = await getPool().query(updateQuery, [\n            now.toISOString(),\n            session.id,\n            employeeId,\n            location,\n            selfieUrl || null,\n            qrCodeData\n          ]);\n        } else {\n          // Create new session if existing one can't be updated\n          result = await this.createNewSession(attendanceRecordId, type, now, location, selfieUrl, employeeId, qrCodeData);\n        }\n      } else {\n        // Create new session\n        result = await this.createNewSession(attendanceRecordId, type, now, location, selfieUrl, employeeId, qrCodeData);\n      }\n\n      console.log('KioskService.recordAttendance result:', result.rows[0]);\n      return result.rows[0];\n    } catch (error) {\n      console.error('Error recording attendance:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Create a new attendance session\n   */\n  private async createNewSession(\n    attendanceRecordId: string, \n    type: string, \n    timestamp: Date, \n    location: string, \n    selfieUrl: string | undefined, \n    employeeId: string, \n    qrCodeData: string\n  ) {\n    const clockIn = type === 'clock_in' ? timestamp.toISOString() : null;\n    const clockOut = type === 'clock_out' ? timestamp.toISOString() : null;\n\n    const insertQuery = `\n      INSERT INTO attendance_sessions (\n        attendance_record_id,\n        session_type,\n        clock_in,\n        clock_out,\n        status,\n        selfie_image_path,\n        selfie_image_url,\n        created_at\n      ) VALUES ($1, $2, $3, $4, 'present', $5, $5, NOW())\n      RETURNING \n        id,\n        $6 as \"employeeId\",\n        $2 as \"type\",\n        COALESCE($3, $4) as \"timestamp\",\n        $7 as \"location\",\n        $5 as \"selfieUrl\",\n        $8 as \"qrCodeData\",\n        true as \"qrCodeScanned\"\n    `;\n\n    return await getPool().query(insertQuery, [\n      attendanceRecordId,\n      type,\n      clockIn,\n      clockOut,\n      selfieUrl || null,\n      employeeId,\n      location,\n      qrCodeData\n    ]);\n  }\n\n  /**\n   * Get last attendance record for employee\n   */\n  async getLastAttendance(employeeId: string): Promise<KioskAttendanceRecord | null> {\n    try {\n      const query = `\n        SELECT \n          s.id,\n          ar.employee_id as \"employeeId\",\n          s.session_type as \"type\",\n          COALESCE(s.clock_in, s.clock_out) as \"timestamp\",\n          'Office' as \"location\",\n          s.selfie_image_path as \"selfieUrl\",\n          'QR_CODE_DATA' as \"qrCodeData\",\n          true as \"qrCodeScanned\"\n        FROM attendance_sessions s\n        JOIN attendance_records ar ON s.attendance_record_id = ar.id\n        WHERE ar.employee_id = $1\n        ORDER BY s.created_at DESC\n        LIMIT 1\n      `;\n\n      const result = await getPool().query(query, [employeeId]);\n      \n      return result.rows.length > 0 ? result.rows[0] : null;\n    } catch (error) {\n      console.error('Error getting last attendance:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get attendance history for employee\n   */\n  async getAttendanceHistory(employeeId: string, limit: number = 10): Promise<KioskAttendanceRecord[]> {\n    try {\n      const query = `\n        SELECT \n          s.id,\n          ar.employee_id as \"employeeId\",\n          s.session_type as \"type\",\n          COALESCE(s.clock_in, s.clock_out) as \"timestamp\",\n          'Office' as \"location\",\n          s.selfie_image_path as \"selfieUrl\",\n          'QR_CODE_DATA' as \"qrCodeData\",\n          true as \"qrCodeScanned\"\n        FROM attendance_sessions s\n        JOIN attendance_records ar ON s.attendance_record_id = ar.id\n        WHERE ar.employee_id = $1\n        ORDER BY s.created_at DESC\n        LIMIT $2\n      `;\n\n      const result = await getPool().query(query, [employeeId, limit]);\n      \n      return result.rows;\n    } catch (error) {\n      console.error('Error getting attendance history:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Record time-based attendance using the new session system\n   */\n  async recordTimeBasedAttendance(data: TimeBasedRecordAttendanceData): Promise<KioskAttendanceRecord> {\n    try {\n      const { employeeId, sessionType, location, qrCodeData, selfieUrl } = data;\n      console.log('KioskService.recordTimeBasedAttendance called with:', { employeeId, sessionType, location, qrCodeData, selfieUrl });\n\n      // Use the attendance service to record time-based attendance\n      const attendanceData: TimeBasedAttendanceData = {\n        employeeId,\n        sessionType,\n        qrCodeHash: qrCodeData,\n        selfieImagePath: selfieUrl, // This is now the file path from Multer\n        timestamp: new Date() // This will be converted to UTC in the attendance service\n      };\n\n      await attendanceService.recordTimeBasedAttendance(attendanceData);\n      \n      // Find the session that was just created/updated\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      const query = `\n        SELECT \n          s.id,\n          ar.employee_id as \"employeeId\",\n          s.session_type as \"sessionType\",\n          COALESCE(s.clock_in, s.clock_out) as \"timestamp\",\n          $1 as \"location\",\n          s.selfie_image_path as \"selfieUrl\",\n          $2 as \"qrCodeData\",\n          true as \"qrCodeScanned\",\n          CASE \n            WHEN s.session_type IN ('morning_in', 'afternoon_in') THEN 'clock_in'\n            WHEN s.session_type IN ('morning_out', 'afternoon_out') THEN 'clock_out'\n            ELSE 'clock_in'\n          END as \"type\"\n        FROM attendance_sessions s\n        JOIN attendance_records ar ON s.attendance_record_id = ar.id\n        WHERE ar.employee_id = $3\n          AND ar.date = $4\n          AND s.session_type = $5\n        ORDER BY s.created_at DESC\n        LIMIT 1\n      `;\n\n      const result = await getPool().query(query, [location, qrCodeData, employeeId, today, sessionType]);\n      \n      if (result.rows.length === 0) {\n        throw new Error('Failed to retrieve recorded attendance session');\n      }\n\n      console.log('KioskService.recordTimeBasedAttendance result:', result.rows[0]);\n      return result.rows[0];\n    } catch (error) {\n      console.error('Error recording time-based attendance:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get next expected session for employee\n   */\n  async getNextExpectedSession(employeeId: string): Promise<{\n    sessionType: SessionType | null;\n    displayInfo: ReturnType<typeof getSessionDisplayInfo> | null;\n    canPerform: boolean;\n    reason?: string;\n  }> {\n    try {\n      return await attendanceService.getNextExpectedSession(employeeId);\n    } catch (error) {\n      console.error('Error getting next expected session:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Validate attendance action for employee\n   */\n  async validateAttendanceAction(employeeId: string, sessionType: SessionType): Promise<{\n    canPerform: boolean;\n    reason?: string;\n    nextExpectedSession?: SessionType;\n    sessionDisplayInfo?: ReturnType<typeof getSessionDisplayInfo>;\n  }> {\n    try {\n      return await attendanceService.validateAttendanceAction(employeeId, sessionType);\n    } catch (error) {\n      console.error('Error validating attendance action:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get today's attendance summary for employee\n   */\n  async getTodayAttendanceSummary(employeeId: string): Promise<{\n    sessions: KioskAttendanceRecord[];\n    nextExpectedSession: SessionType | null;\n    canPerformNext: boolean;\n    reason?: string;\n  }> {\n    try {\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      // Get today's sessions\n      const sessions = await this.getAttendanceHistory(employeeId, 10);\n      const todaySessions = sessions.filter(session => {\n        const sessionDate = new Date(session.timestamp);\n        sessionDate.setHours(0, 0, 0, 0);\n        return sessionDate.getTime() === today.getTime();\n      });\n\n      // Get next expected session\n      const nextSession = await this.getNextExpectedSession(employeeId);\n\n      return {\n        sessions: todaySessions,\n        nextExpectedSession: nextSession.sessionType,\n        canPerformNext: nextSession.canPerform,\n        reason: nextSession.reason\n      };\n    } catch (error) {\n      console.error('Error getting today attendance summary:', error);\n      throw error;\n    }\n  }\n}\n\nexport default new KioskService();\n"],
      version: 3
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "3197a2ab476e56c24a000d8e1eb167ccc2e3e63e"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_2sefjesn = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_2sefjesn();
cov_2sefjesn().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
const database_1 =
/* istanbul ignore next */
(cov_2sefjesn().s[1]++, require("../../config/database"));
const attendanceService_1 =
/* istanbul ignore next */
(cov_2sefjesn().s[2]++, require("../attendance/attendanceService"));
class KioskService {
  /**
   * Verify employee by QR code data
   */
  async verifyEmployeeByQR(qrCodeData) {
    /* istanbul ignore next */
    cov_2sefjesn().f[0]++;
    cov_2sefjesn().s[3]++;
    try {
      // Parse QR code data (assuming it's JSON)
      let qrData;
      /* istanbul ignore next */
      cov_2sefjesn().s[4]++;
      try {
        /* istanbul ignore next */
        cov_2sefjesn().s[5]++;
        qrData = JSON.parse(qrCodeData);
      } catch (error) {
        /* istanbul ignore next */
        cov_2sefjesn().s[6]++;
        throw new Error('Invalid QR code format');
      }
      // Extract employee ID from QR code
      const employeeId =
      /* istanbul ignore next */
      (cov_2sefjesn().s[7]++, qrData.employeeId);
      /* istanbul ignore next */
      cov_2sefjesn().s[8]++;
      if (!employeeId) {
        /* istanbul ignore next */
        cov_2sefjesn().b[0][0]++;
        cov_2sefjesn().s[9]++;
        throw new Error('Employee ID not found in QR code');
      } else
      /* istanbul ignore next */
      {
        cov_2sefjesn().b[0][1]++;
      }
      // Query employee by employee ID
      const query =
      /* istanbul ignore next */
      (cov_2sefjesn().s[10]++, `
        SELECT 
          e.id,
          e.employee_id as "employeeId",
          u.first_name as "firstName",
          u.last_name as "lastName",
          u.email,
          e.department_id as "departmentId",
          d.name as "departmentName",
          e.position,
          e.employment_type as "employmentType",
          e.hire_date as "hireDate",
          e.base_salary as "baseSalary",
          e.status,
          e.created_at as "createdAt",
          e.updated_at as "updatedAt"
        FROM employees e
        JOIN users u ON e.user_id = u.id
        LEFT JOIN departments d ON e.department_id = d.id
        WHERE e.employee_id = $1 AND e.status = 'active'
      `);
      const result =
      /* istanbul ignore next */
      (cov_2sefjesn().s[11]++, await (0, database_1.getPool)().query(query, [employeeId]));
      /* istanbul ignore next */
      cov_2sefjesn().s[12]++;
      if (result.rows.length === 0) {
        /* istanbul ignore next */
        cov_2sefjesn().b[1][0]++;
        cov_2sefjesn().s[13]++;
        throw new Error('Employee not found or inactive');
      } else
      /* istanbul ignore next */
      {
        cov_2sefjesn().b[1][1]++;
      }
      cov_2sefjesn().s[14]++;
      return result.rows[0];
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[15]++;
      console.error('Error verifying employee by QR:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[16]++;
      throw error;
    }
  }
  /**
   * Record attendance
   */
  async recordAttendance(data) {
    /* istanbul ignore next */
    cov_2sefjesn().f[1]++;
    cov_2sefjesn().s[17]++;
    try {
      const {
        employeeId,
        type,
        location,
        qrCodeData,
        selfieUrl
      } =
      /* istanbul ignore next */
      (cov_2sefjesn().s[18]++, data);
      /* istanbul ignore next */
      cov_2sefjesn().s[19]++;
      console.log('KioskService.recordAttendance called with:', {
        employeeId,
        type,
        location,
        qrCodeData,
        selfieUrl
      });
      // First, ensure attendance record exists for today
      const today =
      /* istanbul ignore next */
      (cov_2sefjesn().s[20]++, new Date().toISOString().split('T')[0]); // YYYY-MM-DD format
      const attendanceRecordQuery =
      /* istanbul ignore next */
      (cov_2sefjesn().s[21]++, `
        INSERT INTO attendance_records (employee_id, date, overall_status)
        VALUES ($1, $2, 'present')
        ON CONFLICT (employee_id, date) DO NOTHING
        RETURNING id
      `);
      const attendanceRecordResult =
      /* istanbul ignore next */
      (cov_2sefjesn().s[22]++, await (0, database_1.getPool)().query(attendanceRecordQuery, [employeeId, today]));
      // Get the attendance record ID (either newly created or existing)
      let attendanceRecordId;
      /* istanbul ignore next */
      cov_2sefjesn().s[23]++;
      if (attendanceRecordResult.rows.length > 0) {
        /* istanbul ignore next */
        cov_2sefjesn().b[2][0]++;
        cov_2sefjesn().s[24]++;
        attendanceRecordId = attendanceRecordResult.rows[0].id;
      } else {
        /* istanbul ignore next */
        cov_2sefjesn().b[2][1]++;
        // Get existing record
        const existingRecordQuery =
        /* istanbul ignore next */
        (cov_2sefjesn().s[25]++, `
          SELECT id FROM attendance_records 
          WHERE employee_id = $1 AND date = $2
        `);
        const existingResult =
        /* istanbul ignore next */
        (cov_2sefjesn().s[26]++, await (0, database_1.getPool)().query(existingRecordQuery, [employeeId, today]));
        /* istanbul ignore next */
        cov_2sefjesn().s[27]++;
        attendanceRecordId = existingResult.rows[0].id;
      }
      const now =
      /* istanbul ignore next */
      (cov_2sefjesn().s[28]++, new Date());
      // Check if there's an existing incomplete session for today
      const existingSessionQuery =
      /* istanbul ignore next */
      (cov_2sefjesn().s[29]++, `
        SELECT s.id, s.session_type, s.clock_in, s.clock_out
        FROM attendance_sessions s
        JOIN attendance_records ar ON s.attendance_record_id = ar.id
        WHERE ar.employee_id = $1 
          AND ar.date = $2
          AND (s.clock_in IS NULL OR s.clock_out IS NULL)
        ORDER BY s.created_at DESC
        LIMIT 1
      `);
      const existingSession =
      /* istanbul ignore next */
      (cov_2sefjesn().s[30]++, await (0, database_1.getPool)().query(existingSessionQuery, [employeeId, today]));
      let result;
      /* istanbul ignore next */
      cov_2sefjesn().s[31]++;
      if (existingSession.rows.length > 0) {
        /* istanbul ignore next */
        cov_2sefjesn().b[3][0]++;
        // Update existing session
        const session =
        /* istanbul ignore next */
        (cov_2sefjesn().s[32]++, existingSession.rows[0]);
        /* istanbul ignore next */
        cov_2sefjesn().s[33]++;
        if (
        /* istanbul ignore next */
        (cov_2sefjesn().b[5][0]++, type === 'clock_out') &&
        /* istanbul ignore next */
        (cov_2sefjesn().b[5][1]++, session.clock_in) &&
        /* istanbul ignore next */
        (cov_2sefjesn().b[5][2]++, !session.clock_out)) {
          /* istanbul ignore next */
          cov_2sefjesn().b[4][0]++;
          // Complete the session with clock_out
          const updateQuery =
          /* istanbul ignore next */
          (cov_2sefjesn().s[34]++, `
            UPDATE attendance_sessions 
            SET clock_out = $1, selfie_image_url = $5, updated_at = NOW()
            WHERE id = $2
            RETURNING 
              id,
              $3 as "employeeId",
              'clock_out' as "type",
              $1 as "timestamp",
              $4 as "location",
              $5 as "selfieUrl",
              $6 as "qrCodeData",
              true as "qrCodeScanned"
          `);
          /* istanbul ignore next */
          cov_2sefjesn().s[35]++;
          result = await (0, database_1.getPool)().query(updateQuery, [now.toISOString(), session.id, employeeId, location,
          /* istanbul ignore next */
          (cov_2sefjesn().b[6][0]++, selfieUrl) ||
          /* istanbul ignore next */
          (cov_2sefjesn().b[6][1]++, null), qrCodeData]);
        } else {
          /* istanbul ignore next */
          cov_2sefjesn().b[4][1]++;
          cov_2sefjesn().s[36]++;
          if (
          /* istanbul ignore next */
          (cov_2sefjesn().b[8][0]++, type === 'clock_in') &&
          /* istanbul ignore next */
          (cov_2sefjesn().b[8][1]++, !session.clock_in)) {
            /* istanbul ignore next */
            cov_2sefjesn().b[7][0]++;
            // Update existing session with clock_in
            const updateQuery =
            /* istanbul ignore next */
            (cov_2sefjesn().s[37]++, `
            UPDATE attendance_sessions 
            SET clock_in = $1, selfie_image_url = $5, updated_at = NOW()
            WHERE id = $2
            RETURNING 
              id,
              $3 as "employeeId",
              'clock_in' as "type",
              $1 as "timestamp",
              $4 as "location",
              $5 as "selfieUrl",
              $6 as "qrCodeData",
              true as "qrCodeScanned"
          `);
            /* istanbul ignore next */
            cov_2sefjesn().s[38]++;
            result = await (0, database_1.getPool)().query(updateQuery, [now.toISOString(), session.id, employeeId, location,
            /* istanbul ignore next */
            (cov_2sefjesn().b[9][0]++, selfieUrl) ||
            /* istanbul ignore next */
            (cov_2sefjesn().b[9][1]++, null), qrCodeData]);
          } else {
            /* istanbul ignore next */
            cov_2sefjesn().b[7][1]++;
            cov_2sefjesn().s[39]++;
            // Create new session if existing one can't be updated
            result = await this.createNewSession(attendanceRecordId, type, now, location, selfieUrl, employeeId, qrCodeData);
          }
        }
      } else {
        /* istanbul ignore next */
        cov_2sefjesn().b[3][1]++;
        cov_2sefjesn().s[40]++;
        // Create new session
        result = await this.createNewSession(attendanceRecordId, type, now, location, selfieUrl, employeeId, qrCodeData);
      }
      /* istanbul ignore next */
      cov_2sefjesn().s[41]++;
      console.log('KioskService.recordAttendance result:', result.rows[0]);
      /* istanbul ignore next */
      cov_2sefjesn().s[42]++;
      return result.rows[0];
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[43]++;
      console.error('Error recording attendance:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[44]++;
      throw error;
    }
  }
  /**
   * Create a new attendance session
   */
  async createNewSession(attendanceRecordId, type, timestamp, location, selfieUrl, employeeId, qrCodeData) {
    /* istanbul ignore next */
    cov_2sefjesn().f[2]++;
    const clockIn =
    /* istanbul ignore next */
    (cov_2sefjesn().s[45]++, type === 'clock_in' ?
    /* istanbul ignore next */
    (cov_2sefjesn().b[10][0]++, timestamp.toISOString()) :
    /* istanbul ignore next */
    (cov_2sefjesn().b[10][1]++, null));
    const clockOut =
    /* istanbul ignore next */
    (cov_2sefjesn().s[46]++, type === 'clock_out' ?
    /* istanbul ignore next */
    (cov_2sefjesn().b[11][0]++, timestamp.toISOString()) :
    /* istanbul ignore next */
    (cov_2sefjesn().b[11][1]++, null));
    const insertQuery =
    /* istanbul ignore next */
    (cov_2sefjesn().s[47]++, `
      INSERT INTO attendance_sessions (
        attendance_record_id,
        session_type,
        clock_in,
        clock_out,
        status,
        selfie_image_path,
        selfie_image_url,
        created_at
      ) VALUES ($1, $2, $3, $4, 'present', $5, $5, NOW())
      RETURNING 
        id,
        $6 as "employeeId",
        $2 as "type",
        COALESCE($3, $4) as "timestamp",
        $7 as "location",
        $5 as "selfieUrl",
        $8 as "qrCodeData",
        true as "qrCodeScanned"
    `);
    /* istanbul ignore next */
    cov_2sefjesn().s[48]++;
    return await (0, database_1.getPool)().query(insertQuery, [attendanceRecordId, type, clockIn, clockOut,
    /* istanbul ignore next */
    (cov_2sefjesn().b[12][0]++, selfieUrl) ||
    /* istanbul ignore next */
    (cov_2sefjesn().b[12][1]++, null), employeeId, location, qrCodeData]);
  }
  /**
   * Get last attendance record for employee
   */
  async getLastAttendance(employeeId) {
    /* istanbul ignore next */
    cov_2sefjesn().f[3]++;
    cov_2sefjesn().s[49]++;
    try {
      const query =
      /* istanbul ignore next */
      (cov_2sefjesn().s[50]++, `
        SELECT 
          s.id,
          ar.employee_id as "employeeId",
          s.session_type as "type",
          COALESCE(s.clock_in, s.clock_out) as "timestamp",
          'Office' as "location",
          s.selfie_image_path as "selfieUrl",
          'QR_CODE_DATA' as "qrCodeData",
          true as "qrCodeScanned"
        FROM attendance_sessions s
        JOIN attendance_records ar ON s.attendance_record_id = ar.id
        WHERE ar.employee_id = $1
        ORDER BY s.created_at DESC
        LIMIT 1
      `);
      const result =
      /* istanbul ignore next */
      (cov_2sefjesn().s[51]++, await (0, database_1.getPool)().query(query, [employeeId]));
      /* istanbul ignore next */
      cov_2sefjesn().s[52]++;
      return result.rows.length > 0 ?
      /* istanbul ignore next */
      (cov_2sefjesn().b[13][0]++, result.rows[0]) :
      /* istanbul ignore next */
      (cov_2sefjesn().b[13][1]++, null);
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[53]++;
      console.error('Error getting last attendance:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[54]++;
      throw error;
    }
  }
  /**
   * Get attendance history for employee
   */
  async getAttendanceHistory(employeeId, limit =
  /* istanbul ignore next */
  (cov_2sefjesn().b[14][0]++, 10)) {
    /* istanbul ignore next */
    cov_2sefjesn().f[4]++;
    cov_2sefjesn().s[55]++;
    try {
      const query =
      /* istanbul ignore next */
      (cov_2sefjesn().s[56]++, `
        SELECT 
          s.id,
          ar.employee_id as "employeeId",
          s.session_type as "type",
          COALESCE(s.clock_in, s.clock_out) as "timestamp",
          'Office' as "location",
          s.selfie_image_path as "selfieUrl",
          'QR_CODE_DATA' as "qrCodeData",
          true as "qrCodeScanned"
        FROM attendance_sessions s
        JOIN attendance_records ar ON s.attendance_record_id = ar.id
        WHERE ar.employee_id = $1
        ORDER BY s.created_at DESC
        LIMIT $2
      `);
      const result =
      /* istanbul ignore next */
      (cov_2sefjesn().s[57]++, await (0, database_1.getPool)().query(query, [employeeId, limit]));
      /* istanbul ignore next */
      cov_2sefjesn().s[58]++;
      return result.rows;
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[59]++;
      console.error('Error getting attendance history:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[60]++;
      throw error;
    }
  }
  /**
   * Record time-based attendance using the new session system
   */
  async recordTimeBasedAttendance(data) {
    /* istanbul ignore next */
    cov_2sefjesn().f[5]++;
    cov_2sefjesn().s[61]++;
    try {
      const {
        employeeId,
        sessionType,
        location,
        qrCodeData,
        selfieUrl
      } =
      /* istanbul ignore next */
      (cov_2sefjesn().s[62]++, data);
      /* istanbul ignore next */
      cov_2sefjesn().s[63]++;
      console.log('KioskService.recordTimeBasedAttendance called with:', {
        employeeId,
        sessionType,
        location,
        qrCodeData,
        selfieUrl
      });
      // Use the attendance service to record time-based attendance
      const attendanceData =
      /* istanbul ignore next */
      (cov_2sefjesn().s[64]++, {
        employeeId,
        sessionType,
        qrCodeHash: qrCodeData,
        selfieImagePath: selfieUrl,
        // This is now the file path from Multer
        timestamp: new Date() // This will be converted to UTC in the attendance service
      });
      /* istanbul ignore next */
      cov_2sefjesn().s[65]++;
      await attendanceService_1.attendanceService.recordTimeBasedAttendance(attendanceData);
      // Find the session that was just created/updated
      const today =
      /* istanbul ignore next */
      (cov_2sefjesn().s[66]++, new Date());
      /* istanbul ignore next */
      cov_2sefjesn().s[67]++;
      today.setHours(0, 0, 0, 0);
      const query =
      /* istanbul ignore next */
      (cov_2sefjesn().s[68]++, `
        SELECT 
          s.id,
          ar.employee_id as "employeeId",
          s.session_type as "sessionType",
          COALESCE(s.clock_in, s.clock_out) as "timestamp",
          $1 as "location",
          s.selfie_image_path as "selfieUrl",
          $2 as "qrCodeData",
          true as "qrCodeScanned",
          CASE 
            WHEN s.session_type IN ('morning_in', 'afternoon_in') THEN 'clock_in'
            WHEN s.session_type IN ('morning_out', 'afternoon_out') THEN 'clock_out'
            ELSE 'clock_in'
          END as "type"
        FROM attendance_sessions s
        JOIN attendance_records ar ON s.attendance_record_id = ar.id
        WHERE ar.employee_id = $3
          AND ar.date = $4
          AND s.session_type = $5
        ORDER BY s.created_at DESC
        LIMIT 1
      `);
      const result =
      /* istanbul ignore next */
      (cov_2sefjesn().s[69]++, await (0, database_1.getPool)().query(query, [location, qrCodeData, employeeId, today, sessionType]));
      /* istanbul ignore next */
      cov_2sefjesn().s[70]++;
      if (result.rows.length === 0) {
        /* istanbul ignore next */
        cov_2sefjesn().b[15][0]++;
        cov_2sefjesn().s[71]++;
        throw new Error('Failed to retrieve recorded attendance session');
      } else
      /* istanbul ignore next */
      {
        cov_2sefjesn().b[15][1]++;
      }
      cov_2sefjesn().s[72]++;
      console.log('KioskService.recordTimeBasedAttendance result:', result.rows[0]);
      /* istanbul ignore next */
      cov_2sefjesn().s[73]++;
      return result.rows[0];
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[74]++;
      console.error('Error recording time-based attendance:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[75]++;
      throw error;
    }
  }
  /**
   * Get next expected session for employee
   */
  async getNextExpectedSession(employeeId) {
    /* istanbul ignore next */
    cov_2sefjesn().f[6]++;
    cov_2sefjesn().s[76]++;
    try {
      /* istanbul ignore next */
      cov_2sefjesn().s[77]++;
      return await attendanceService_1.attendanceService.getNextExpectedSession(employeeId);
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[78]++;
      console.error('Error getting next expected session:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[79]++;
      throw error;
    }
  }
  /**
   * Validate attendance action for employee
   */
  async validateAttendanceAction(employeeId, sessionType) {
    /* istanbul ignore next */
    cov_2sefjesn().f[7]++;
    cov_2sefjesn().s[80]++;
    try {
      /* istanbul ignore next */
      cov_2sefjesn().s[81]++;
      return await attendanceService_1.attendanceService.validateAttendanceAction(employeeId, sessionType);
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[82]++;
      console.error('Error validating attendance action:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[83]++;
      throw error;
    }
  }
  /**
   * Get today's attendance summary for employee
   */
  async getTodayAttendanceSummary(employeeId) {
    /* istanbul ignore next */
    cov_2sefjesn().f[8]++;
    cov_2sefjesn().s[84]++;
    try {
      const today =
      /* istanbul ignore next */
      (cov_2sefjesn().s[85]++, new Date());
      /* istanbul ignore next */
      cov_2sefjesn().s[86]++;
      today.setHours(0, 0, 0, 0);
      // Get today's sessions
      const sessions =
      /* istanbul ignore next */
      (cov_2sefjesn().s[87]++, await this.getAttendanceHistory(employeeId, 10));
      const todaySessions =
      /* istanbul ignore next */
      (cov_2sefjesn().s[88]++, sessions.filter(session => {
        /* istanbul ignore next */
        cov_2sefjesn().f[9]++;
        const sessionDate =
        /* istanbul ignore next */
        (cov_2sefjesn().s[89]++, new Date(session.timestamp));
        /* istanbul ignore next */
        cov_2sefjesn().s[90]++;
        sessionDate.setHours(0, 0, 0, 0);
        /* istanbul ignore next */
        cov_2sefjesn().s[91]++;
        return sessionDate.getTime() === today.getTime();
      }));
      // Get next expected session
      const nextSession =
      /* istanbul ignore next */
      (cov_2sefjesn().s[92]++, await this.getNextExpectedSession(employeeId));
      /* istanbul ignore next */
      cov_2sefjesn().s[93]++;
      return {
        sessions: todaySessions,
        nextExpectedSession: nextSession.sessionType,
        canPerformNext: nextSession.canPerform,
        reason: nextSession.reason
      };
    } catch (error) {
      /* istanbul ignore next */
      cov_2sefjesn().s[94]++;
      console.error('Error getting today attendance summary:', error);
      /* istanbul ignore next */
      cov_2sefjesn().s[95]++;
      throw error;
    }
  }
}
/* istanbul ignore next */
cov_2sefjesn().s[96]++;
exports.default = new KioskService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMnNlZmplc24iLCJhY3R1YWxDb3ZlcmFnZSIsInMiLCJkYXRhYmFzZV8xIiwicmVxdWlyZSIsImF0dGVuZGFuY2VTZXJ2aWNlXzEiLCJLaW9za1NlcnZpY2UiLCJ2ZXJpZnlFbXBsb3llZUJ5UVIiLCJxckNvZGVEYXRhIiwiZiIsInFyRGF0YSIsIkpTT04iLCJwYXJzZSIsImVycm9yIiwiRXJyb3IiLCJlbXBsb3llZUlkIiwiYiIsInF1ZXJ5IiwicmVzdWx0IiwiZ2V0UG9vbCIsInJvd3MiLCJsZW5ndGgiLCJjb25zb2xlIiwicmVjb3JkQXR0ZW5kYW5jZSIsImRhdGEiLCJ0eXBlIiwibG9jYXRpb24iLCJzZWxmaWVVcmwiLCJsb2ciLCJ0b2RheSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInNwbGl0IiwiYXR0ZW5kYW5jZVJlY29yZFF1ZXJ5IiwiYXR0ZW5kYW5jZVJlY29yZFJlc3VsdCIsImF0dGVuZGFuY2VSZWNvcmRJZCIsImlkIiwiZXhpc3RpbmdSZWNvcmRRdWVyeSIsImV4aXN0aW5nUmVzdWx0Iiwibm93IiwiZXhpc3RpbmdTZXNzaW9uUXVlcnkiLCJleGlzdGluZ1Nlc3Npb24iLCJzZXNzaW9uIiwiY2xvY2tfaW4iLCJjbG9ja19vdXQiLCJ1cGRhdGVRdWVyeSIsImNyZWF0ZU5ld1Nlc3Npb24iLCJ0aW1lc3RhbXAiLCJjbG9ja0luIiwiY2xvY2tPdXQiLCJpbnNlcnRRdWVyeSIsImdldExhc3RBdHRlbmRhbmNlIiwiZ2V0QXR0ZW5kYW5jZUhpc3RvcnkiLCJsaW1pdCIsInJlY29yZFRpbWVCYXNlZEF0dGVuZGFuY2UiLCJzZXNzaW9uVHlwZSIsImF0dGVuZGFuY2VEYXRhIiwicXJDb2RlSGFzaCIsInNlbGZpZUltYWdlUGF0aCIsImF0dGVuZGFuY2VTZXJ2aWNlIiwic2V0SG91cnMiLCJnZXROZXh0RXhwZWN0ZWRTZXNzaW9uIiwidmFsaWRhdGVBdHRlbmRhbmNlQWN0aW9uIiwiZ2V0VG9kYXlBdHRlbmRhbmNlU3VtbWFyeSIsInNlc3Npb25zIiwidG9kYXlTZXNzaW9ucyIsImZpbHRlciIsInNlc3Npb25EYXRlIiwiZ2V0VGltZSIsIm5leHRTZXNzaW9uIiwibmV4dEV4cGVjdGVkU2Vzc2lvbiIsImNhblBlcmZvcm1OZXh0IiwiY2FuUGVyZm9ybSIsInJlYXNvbiIsImV4cG9ydHMiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiL2hvbWUva2ltL3RpdG8vc2VydmVyL3NyYy9zZXJ2aWNlcy9raW9zay9raW9za1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2V0UG9vbCB9IGZyb20gJy4uLy4uL2NvbmZpZy9kYXRhYmFzZSc7XG5pbXBvcnQgeyBhdHRlbmRhbmNlU2VydmljZSwgVGltZUJhc2VkQXR0ZW5kYW5jZURhdGEgfSBmcm9tICcuLi9hdHRlbmRhbmNlL2F0dGVuZGFuY2VTZXJ2aWNlJztcbmltcG9ydCB7IFNlc3Npb25UeXBlLCBnZXRTZXNzaW9uRGlzcGxheUluZm8gfSBmcm9tICcuLi8uLi91dGlscy90aW1lVmFsaWRhdGlvbic7XG5cbmludGVyZmFjZSBLaW9za0VtcGxveWVlIHtcbiAgaWQ6IHN0cmluZztcbiAgZW1wbG95ZWVJZDogc3RyaW5nO1xuICBmaXJzdE5hbWU6IHN0cmluZztcbiAgbGFzdE5hbWU6IHN0cmluZztcbiAgZW1haWw6IHN0cmluZztcbiAgZGVwYXJ0bWVudElkOiBzdHJpbmc7XG4gIGRlcGFydG1lbnROYW1lOiBzdHJpbmc7XG4gIHBvc2l0aW9uOiBzdHJpbmc7XG4gIGVtcGxveW1lbnRUeXBlOiAncmVndWxhcicgfCAnY29udHJhY3R1YWwnIHwgJ2pvJztcbiAgaGlyZURhdGU6IHN0cmluZztcbiAgYmFzZVNhbGFyeTogbnVtYmVyO1xuICBzdGF0dXM6ICdhY3RpdmUnIHwgJ2luYWN0aXZlJyB8ICd0ZXJtaW5hdGVkJyB8ICdvbl9sZWF2ZSc7XG4gIGNyZWF0ZWRBdDogc3RyaW5nO1xuICB1cGRhdGVkQXQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEtpb3NrQXR0ZW5kYW5jZVJlY29yZCB7XG4gIGlkOiBzdHJpbmc7XG4gIGVtcGxveWVlSWQ6IHN0cmluZztcbiAgdHlwZTogJ2Nsb2NrX2luJyB8ICdjbG9ja19vdXQnO1xuICBzZXNzaW9uVHlwZTogU2Vzc2lvblR5cGU7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xuICBsb2NhdGlvbjogc3RyaW5nO1xuICBzZWxmaWVVcmw/OiBzdHJpbmc7XG4gIHFyQ29kZVNjYW5uZWQ6IGJvb2xlYW47XG4gIHFyQ29kZURhdGE/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBSZWNvcmRBdHRlbmRhbmNlRGF0YSB7XG4gIGVtcGxveWVlSWQ6IHN0cmluZztcbiAgdHlwZTogJ2Nsb2NrX2luJyB8ICdjbG9ja19vdXQnO1xuICBsb2NhdGlvbjogc3RyaW5nO1xuICBxckNvZGVEYXRhOiBzdHJpbmc7XG4gIHNlbGZpZVVybD86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFRpbWVCYXNlZFJlY29yZEF0dGVuZGFuY2VEYXRhIHtcbiAgZW1wbG95ZWVJZDogc3RyaW5nO1xuICBzZXNzaW9uVHlwZTogU2Vzc2lvblR5cGU7XG4gIGxvY2F0aW9uOiBzdHJpbmc7XG4gIHFyQ29kZURhdGE6IHN0cmluZztcbiAgc2VsZmllVXJsPzogc3RyaW5nO1xufVxuXG5jbGFzcyBLaW9za1NlcnZpY2Uge1xuICAvKipcbiAgICogVmVyaWZ5IGVtcGxveWVlIGJ5IFFSIGNvZGUgZGF0YVxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5RW1wbG95ZWVCeVFSKHFyQ29kZURhdGE6IHN0cmluZyk6IFByb21pc2U8S2lvc2tFbXBsb3llZT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBQYXJzZSBRUiBjb2RlIGRhdGEgKGFzc3VtaW5nIGl0J3MgSlNPTilcbiAgICAgIGxldCBxckRhdGE7XG4gICAgICB0cnkge1xuICAgICAgICBxckRhdGEgPSBKU09OLnBhcnNlKHFyQ29kZURhdGEpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFFSIGNvZGUgZm9ybWF0Jyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEV4dHJhY3QgZW1wbG95ZWUgSUQgZnJvbSBRUiBjb2RlXG4gICAgICBjb25zdCBlbXBsb3llZUlkID0gcXJEYXRhLmVtcGxveWVlSWQ7XG4gICAgICBpZiAoIWVtcGxveWVlSWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbXBsb3llZSBJRCBub3QgZm91bmQgaW4gUVIgY29kZScpO1xuICAgICAgfVxuXG4gICAgICAvLyBRdWVyeSBlbXBsb3llZSBieSBlbXBsb3llZSBJRFxuICAgICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICBlLmlkLFxuICAgICAgICAgIGUuZW1wbG95ZWVfaWQgYXMgXCJlbXBsb3llZUlkXCIsXG4gICAgICAgICAgdS5maXJzdF9uYW1lIGFzIFwiZmlyc3ROYW1lXCIsXG4gICAgICAgICAgdS5sYXN0X25hbWUgYXMgXCJsYXN0TmFtZVwiLFxuICAgICAgICAgIHUuZW1haWwsXG4gICAgICAgICAgZS5kZXBhcnRtZW50X2lkIGFzIFwiZGVwYXJ0bWVudElkXCIsXG4gICAgICAgICAgZC5uYW1lIGFzIFwiZGVwYXJ0bWVudE5hbWVcIixcbiAgICAgICAgICBlLnBvc2l0aW9uLFxuICAgICAgICAgIGUuZW1wbG95bWVudF90eXBlIGFzIFwiZW1wbG95bWVudFR5cGVcIixcbiAgICAgICAgICBlLmhpcmVfZGF0ZSBhcyBcImhpcmVEYXRlXCIsXG4gICAgICAgICAgZS5iYXNlX3NhbGFyeSBhcyBcImJhc2VTYWxhcnlcIixcbiAgICAgICAgICBlLnN0YXR1cyxcbiAgICAgICAgICBlLmNyZWF0ZWRfYXQgYXMgXCJjcmVhdGVkQXRcIixcbiAgICAgICAgICBlLnVwZGF0ZWRfYXQgYXMgXCJ1cGRhdGVkQXRcIlxuICAgICAgICBGUk9NIGVtcGxveWVlcyBlXG4gICAgICAgIEpPSU4gdXNlcnMgdSBPTiBlLnVzZXJfaWQgPSB1LmlkXG4gICAgICAgIExFRlQgSk9JTiBkZXBhcnRtZW50cyBkIE9OIGUuZGVwYXJ0bWVudF9pZCA9IGQuaWRcbiAgICAgICAgV0hFUkUgZS5lbXBsb3llZV9pZCA9ICQxIEFORCBlLnN0YXR1cyA9ICdhY3RpdmUnXG4gICAgICBgO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRQb29sKCkucXVlcnkocXVlcnksIFtlbXBsb3llZUlkXSk7XG4gICAgICBcbiAgICAgIGlmIChyZXN1bHQucm93cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbXBsb3llZSBub3QgZm91bmQgb3IgaW5hY3RpdmUnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB2ZXJpZnlpbmcgZW1wbG95ZWUgYnkgUVI6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCBhdHRlbmRhbmNlXG4gICAqL1xuICBhc3luYyByZWNvcmRBdHRlbmRhbmNlKGRhdGE6IFJlY29yZEF0dGVuZGFuY2VEYXRhKTogUHJvbWlzZTxLaW9za0F0dGVuZGFuY2VSZWNvcmQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBlbXBsb3llZUlkLCB0eXBlLCBsb2NhdGlvbiwgcXJDb2RlRGF0YSwgc2VsZmllVXJsIH0gPSBkYXRhO1xuICAgICAgY29uc29sZS5sb2coJ0tpb3NrU2VydmljZS5yZWNvcmRBdHRlbmRhbmNlIGNhbGxlZCB3aXRoOicsIHsgZW1wbG95ZWVJZCwgdHlwZSwgbG9jYXRpb24sIHFyQ29kZURhdGEsIHNlbGZpZVVybCB9KTtcblxuICAgICAgLy8gRmlyc3QsIGVuc3VyZSBhdHRlbmRhbmNlIHJlY29yZCBleGlzdHMgZm9yIHRvZGF5XG4gICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOyAvLyBZWVlZLU1NLUREIGZvcm1hdFxuICAgICAgXG4gICAgICBjb25zdCBhdHRlbmRhbmNlUmVjb3JkUXVlcnkgPSBgXG4gICAgICAgIElOU0VSVCBJTlRPIGF0dGVuZGFuY2VfcmVjb3JkcyAoZW1wbG95ZWVfaWQsIGRhdGUsIG92ZXJhbGxfc3RhdHVzKVxuICAgICAgICBWQUxVRVMgKCQxLCAkMiwgJ3ByZXNlbnQnKVxuICAgICAgICBPTiBDT05GTElDVCAoZW1wbG95ZWVfaWQsIGRhdGUpIERPIE5PVEhJTkdcbiAgICAgICAgUkVUVVJOSU5HIGlkXG4gICAgICBgO1xuXG4gICAgICBjb25zdCBhdHRlbmRhbmNlUmVjb3JkUmVzdWx0ID0gYXdhaXQgZ2V0UG9vbCgpLnF1ZXJ5KGF0dGVuZGFuY2VSZWNvcmRRdWVyeSwgW2VtcGxveWVlSWQsIHRvZGF5XSk7XG4gICAgICBcbiAgICAgIC8vIEdldCB0aGUgYXR0ZW5kYW5jZSByZWNvcmQgSUQgKGVpdGhlciBuZXdseSBjcmVhdGVkIG9yIGV4aXN0aW5nKVxuICAgICAgbGV0IGF0dGVuZGFuY2VSZWNvcmRJZDtcbiAgICAgIGlmIChhdHRlbmRhbmNlUmVjb3JkUmVzdWx0LnJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgICBhdHRlbmRhbmNlUmVjb3JkSWQgPSBhdHRlbmRhbmNlUmVjb3JkUmVzdWx0LnJvd3NbMF0uaWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBHZXQgZXhpc3RpbmcgcmVjb3JkXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nUmVjb3JkUXVlcnkgPSBgXG4gICAgICAgICAgU0VMRUNUIGlkIEZST00gYXR0ZW5kYW5jZV9yZWNvcmRzIFxuICAgICAgICAgIFdIRVJFIGVtcGxveWVlX2lkID0gJDEgQU5EIGRhdGUgPSAkMlxuICAgICAgICBgO1xuICAgICAgICBjb25zdCBleGlzdGluZ1Jlc3VsdCA9IGF3YWl0IGdldFBvb2woKS5xdWVyeShleGlzdGluZ1JlY29yZFF1ZXJ5LCBbZW1wbG95ZWVJZCwgdG9kYXldKTtcbiAgICAgICAgYXR0ZW5kYW5jZVJlY29yZElkID0gZXhpc3RpbmdSZXN1bHQucm93c1swXS5pZDtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUncyBhbiBleGlzdGluZyBpbmNvbXBsZXRlIHNlc3Npb24gZm9yIHRvZGF5XG4gICAgICBjb25zdCBleGlzdGluZ1Nlc3Npb25RdWVyeSA9IGBcbiAgICAgICAgU0VMRUNUIHMuaWQsIHMuc2Vzc2lvbl90eXBlLCBzLmNsb2NrX2luLCBzLmNsb2NrX291dFxuICAgICAgICBGUk9NIGF0dGVuZGFuY2Vfc2Vzc2lvbnMgc1xuICAgICAgICBKT0lOIGF0dGVuZGFuY2VfcmVjb3JkcyBhciBPTiBzLmF0dGVuZGFuY2VfcmVjb3JkX2lkID0gYXIuaWRcbiAgICAgICAgV0hFUkUgYXIuZW1wbG95ZWVfaWQgPSAkMSBcbiAgICAgICAgICBBTkQgYXIuZGF0ZSA9ICQyXG4gICAgICAgICAgQU5EIChzLmNsb2NrX2luIElTIE5VTEwgT1Igcy5jbG9ja19vdXQgSVMgTlVMTClcbiAgICAgICAgT1JERVIgQlkgcy5jcmVhdGVkX2F0IERFU0NcbiAgICAgICAgTElNSVQgMVxuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgZXhpc3RpbmdTZXNzaW9uID0gYXdhaXQgZ2V0UG9vbCgpLnF1ZXJ5KGV4aXN0aW5nU2Vzc2lvblF1ZXJ5LCBbZW1wbG95ZWVJZCwgdG9kYXldKTtcbiAgICAgIFxuICAgICAgbGV0IHJlc3VsdDtcbiAgICAgIFxuICAgICAgaWYgKGV4aXN0aW5nU2Vzc2lvbi5yb3dzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHNlc3Npb25cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGV4aXN0aW5nU2Vzc2lvbi5yb3dzWzBdO1xuICAgICAgICBcbiAgICAgICAgaWYgKHR5cGUgPT09ICdjbG9ja19vdXQnICYmIHNlc3Npb24uY2xvY2tfaW4gJiYgIXNlc3Npb24uY2xvY2tfb3V0KSB7XG4gICAgICAgICAgLy8gQ29tcGxldGUgdGhlIHNlc3Npb24gd2l0aCBjbG9ja19vdXRcbiAgICAgICAgICBjb25zdCB1cGRhdGVRdWVyeSA9IGBcbiAgICAgICAgICAgIFVQREFURSBhdHRlbmRhbmNlX3Nlc3Npb25zIFxuICAgICAgICAgICAgU0VUIGNsb2NrX291dCA9ICQxLCBzZWxmaWVfaW1hZ2VfdXJsID0gJDUsIHVwZGF0ZWRfYXQgPSBOT1coKVxuICAgICAgICAgICAgV0hFUkUgaWQgPSAkMlxuICAgICAgICAgICAgUkVUVVJOSU5HIFxuICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgJDMgYXMgXCJlbXBsb3llZUlkXCIsXG4gICAgICAgICAgICAgICdjbG9ja19vdXQnIGFzIFwidHlwZVwiLFxuICAgICAgICAgICAgICAkMSBhcyBcInRpbWVzdGFtcFwiLFxuICAgICAgICAgICAgICAkNCBhcyBcImxvY2F0aW9uXCIsXG4gICAgICAgICAgICAgICQ1IGFzIFwic2VsZmllVXJsXCIsXG4gICAgICAgICAgICAgICQ2IGFzIFwicXJDb2RlRGF0YVwiLFxuICAgICAgICAgICAgICB0cnVlIGFzIFwicXJDb2RlU2Nhbm5lZFwiXG4gICAgICAgICAgYDtcbiAgICAgICAgICBcbiAgICAgICAgICByZXN1bHQgPSBhd2FpdCBnZXRQb29sKCkucXVlcnkodXBkYXRlUXVlcnksIFtcbiAgICAgICAgICAgIG5vdy50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgc2Vzc2lvbi5pZCxcbiAgICAgICAgICAgIGVtcGxveWVlSWQsXG4gICAgICAgICAgICBsb2NhdGlvbixcbiAgICAgICAgICAgIHNlbGZpZVVybCB8fCBudWxsLFxuICAgICAgICAgICAgcXJDb2RlRGF0YVxuICAgICAgICAgIF0pO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjbG9ja19pbicgJiYgIXNlc3Npb24uY2xvY2tfaW4pIHtcbiAgICAgICAgICAvLyBVcGRhdGUgZXhpc3Rpbmcgc2Vzc2lvbiB3aXRoIGNsb2NrX2luXG4gICAgICAgICAgY29uc3QgdXBkYXRlUXVlcnkgPSBgXG4gICAgICAgICAgICBVUERBVEUgYXR0ZW5kYW5jZV9zZXNzaW9ucyBcbiAgICAgICAgICAgIFNFVCBjbG9ja19pbiA9ICQxLCBzZWxmaWVfaW1hZ2VfdXJsID0gJDUsIHVwZGF0ZWRfYXQgPSBOT1coKVxuICAgICAgICAgICAgV0hFUkUgaWQgPSAkMlxuICAgICAgICAgICAgUkVUVVJOSU5HIFxuICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgJDMgYXMgXCJlbXBsb3llZUlkXCIsXG4gICAgICAgICAgICAgICdjbG9ja19pbicgYXMgXCJ0eXBlXCIsXG4gICAgICAgICAgICAgICQxIGFzIFwidGltZXN0YW1wXCIsXG4gICAgICAgICAgICAgICQ0IGFzIFwibG9jYXRpb25cIixcbiAgICAgICAgICAgICAgJDUgYXMgXCJzZWxmaWVVcmxcIixcbiAgICAgICAgICAgICAgJDYgYXMgXCJxckNvZGVEYXRhXCIsXG4gICAgICAgICAgICAgIHRydWUgYXMgXCJxckNvZGVTY2FubmVkXCJcbiAgICAgICAgICBgO1xuICAgICAgICAgIFxuICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGdldFBvb2woKS5xdWVyeSh1cGRhdGVRdWVyeSwgW1xuICAgICAgICAgICAgbm93LnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBzZXNzaW9uLmlkLFxuICAgICAgICAgICAgZW1wbG95ZWVJZCxcbiAgICAgICAgICAgIGxvY2F0aW9uLFxuICAgICAgICAgICAgc2VsZmllVXJsIHx8IG51bGwsXG4gICAgICAgICAgICBxckNvZGVEYXRhXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ3JlYXRlIG5ldyBzZXNzaW9uIGlmIGV4aXN0aW5nIG9uZSBjYW4ndCBiZSB1cGRhdGVkXG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5jcmVhdGVOZXdTZXNzaW9uKGF0dGVuZGFuY2VSZWNvcmRJZCwgdHlwZSwgbm93LCBsb2NhdGlvbiwgc2VsZmllVXJsLCBlbXBsb3llZUlkLCBxckNvZGVEYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ3JlYXRlIG5ldyBzZXNzaW9uXG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuY3JlYXRlTmV3U2Vzc2lvbihhdHRlbmRhbmNlUmVjb3JkSWQsIHR5cGUsIG5vdywgbG9jYXRpb24sIHNlbGZpZVVybCwgZW1wbG95ZWVJZCwgcXJDb2RlRGF0YSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCdLaW9za1NlcnZpY2UucmVjb3JkQXR0ZW5kYW5jZSByZXN1bHQ6JywgcmVzdWx0LnJvd3NbMF0pO1xuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzWzBdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWNvcmRpbmcgYXR0ZW5kYW5jZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGF0dGVuZGFuY2Ugc2Vzc2lvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVOZXdTZXNzaW9uKFxuICAgIGF0dGVuZGFuY2VSZWNvcmRJZDogc3RyaW5nLCBcbiAgICB0eXBlOiBzdHJpbmcsIFxuICAgIHRpbWVzdGFtcDogRGF0ZSwgXG4gICAgbG9jYXRpb246IHN0cmluZywgXG4gICAgc2VsZmllVXJsOiBzdHJpbmcgfCB1bmRlZmluZWQsIFxuICAgIGVtcGxveWVlSWQ6IHN0cmluZywgXG4gICAgcXJDb2RlRGF0YTogc3RyaW5nXG4gICkge1xuICAgIGNvbnN0IGNsb2NrSW4gPSB0eXBlID09PSAnY2xvY2tfaW4nID8gdGltZXN0YW1wLnRvSVNPU3RyaW5nKCkgOiBudWxsO1xuICAgIGNvbnN0IGNsb2NrT3V0ID0gdHlwZSA9PT0gJ2Nsb2NrX291dCcgPyB0aW1lc3RhbXAudG9JU09TdHJpbmcoKSA6IG51bGw7XG5cbiAgICBjb25zdCBpbnNlcnRRdWVyeSA9IGBcbiAgICAgIElOU0VSVCBJTlRPIGF0dGVuZGFuY2Vfc2Vzc2lvbnMgKFxuICAgICAgICBhdHRlbmRhbmNlX3JlY29yZF9pZCxcbiAgICAgICAgc2Vzc2lvbl90eXBlLFxuICAgICAgICBjbG9ja19pbixcbiAgICAgICAgY2xvY2tfb3V0LFxuICAgICAgICBzdGF0dXMsXG4gICAgICAgIHNlbGZpZV9pbWFnZV9wYXRoLFxuICAgICAgICBzZWxmaWVfaW1hZ2VfdXJsLFxuICAgICAgICBjcmVhdGVkX2F0XG4gICAgICApIFZBTFVFUyAoJDEsICQyLCAkMywgJDQsICdwcmVzZW50JywgJDUsICQ1LCBOT1coKSlcbiAgICAgIFJFVFVSTklORyBcbiAgICAgICAgaWQsXG4gICAgICAgICQ2IGFzIFwiZW1wbG95ZWVJZFwiLFxuICAgICAgICAkMiBhcyBcInR5cGVcIixcbiAgICAgICAgQ09BTEVTQ0UoJDMsICQ0KSBhcyBcInRpbWVzdGFtcFwiLFxuICAgICAgICAkNyBhcyBcImxvY2F0aW9uXCIsXG4gICAgICAgICQ1IGFzIFwic2VsZmllVXJsXCIsXG4gICAgICAgICQ4IGFzIFwicXJDb2RlRGF0YVwiLFxuICAgICAgICB0cnVlIGFzIFwicXJDb2RlU2Nhbm5lZFwiXG4gICAgYDtcblxuICAgIHJldHVybiBhd2FpdCBnZXRQb29sKCkucXVlcnkoaW5zZXJ0UXVlcnksIFtcbiAgICAgIGF0dGVuZGFuY2VSZWNvcmRJZCxcbiAgICAgIHR5cGUsXG4gICAgICBjbG9ja0luLFxuICAgICAgY2xvY2tPdXQsXG4gICAgICBzZWxmaWVVcmwgfHwgbnVsbCxcbiAgICAgIGVtcGxveWVlSWQsXG4gICAgICBsb2NhdGlvbixcbiAgICAgIHFyQ29kZURhdGFcbiAgICBdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbGFzdCBhdHRlbmRhbmNlIHJlY29yZCBmb3IgZW1wbG95ZWVcbiAgICovXG4gIGFzeW5jIGdldExhc3RBdHRlbmRhbmNlKGVtcGxveWVlSWQ6IHN0cmluZyk6IFByb21pc2U8S2lvc2tBdHRlbmRhbmNlUmVjb3JkIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgIHMuaWQsXG4gICAgICAgICAgYXIuZW1wbG95ZWVfaWQgYXMgXCJlbXBsb3llZUlkXCIsXG4gICAgICAgICAgcy5zZXNzaW9uX3R5cGUgYXMgXCJ0eXBlXCIsXG4gICAgICAgICAgQ09BTEVTQ0Uocy5jbG9ja19pbiwgcy5jbG9ja19vdXQpIGFzIFwidGltZXN0YW1wXCIsXG4gICAgICAgICAgJ09mZmljZScgYXMgXCJsb2NhdGlvblwiLFxuICAgICAgICAgIHMuc2VsZmllX2ltYWdlX3BhdGggYXMgXCJzZWxmaWVVcmxcIixcbiAgICAgICAgICAnUVJfQ09ERV9EQVRBJyBhcyBcInFyQ29kZURhdGFcIixcbiAgICAgICAgICB0cnVlIGFzIFwicXJDb2RlU2Nhbm5lZFwiXG4gICAgICAgIEZST00gYXR0ZW5kYW5jZV9zZXNzaW9ucyBzXG4gICAgICAgIEpPSU4gYXR0ZW5kYW5jZV9yZWNvcmRzIGFyIE9OIHMuYXR0ZW5kYW5jZV9yZWNvcmRfaWQgPSBhci5pZFxuICAgICAgICBXSEVSRSBhci5lbXBsb3llZV9pZCA9ICQxXG4gICAgICAgIE9SREVSIEJZIHMuY3JlYXRlZF9hdCBERVNDXG4gICAgICAgIExJTUlUIDFcbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFBvb2woKS5xdWVyeShxdWVyeSwgW2VtcGxveWVlSWRdKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzLmxlbmd0aCA+IDAgPyByZXN1bHQucm93c1swXSA6IG51bGw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgbGFzdCBhdHRlbmRhbmNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYXR0ZW5kYW5jZSBoaXN0b3J5IGZvciBlbXBsb3llZVxuICAgKi9cbiAgYXN5bmMgZ2V0QXR0ZW5kYW5jZUhpc3RvcnkoZW1wbG95ZWVJZDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gMTApOiBQcm9taXNlPEtpb3NrQXR0ZW5kYW5jZVJlY29yZFtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gYFxuICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgcy5pZCxcbiAgICAgICAgICBhci5lbXBsb3llZV9pZCBhcyBcImVtcGxveWVlSWRcIixcbiAgICAgICAgICBzLnNlc3Npb25fdHlwZSBhcyBcInR5cGVcIixcbiAgICAgICAgICBDT0FMRVNDRShzLmNsb2NrX2luLCBzLmNsb2NrX291dCkgYXMgXCJ0aW1lc3RhbXBcIixcbiAgICAgICAgICAnT2ZmaWNlJyBhcyBcImxvY2F0aW9uXCIsXG4gICAgICAgICAgcy5zZWxmaWVfaW1hZ2VfcGF0aCBhcyBcInNlbGZpZVVybFwiLFxuICAgICAgICAgICdRUl9DT0RFX0RBVEEnIGFzIFwicXJDb2RlRGF0YVwiLFxuICAgICAgICAgIHRydWUgYXMgXCJxckNvZGVTY2FubmVkXCJcbiAgICAgICAgRlJPTSBhdHRlbmRhbmNlX3Nlc3Npb25zIHNcbiAgICAgICAgSk9JTiBhdHRlbmRhbmNlX3JlY29yZHMgYXIgT04gcy5hdHRlbmRhbmNlX3JlY29yZF9pZCA9IGFyLmlkXG4gICAgICAgIFdIRVJFIGFyLmVtcGxveWVlX2lkID0gJDFcbiAgICAgICAgT1JERVIgQlkgcy5jcmVhdGVkX2F0IERFU0NcbiAgICAgICAgTElNSVQgJDJcbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFBvb2woKS5xdWVyeShxdWVyeSwgW2VtcGxveWVlSWQsIGxpbWl0XSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQucm93cztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyBhdHRlbmRhbmNlIGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCB0aW1lLWJhc2VkIGF0dGVuZGFuY2UgdXNpbmcgdGhlIG5ldyBzZXNzaW9uIHN5c3RlbVxuICAgKi9cbiAgYXN5bmMgcmVjb3JkVGltZUJhc2VkQXR0ZW5kYW5jZShkYXRhOiBUaW1lQmFzZWRSZWNvcmRBdHRlbmRhbmNlRGF0YSk6IFByb21pc2U8S2lvc2tBdHRlbmRhbmNlUmVjb3JkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZW1wbG95ZWVJZCwgc2Vzc2lvblR5cGUsIGxvY2F0aW9uLCBxckNvZGVEYXRhLCBzZWxmaWVVcmwgfSA9IGRhdGE7XG4gICAgICBjb25zb2xlLmxvZygnS2lvc2tTZXJ2aWNlLnJlY29yZFRpbWVCYXNlZEF0dGVuZGFuY2UgY2FsbGVkIHdpdGg6JywgeyBlbXBsb3llZUlkLCBzZXNzaW9uVHlwZSwgbG9jYXRpb24sIHFyQ29kZURhdGEsIHNlbGZpZVVybCB9KTtcblxuICAgICAgLy8gVXNlIHRoZSBhdHRlbmRhbmNlIHNlcnZpY2UgdG8gcmVjb3JkIHRpbWUtYmFzZWQgYXR0ZW5kYW5jZVxuICAgICAgY29uc3QgYXR0ZW5kYW5jZURhdGE6IFRpbWVCYXNlZEF0dGVuZGFuY2VEYXRhID0ge1xuICAgICAgICBlbXBsb3llZUlkLFxuICAgICAgICBzZXNzaW9uVHlwZSxcbiAgICAgICAgcXJDb2RlSGFzaDogcXJDb2RlRGF0YSxcbiAgICAgICAgc2VsZmllSW1hZ2VQYXRoOiBzZWxmaWVVcmwsIC8vIFRoaXMgaXMgbm93IHRoZSBmaWxlIHBhdGggZnJvbSBNdWx0ZXJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpIC8vIFRoaXMgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gVVRDIGluIHRoZSBhdHRlbmRhbmNlIHNlcnZpY2VcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGF0dGVuZGFuY2VTZXJ2aWNlLnJlY29yZFRpbWVCYXNlZEF0dGVuZGFuY2UoYXR0ZW5kYW5jZURhdGEpO1xuICAgICAgXG4gICAgICAvLyBGaW5kIHRoZSBzZXNzaW9uIHRoYXQgd2FzIGp1c3QgY3JlYXRlZC91cGRhdGVkXG4gICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gICAgICB0b2RheS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgICAgIFxuICAgICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICBzLmlkLFxuICAgICAgICAgIGFyLmVtcGxveWVlX2lkIGFzIFwiZW1wbG95ZWVJZFwiLFxuICAgICAgICAgIHMuc2Vzc2lvbl90eXBlIGFzIFwic2Vzc2lvblR5cGVcIixcbiAgICAgICAgICBDT0FMRVNDRShzLmNsb2NrX2luLCBzLmNsb2NrX291dCkgYXMgXCJ0aW1lc3RhbXBcIixcbiAgICAgICAgICAkMSBhcyBcImxvY2F0aW9uXCIsXG4gICAgICAgICAgcy5zZWxmaWVfaW1hZ2VfcGF0aCBhcyBcInNlbGZpZVVybFwiLFxuICAgICAgICAgICQyIGFzIFwicXJDb2RlRGF0YVwiLFxuICAgICAgICAgIHRydWUgYXMgXCJxckNvZGVTY2FubmVkXCIsXG4gICAgICAgICAgQ0FTRSBcbiAgICAgICAgICAgIFdIRU4gcy5zZXNzaW9uX3R5cGUgSU4gKCdtb3JuaW5nX2luJywgJ2FmdGVybm9vbl9pbicpIFRIRU4gJ2Nsb2NrX2luJ1xuICAgICAgICAgICAgV0hFTiBzLnNlc3Npb25fdHlwZSBJTiAoJ21vcm5pbmdfb3V0JywgJ2FmdGVybm9vbl9vdXQnKSBUSEVOICdjbG9ja19vdXQnXG4gICAgICAgICAgICBFTFNFICdjbG9ja19pbidcbiAgICAgICAgICBFTkQgYXMgXCJ0eXBlXCJcbiAgICAgICAgRlJPTSBhdHRlbmRhbmNlX3Nlc3Npb25zIHNcbiAgICAgICAgSk9JTiBhdHRlbmRhbmNlX3JlY29yZHMgYXIgT04gcy5hdHRlbmRhbmNlX3JlY29yZF9pZCA9IGFyLmlkXG4gICAgICAgIFdIRVJFIGFyLmVtcGxveWVlX2lkID0gJDNcbiAgICAgICAgICBBTkQgYXIuZGF0ZSA9ICQ0XG4gICAgICAgICAgQU5EIHMuc2Vzc2lvbl90eXBlID0gJDVcbiAgICAgICAgT1JERVIgQlkgcy5jcmVhdGVkX2F0IERFU0NcbiAgICAgICAgTElNSVQgMVxuICAgICAgYDtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UG9vbCgpLnF1ZXJ5KHF1ZXJ5LCBbbG9jYXRpb24sIHFyQ29kZURhdGEsIGVtcGxveWVlSWQsIHRvZGF5LCBzZXNzaW9uVHlwZV0pO1xuICAgICAgXG4gICAgICBpZiAocmVzdWx0LnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHJlY29yZGVkIGF0dGVuZGFuY2Ugc2Vzc2lvbicpO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygnS2lvc2tTZXJ2aWNlLnJlY29yZFRpbWVCYXNlZEF0dGVuZGFuY2UgcmVzdWx0OicsIHJlc3VsdC5yb3dzWzBdKTtcbiAgICAgIHJldHVybiByZXN1bHQucm93c1swXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVjb3JkaW5nIHRpbWUtYmFzZWQgYXR0ZW5kYW5jZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IG5leHQgZXhwZWN0ZWQgc2Vzc2lvbiBmb3IgZW1wbG95ZWVcbiAgICovXG4gIGFzeW5jIGdldE5leHRFeHBlY3RlZFNlc3Npb24oZW1wbG95ZWVJZDogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgc2Vzc2lvblR5cGU6IFNlc3Npb25UeXBlIHwgbnVsbDtcbiAgICBkaXNwbGF5SW5mbzogUmV0dXJuVHlwZTx0eXBlb2YgZ2V0U2Vzc2lvbkRpc3BsYXlJbmZvPiB8IG51bGw7XG4gICAgY2FuUGVyZm9ybTogYm9vbGVhbjtcbiAgICByZWFzb24/OiBzdHJpbmc7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGF0dGVuZGFuY2VTZXJ2aWNlLmdldE5leHRFeHBlY3RlZFNlc3Npb24oZW1wbG95ZWVJZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgbmV4dCBleHBlY3RlZCBzZXNzaW9uOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhdHRlbmRhbmNlIGFjdGlvbiBmb3IgZW1wbG95ZWVcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlQXR0ZW5kYW5jZUFjdGlvbihlbXBsb3llZUlkOiBzdHJpbmcsIHNlc3Npb25UeXBlOiBTZXNzaW9uVHlwZSk6IFByb21pc2U8e1xuICAgIGNhblBlcmZvcm06IGJvb2xlYW47XG4gICAgcmVhc29uPzogc3RyaW5nO1xuICAgIG5leHRFeHBlY3RlZFNlc3Npb24/OiBTZXNzaW9uVHlwZTtcbiAgICBzZXNzaW9uRGlzcGxheUluZm8/OiBSZXR1cm5UeXBlPHR5cGVvZiBnZXRTZXNzaW9uRGlzcGxheUluZm8+O1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBhdHRlbmRhbmNlU2VydmljZS52YWxpZGF0ZUF0dGVuZGFuY2VBY3Rpb24oZW1wbG95ZWVJZCwgc2Vzc2lvblR5cGUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB2YWxpZGF0aW5nIGF0dGVuZGFuY2UgYWN0aW9uOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdG9kYXkncyBhdHRlbmRhbmNlIHN1bW1hcnkgZm9yIGVtcGxveWVlXG4gICAqL1xuICBhc3luYyBnZXRUb2RheUF0dGVuZGFuY2VTdW1tYXJ5KGVtcGxveWVlSWQ6IHN0cmluZyk6IFByb21pc2U8e1xuICAgIHNlc3Npb25zOiBLaW9za0F0dGVuZGFuY2VSZWNvcmRbXTtcbiAgICBuZXh0RXhwZWN0ZWRTZXNzaW9uOiBTZXNzaW9uVHlwZSB8IG51bGw7XG4gICAgY2FuUGVyZm9ybU5leHQ6IGJvb2xlYW47XG4gICAgcmVhc29uPzogc3RyaW5nO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgICAgIHRvZGF5LnNldEhvdXJzKDAsIDAsIDAsIDApO1xuICAgICAgXG4gICAgICAvLyBHZXQgdG9kYXkncyBzZXNzaW9uc1xuICAgICAgY29uc3Qgc2Vzc2lvbnMgPSBhd2FpdCB0aGlzLmdldEF0dGVuZGFuY2VIaXN0b3J5KGVtcGxveWVlSWQsIDEwKTtcbiAgICAgIGNvbnN0IHRvZGF5U2Vzc2lvbnMgPSBzZXNzaW9ucy5maWx0ZXIoc2Vzc2lvbiA9PiB7XG4gICAgICAgIGNvbnN0IHNlc3Npb25EYXRlID0gbmV3IERhdGUoc2Vzc2lvbi50aW1lc3RhbXApO1xuICAgICAgICBzZXNzaW9uRGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgICAgICAgcmV0dXJuIHNlc3Npb25EYXRlLmdldFRpbWUoKSA9PT0gdG9kYXkuZ2V0VGltZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEdldCBuZXh0IGV4cGVjdGVkIHNlc3Npb25cbiAgICAgIGNvbnN0IG5leHRTZXNzaW9uID0gYXdhaXQgdGhpcy5nZXROZXh0RXhwZWN0ZWRTZXNzaW9uKGVtcGxveWVlSWQpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXNzaW9uczogdG9kYXlTZXNzaW9ucyxcbiAgICAgICAgbmV4dEV4cGVjdGVkU2Vzc2lvbjogbmV4dFNlc3Npb24uc2Vzc2lvblR5cGUsXG4gICAgICAgIGNhblBlcmZvcm1OZXh0OiBuZXh0U2Vzc2lvbi5jYW5QZXJmb3JtLFxuICAgICAgICByZWFzb246IG5leHRTZXNzaW9uLnJlYXNvblxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB0b2RheSBhdHRlbmRhbmNlIHN1bW1hcnk6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IG5ldyBLaW9za1NlcnZpY2UoKTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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